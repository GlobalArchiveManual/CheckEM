[{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/check-fish.html","id":"r-set-up","dir":"Articles > R-workflows","previous_headings":"","what":"R set up","title":"Checking fish data exported from EventMeasure","text":"Load necessary libraries. Set study name.","code":"library(devtools) library(CheckEM) library(tidyverse) library(googlesheets4) library(sf) library(terra) library(here) name <- \"example-bruv-workflow\""},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/check-fish.html","id":"read-in-and-format-the-metadata","dir":"Articles > R-workflows","previous_headings":"","what":"Read in and format the metadata","title":"Checking fish data exported from EventMeasure","text":"Load tidy metadata. already completed step checking habitat data, can skip next two chunks code simply read metadata (see ). Save metadata R data file (creates lighter file saving .csv similar). Load metadata already exported ‘check-habitat’ scripts. just loaded saved metadata, can skip chunk code. Load marine park shapefiles, extract fishing status (e.g. ‘Fished’ ‘-take’) use modelling. dataset used 2022 Collaborative Australian Protected Areas Database, available free download https://fed.dcceew.gov.au/datasets/782c02c691014efe8ffbd27445fe41d7_0/explore. Feel free replace shapefile suitable dataset available study area.","code":"metadata <- read_metadata(here::here(\"r-workflows/data/raw/\")) %>%   dplyr::select(campaignid, sample, longitude_dd, latitude_dd, date_time, location, site, depth, successful_count, successful_length, successful_habitat_forward, successful_habitat_backward) %>%   glimpse() ## Rows: 32 ## Columns: 12 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", \"3… ## $ longitude_dd                <chr> \"114.923645\", \"114.9292367\", \"114.92843\", … ## $ latitude_dd                 <chr> \"-34.13155\", \"-34.12952667\", \"-34.12729\", … ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:49\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\", … ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … saveRDS(metadata, file = here::here(paste0(\"r-workflows/data/tidy/\",                                 name, \"_Metadata.rds\"))) metadata <- readRDS(here::here(paste0(\"r-workflows/data/tidy/\",                                 name, \"_Metadata.rds\"))) marine.parks <- st_read(here::here(\"r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp\"))  %>%   dplyr::select(geometry, ZONE_TYPE) %>%   st_transform(4326) %>%   st_make_valid() ## Reading layer `Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine' from data source `/home/runner/work/CheckEM/CheckEM/r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp'  ##   using driver `ESRI Shapefile' ## Simple feature collection with 3775 features and 26 fields ## Geometry type: MULTIPOLYGON ## Dimension:     XY ## Bounding box:  xmin: 70.71702 ymin: -58.44947 xmax: 170.3667 ymax: -8.473407 ## Geodetic CRS:  WGS 84 metadata_sf <- st_as_sf(metadata, coords = c(\"longitude_dd\", \"latitude_dd\"),                       crs = 4326)  metadata <- metadata_sf %>%   st_intersection(marine.parks) %>%   bind_cols(st_coordinates(.)) %>%   as.data.frame() %>%   dplyr::select(-c(geometry)) %>%   dplyr::rename(longitude_dd = X, latitude_dd = Y) %>%   dplyr::mutate(status = if_else(str_detect(ZONE_TYPE, \"National|Sanctuary\"),                                 \"No-take\", \"Fished\")) %>%   clean_names() %>%   glimpse() ## Warning: attribute variables are assumed to be spatially constant throughout ## all geometries ## Rows: 32 ## Columns: 14 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", \"3… ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:49\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\", … ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ zone_type                   <chr> \"National Park Zone (IUCN II)\", \"National … ## $ longitude_dd                <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ latitude_dd                 <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ status                      <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\"…"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/check-fish.html","id":"read-in-the-raw-data","dir":"Articles > R-workflows","previous_headings":"","what":"Read in the raw data","title":"Checking fish data exported from EventMeasure","text":"Load count data (MaxN _Points.txt file). Create tidy MaxN file. Load length data (’_Lengths.txt’ ’_3DPoints.txt’). Tidy complete MaxN data (e.g. complete zeroes data). Tidy complete length data (e.g. complete zeroes data).","code":"points <- CheckEM::read_files_maxn(here::here(\"r-workflows/data/raw/\")) %>%   glimpse() ## Rows: 17,425 ## Columns: 22 ## $ sample      <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\"… ## $ pointindex  <chr> \"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"10\", \"1… ## $ filename    <chr> \"Left_MAH00355.MP4\", \"Left_MAH00355.MP4\", \"Left_MAH00355.M… ## $ frame       <chr> \"11347\", \"11403\", \"11403\", \"11473\", \"11473\", \"11473\", \"127… ## $ time        <chr> \"25.71152\", \"25.72709\", \"25.72709\", \"25.74655\", \"25.74655\"… ## $ period      <chr> \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\"… ## $ periodtime  <chr> \"0.33422\", \"0.34979\", \"0.34979\", \"0.36926\", \"0.36926\", \"0.… ## $ imagecol    <chr> \"463.20000\", \"474.00000\", \"1495.20000\", \"1562.40000\", \"157… ## $ imagerow    <chr> \"669.60000\", \"655.20000\", \"541.20000\", \"543.60000\", \"571.2… ## $ rectwidth   <chr> \"0.00000\", \"0.00000\", \"0.00000\", \"0.00000\", \"0.00000\", \"0.… ## $ rectheight  <chr> \"0.00000\", \"0.00000\", \"0.00000\", \"0.00000\", \"0.00000\", \"0.… ## $ family      <chr> \"Labridae\", \"Labridae\", \"Labridae\", \"Labridae\", \"Labridae\"… ## $ genus       <chr> \"Ophthalmolepis\", \"Ophthalmolepis\", \"Ophthalmolepis\", \"Pse… ## $ species     <chr> \"lineolata\", \"lineolata\", \"lineolata\", \"biserialis\", \"bise… ## $ code        <chr> \"37384040\", \"37384040\", \"37384040\", \"37384149\", \"37384149\"… ## $ number      <chr> \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\"… ## $ stage       <chr> \"AD\", \"AD\", \"AD\", \"AD\", \"AD\", \"AD\", \"AD\", \"AD\", \"AD\", \"AD\"… ## $ activity    <chr> \"Passing\", \"Passing\", \"Passing\", \"Passing\", \"Passing\", \"Pa… ## $ comment     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ attribute9  <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ attribute10 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ campaignid  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"2… maxn <- points %>%    dplyr::group_by(campaignid, sample, filename, periodtime, frame, family, genus, species) %>%    dplyr::mutate(number = as.numeric(number)) %>%   dplyr::summarise(maxn = sum(number)) %>%   dplyr::group_by(campaignid, sample, family, genus, species) %>%   dplyr::slice(which.max(maxn)) %>%   dplyr::ungroup() %>%   dplyr::filter(!is.na(maxn)) %>%   dplyr::select(-frame) %>%   tidyr::replace_na(list(maxn = 0)) %>%   dplyr::mutate(maxn = as.numeric(maxn)) %>%   dplyr::filter(maxn > 0) %>%   dplyr::inner_join(metadata) %>%   dplyr::filter(successful_count %in% c(\"Yes\")) %>%    dplyr::filter(maxn > 0) %>%   glimpse() ## `summarise()` has grouped output by 'campaignid', 'sample', 'filename', ## 'periodtime', 'frame', 'family', 'genus'. You can override using the `.groups` ## argument. ## Joining with `by = join_by(campaignid, sample)` ## Rows: 462 ## Columns: 20 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", … ## $ filename                    <chr> \"Left_MAH00356.MP4\", \"Left_MAH00356.MP4\", … ## $ periodtime                  <chr> \"20.35283\", \"23.92279\", \"55.15232\", \"15.42… ## $ family                      <chr> \"Dasyatidae\", \"Gerreidae\", \"Heterodontidae… ## $ genus                       <chr> \"Dasyatis\", \"Parequula\", \"Heterodontus\", \"… ## $ species                     <chr> \"brevicaudata\", \"melbournensis\", \"portusja… ## $ maxn                        <dbl> 1, 1, 1, 1, 71, 9, 8, 1, 5, 2, 9, 1, 1, 2,… ## $ date_time                   <chr> \"18/03/2023 2:44\", \"18/03/2023 2:44\", \"18/… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"4… ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ zone_type                   <chr> \"National Park Zone (IUCN II)\", \"National … ## $ longitude_dd                <dbl> 114.8533, 114.8533, 114.8533, 114.8533, 11… ## $ latitude_dd                 <dbl> -34.08388, -34.08388, -34.08388, -34.08388… ## $ status                      <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\"… length3dpoints <- read_files_length(here::here(\"r-workflows/data/raw/\")) %>%                      dplyr::select(-c(comment))%>%   dplyr::inner_join(metadata)%>%   dplyr::filter(successful_length %in% \"Yes\") %>%   glimpse() ## Joining with `by = join_by(sample, campaignid)` ## Rows: 2,428 ## Columns: 47 ## $ sample                      <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"12\", \"12\", … ## $ imageptpair                 <chr> \"72\", \"73\", \"75\", \"81\", \"93\", \"0\", \"11\", \"… ## $ filenameleft                <chr> \"Left_MAH00355.MP4\", \"Left_MAH00355.MP4\", … ## $ frameleft                   <chr> \"65608\", \"74525\", \"21436\", \"33446\", \"46833… ## $ filenameright               <chr> \"Right_MAH00344.MP4\", \"Right_MAH00344.MP4\"… ## $ frameright                  <chr> \"64140\", \"73057\", \"20028\", \"32038\", \"45425… ## $ time                        <chr> \"40.79909\", \"43.27851\", \"51.07269\", \"54.41… ## $ period                      <chr> \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1… ## $ periodtime                  <chr> \"15.42180\", \"17.90122\", \"25.69539\", \"29.03… ## $ x                           <chr> \"-430.67367\", \"-278.33750\", \"-997.34125\", … ## $ y                           <chr> \"-140.98709\", \"-257.03677\", \"-186.86483\", … ## $ z                           <chr> \"-868.53490\", \"-762.92425\", \"-1522.45323\",… ## $ sx                          <chr> \"0.64880\", \"0.48001\", \"1.91708\", \"0.42177\"… ## $ sy                          <chr> \"0.46100\", \"0.47613\", \"0.79836\", \"0.44960\"… ## $ sz                          <chr> \"1.11439\", \"0.88751\", \"3.13793\", \"0.83996\"… ## $ rms                         <chr> \"0.67020\", \"0.47105\", \"0.63932\", \"0.10770\"… ## $ range                       <chr> \"979.64791\", \"851.81752\", \"1829.60976\", \"7… ## $ direction                   <chr> \"27.65589\", \"26.62953\", \"33.74391\", \"22.82… ## $ family                      <chr> \"Labridae\", \"Urolophidae\", \"Labridae\", \"Tr… ## $ genus                       <chr> \"Austrolabrus\", \"Trygonoptera\", \"Ophthalmo… ## $ species                     <chr> \"maculatus\", \"ovalis\", \"lineolata\", \"dumer… ## $ code                        <chr> \"37384025\", \"37038016\", \"37384040\", \"37027… ## $ number                      <chr> \"1\", \"1\", \"1\", \"1\", \"1\", \"40\", \"1\", \"1\", \"… ## $ stage                       <chr> \"AD\", \"AD\", \"AD\", \"AD\", \"AD\", \"AD\", \"AD\", … ## $ activity                    <chr> \"Passing\", \"Passing\", \"Passing\", \"Passing\"… ## $ attribute9                  <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ attribute10                 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ length                      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ precision                   <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ horzdir                     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ vertdir                     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ midx                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ midy                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ midz                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ date_time                   <chr> \"18/03/2023 2:44\", \"18/03/2023 2:44\", \"18/… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"4… ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ zone_type                   <chr> \"National Park Zone (IUCN II)\", \"National … ## $ longitude_dd                <dbl> 114.8533, 114.8533, 114.8533, 114.8533, 11… ## $ latitude_dd                 <dbl> -34.08388, -34.08388, -34.08388, -34.08388… ## $ status                      <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\"… dat <- maxn %>%   dplyr::select(campaignid, sample, family, genus, species, maxn) %>%   tidyr::complete(nesting(campaignid, sample), nesting(family, genus, species)) %>%   replace_na(list(maxn = 0)) %>%   group_by(sample, family, genus, species) %>%   dplyr::summarise(maxn = sum(maxn)) %>%   ungroup() %>%    mutate(scientific = paste(family, genus, species, sep = \" \"))%>%   dplyr::select(sample, scientific, maxn)%>%   spread(scientific, maxn, fill = 0) ## `summarise()` has grouped output by 'sample', 'family', 'genus'. You can ## override using the `.groups` argument. maxn.families <- maxn %>%   dplyr::mutate(scientific = paste(family, genus, species, sep = \" \")) %>%   filter(!(family %in% \"Unknown\")) %>%   dplyr::select(c(family, genus, species, scientific)) %>%   distinct()  complete.maxn <- dat %>%   pivot_longer(names_to = \"scientific\", values_to = \"maxn\",                cols = 2:ncol(.)) %>%   inner_join(maxn.families, by = c(\"scientific\")) %>%   full_join(metadata)%>%   glimpse() ## Joining with `by = join_by(sample)` ## Rows: 2,912 ## Columns: 19 ## $ sample                      <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", … ## $ scientific                  <chr> \"Aplodactylidae Aplodactylus westralis\", \"… ## $ maxn                        <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, … ## $ family                      <chr> \"Aplodactylidae\", \"Arripidae\", \"Aulopidae\"… ## $ genus                       <chr> \"Aplodactylus\", \"Arripis\", \"Latropiscis\", … ## $ species                     <chr> \"westralis\", \"georgianus\", \"purpurissatus\"… ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ date_time                   <chr> \"18/03/2023 2:44\", \"18/03/2023 2:44\", \"18/… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"4… ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ zone_type                   <chr> \"National Park Zone (IUCN II)\", \"National … ## $ longitude_dd                <dbl> 114.8533, 114.8533, 114.8533, 114.8533, 11… ## $ latitude_dd                 <dbl> -34.08388, -34.08388, -34.08388, -34.08388… ## $ status                      <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\"… complete.length.number <- length3dpoints %>%    dplyr::filter(!family %in% \"Unknown\")%>%   dplyr::right_join(metadata) %>%   dplyr::filter(successful_length %in% \"Yes\") %>%   dplyr::select(campaignid, sample, family, genus, species, length, number, range) %>%   tidyr::complete(nesting(campaignid, sample), nesting(family, genus, species)) %>%   dplyr::mutate(number = as.numeric(number)) %>%   replace_na(list(number = 0)) %>%   ungroup() %>%   dplyr::filter(!is.na(number)) %>%   dplyr::mutate(length = as.numeric(length)) %>%   left_join(.,metadata) %>%   tidyr::uncount(number) %>%   glimpse() ## Joining with `by = join_by(sample, campaignid, date_time, location, site, ## depth, successful_count, successful_length, successful_habitat_forward, ## successful_habitat_backward, zone_type, longitude_dd, latitude_dd, status)` ## Joining with `by = join_by(campaignid, sample)` ## Rows: 4,212 ## Columns: 19 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", … ## $ family                      <chr> \"Dasyatidae\", \"Gerreidae\", \"Heterodontidae… ## $ genus                       <chr> \"Dasyatis\", \"Parequula\", \"Heterodontus\", \"… ## $ species                     <chr> \"brevicaudata\", \"melbournensis\", \"portusja… ## $ length                      <dbl> 1076.08643, 71.45003, NA, NA, 86.76808, 14… ## $ range                       <chr> \"2463.40578\", \"594.55232\", \"952.35412\", \"9… ## $ date_time                   <chr> \"18/03/2023 2:44\", \"18/03/2023 2:44\", \"18/… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"4… ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ zone_type                   <chr> \"National Park Zone (IUCN II)\", \"National … ## $ longitude_dd                <dbl> 114.8533, 114.8533, 114.8533, 114.8533, 11… ## $ latitude_dd                 <dbl> -34.08388, -34.08388, -34.08388, -34.08388… ## $ status                      <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\"…"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/check-fish.html","id":"save-the-checked-data","dir":"Articles > R-workflows","previous_headings":"","what":"Save the checked data","title":"Checking fish data exported from EventMeasure","text":"Save MaxN R data file. Save lengths R data file.","code":"saveRDS(complete.maxn,            file = here::here(paste0(\"r-workflows/data/staging/\",                        name, \"_complete-maxn.rds\"))) saveRDS(complete.length.number,            file = here::here(paste0(\"r-workflows/data/staging/\",                        name, \"_complete-length.rds\")))"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/check-habitat.html","id":"r-set-up","dir":"Articles > R-workflows","previous_headings":"","what":"R set up","title":"Checking habitat data exported from TransectMeasure","text":"Load necessary libraries. Set study name.","code":"library(devtools) library(CheckEM) library(tidyverse) library(ggplot2) library(ggbeeswarm) library(leaflet) library(leaflet.minicharts) library(RColorBrewer) library(here) library(tidyverse) name <- \"example-bruv-workflow\""},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/check-habitat.html","id":"read-in-the-data","dir":"Articles > R-workflows","previous_headings":"","what":"Read in the data","title":"Checking habitat data exported from TransectMeasure","text":"Load format metadata. Save metadata R data file (creates lighter file saving .csv similar). Read points data exported Transect Measure, filter 2 dataframes relief habitat annotations. Filter data include habitat annotations. Filter data include relief annotations.","code":"metadata <- read_metadata(here::here(\"r-workflows/data/raw/\")) %>%     dplyr::select(campaignid, sample, longitude_dd, latitude_dd, date_time, location, site, depth, successful_count, successful_length, successful_habitat_forward, successful_habitat_backward) %>%   glimpse() ## Rows: 32 ## Columns: 12 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", \"3… ## $ longitude_dd                <chr> \"114.923645\", \"114.9292367\", \"114.92843\", … ## $ latitude_dd                 <chr> \"-34.13155\", \"-34.12952667\", \"-34.12729\", … ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:49\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\", … ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … saveRDS(metadata, file = here::here(paste0(\"r-workflows/data/tidy/\", name, \"_Metadata.rds\"))) points <- read_TM(here::here(\"r-workflows/data/raw/\"),                                sample = \"opcode\") ## Rows: 2,483 ## Columns: 32 ## $ filename         <chr> \"10_1_DSC06511.JPG\", \"10_1_DSC06511.JPG\", \"10_1_DSC06… ## $ frame            <chr> \"      0\", \"      0\", \"      0\", \"      0\", \"      0\"… ## $ time_mins        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ image_row        <chr> \"790\", \"986\", \"683\", \"778\", \"976\", \"1009\", \"807\", \"88… ## $ image_col        <chr> \"83\", \"591\", \"930\", \"1829\", \"1654\", \"485\", \"525\", \"83… ## $ date             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ location         <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ site             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ transect         <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ latitude         <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ longitude        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ rugosity         <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ depth            <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ collector        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ fishing_status   <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ campaignid       <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs… ## $ relief_annotated <chr> \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\", \"no\",… ## $ sample           <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\",… ## $ period           <chr> \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\", \"1\"… ## $ frame_info_3     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ frame_info_4     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ frame_info_5     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ frame_info_6     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ level_2          <chr> \"Macroalgae\", \"Seagrasses\", \"Substrate\", \"Macroalgae\"… ## $ level_3          <chr> \"Filamentous / filiform\", \"Strap-like leaves\", \"Uncon… ## $ level_4          <chr> \"Red\", NA, \"Sand / mud (<2mm)\", \"Red\", \"Red\", NA, NA,… ## $ level_5          <chr> NA, NA, \"Coarse sand (with shell fragments)\", NA, NA,… ## $ scientific       <chr> NA, \"Thalassodendron spp\", NA, NA, NA, \"Thalassodendr… ## $ qualifiers       <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ caab_code        <chr> \"80300933\", \"63618905\", \"82001014\", \"80300906\", \"8030… ## $ x                <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… ## $ radius           <chr> \"67.0\", \"24.7\", \"18.2\", \"97.8\", \"82.6\", \"34.1\", \"25.2… habitat <- points %>%   dplyr::filter(relief_annotated %in% \"no\") %>%   dplyr::select(campaignid, sample, starts_with(\"level\"), scientific) %>%   glimpse() ## Rows: 1,241 ## Columns: 7 ## $ campaignid <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"20… ## $ sample     <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\",… ## $ level_2    <chr> \"Macroalgae\", \"Seagrasses\", \"Substrate\", \"Macroalgae\", \"Mac… ## $ level_3    <chr> \"Filamentous / filiform\", \"Strap-like leaves\", \"Unconsolida… ## $ level_4    <chr> \"Red\", NA, \"Sand / mud (<2mm)\", \"Red\", \"Red\", NA, NA, \"Brow… ## $ level_5    <chr> NA, NA, \"Coarse sand (with shell fragments)\", NA, NA, NA, N… ## $ scientific <chr> NA, \"Thalassodendron spp\", NA, NA, NA, \"Thalassodendron spp… relief <- points %>%   dplyr::filter(relief_annotated %in% \"yes\") %>%   dplyr::select(campaignid, sample, starts_with(\"level\"), scientific) %>%   glimpse() ## Rows: 1,242 ## Columns: 7 ## $ campaignid <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"20… ## $ sample     <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\",… ## $ level_2    <chr> NA, \"Relief\", \"Relief\", \"Relief\", NA, \"Relief\", \"Relief\", \"… ## $ level_3    <chr> NA, \"High\", \"High\", \"High\", NA, \"High\", \"Low / moderate\", \"… ## $ level_4    <chr> NA, \"High (>3m)\", \"High (>3m)\", \"High (>3m)\", NA, \"High (>3… ## $ level_5    <chr> NA, \"3\", \"3\", \"3\", NA, \"3\", \"2\", \"3\", NA, \"3\", \"2\", \"2\", NA… ## $ scientific <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/check-habitat.html","id":"check-the-data-for-a-variety-of-errors","dir":"Articles > R-workflows","previous_headings":"","what":"Check the data for a variety of errors","title":"Checking habitat data exported from TransectMeasure","text":"Set number expected annotations check . Check habitat annotations unexpected number annotation points. Check habitat annotations unexpected number annotation points. Check see samples habitat don’t match metadata. Check see samples metadata don’t matching habitat.","code":"num.points <- 20 wrong.points.habitat <- habitat %>%   group_by(campaignid, sample) %>%   summarise(points.annotated = n()) %>%   left_join(metadata) %>%   dplyr::mutate(expected = case_when(successful_habitat_forward %in% \"Yes\" & successful_habitat_backward %in% \"Yes\" ~ num.points * 2, successful_habitat_forward %in% \"Yes\" & successful_habitat_backward %in% \"No\" ~ num.points * 1, successful_habitat_forward %in% \"No\" & successful_habitat_backward %in% \"Yes\" ~ num.points * 1, successful_habitat_forward %in% \"No\" & successful_habitat_backward %in% \"No\" ~ num.points * 0)) %>%   dplyr::filter(!points.annotated == expected) %>%   glimpse() ## `summarise()` has grouped output by 'campaignid'. You can override using the ## `.groups` argument. ## Joining with `by = join_by(campaignid, sample)` ## Rows: 5 ## Columns: 14 ## Groups: campaignid [1] ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"21\", \"3\", \"37\", \"45\", \"47\" ## $ points.annotated            <int> 20, 41, 20, 20, 20 ## $ longitude_dd                <chr> \"114.857485\", \"114.9156417\", \"114.9235817\"… ## $ latitude_dd                 <chr> \"-34.06438333\", \"-34.10734167\", \"-34.10853… ## $ date_time                   <chr> \"18/03/2023 2:34\", \"15/03/2023 1:54\", \"15/… ## $ location                    <chr> NA, NA, NA, NA, NA ## $ site                        <chr> NA, NA, NA, NA, NA ## $ depth                       <chr> \"42.3\", \"46.7\", \"46.1\", \"61.9\", \"73\" ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\" ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\" ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\" ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\" ## $ expected                    <dbl> 40, 40, 40, 40, 40 wrong.points.relief <- relief %>%   group_by(campaignid, sample) %>%   summarise(points.annotated = n()) %>%   left_join(metadata) %>%   dplyr::mutate(expected = case_when(successful_habitat_forward %in% \"Yes\" & successful_habitat_backward %in% \"Yes\" ~ num.points * 2, successful_habitat_forward %in% \"Yes\" & successful_habitat_backward %in% \"No\" ~ num.points * 1, successful_habitat_forward %in% \"No\" & successful_habitat_backward %in% \"Yes\" ~ num.points * 1, successful_habitat_forward %in% \"No\" & successful_habitat_backward %in% \"No\" ~ num.points * 0)) %>%   dplyr::filter(!points.annotated == expected) %>%   glimpse() ## `summarise()` has grouped output by 'campaignid'. You can override using the ## `.groups` argument. ## Joining with `by = join_by(campaignid, sample)` ## Rows: 4 ## Columns: 14 ## Groups: campaignid [1] ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"17\", \"21\", \"23\", \"47\" ## $ points.annotated            <int> 41, 20, 41, 20 ## $ longitude_dd                <chr> \"114.85758\", \"114.857485\", \"114.9189517\", … ## $ latitude_dd                 <chr> \"-34.09634667\", \"-34.06438333\", \"-34.12832… ## $ date_time                   <chr> \"15/03/2023 3:00\", \"18/03/2023 2:34\", \"15/… ## $ location                    <chr> NA, NA, NA, NA ## $ site                        <chr> NA, NA, NA, NA ## $ depth                       <chr> \"43.3\", \"42.3\", \"41\", \"73\" ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\" ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\" ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\" ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\" ## $ expected                    <dbl> 40, 40, 40, 40 habitat.missing.metadata <- anti_join(habitat, metadata, by = c(\"campaignid\", \"sample\")) %>%   glimpse() ## Rows: 40 ## Columns: 7 ## $ campaignid <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"20… ## $ sample     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,… ## $ level_2    <chr> \"Substrate\", \"Substrate\", \"Substrate\", \"Substrate\", \"Substr… ## $ level_3    <chr> \"Unconsolidated (soft)\", \"Unconsolidated (soft)\", \"Unconsol… ## $ level_4    <chr> \"Sand / mud (<2mm)\", \"Sand / mud (<2mm)\", \"Sand / mud (<2mm… ## $ level_5    <chr> \"Coarse sand (with shell fragments)\", \"Coarse sand (with sh… ## $ scientific <chr> NA, NA, NA, NA, NA, NA, NA, NA, \"Thalassodendron spp\", NA, … metadata.missing.habitat <- anti_join(metadata, habitat, by = c(\"campaignid\", \"sample\")) %>%   glimpse() ## Rows: 0 ## Columns: 12 ## $ campaignid                  <chr>  ## $ sample                      <chr>  ## $ longitude_dd                <chr>  ## $ latitude_dd                 <chr>  ## $ date_time                   <chr>  ## $ location                    <chr>  ## $ site                        <chr>  ## $ depth                       <chr>  ## $ successful_count            <chr>  ## $ successful_length           <chr>  ## $ successful_habitat_forward  <chr>  ## $ successful_habitat_backward <chr>"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/check-habitat.html","id":"format-and-save-the-final-tidy-dataset","dir":"Articles > R-workflows","previous_headings":"","what":"Format and save the final tidy dataset","title":"Checking habitat data exported from TransectMeasure","text":"Tidy habitat data joining complete schema file loaded CheckEM package. Save tidy habitat data R data file. Tidy relief data joining complete schema file loaded CheckEM package. Save tidy relief data R data file.","code":"tidy.habitat <- habitat %>%   dplyr::mutate(number = 1) %>%                                        left_join(catami) %>%   dplyr::select(campaignid, sample, number, starts_with(\"level\"), family, genus, species) %>%   dplyr::filter(!level_2 %in% c(\"\",\"Unscorable\", NA)) %>%     group_by(campaignid, sample, across(starts_with(\"level\")), family, genus, species) %>%   dplyr::tally(number, name = \"number\") %>%   ungroup() %>%                                                        dplyr::select(campaignid, sample, level_1, everything()) %>%   glimpse() ## Joining with `by = join_by(level_2, level_3, level_4, level_5)` ## Warning in left_join(., catami): Detected an unexpected many-to-many relationship between `x` and `y`. ## ℹ Row 2 of `x` matches multiple rows in `y`. ## ℹ Row 193 of `y` matches multiple rows in `x`. ## ℹ If a many-to-many relationship is expected, set `relationship = ##   \"many-to-many\"` to silence this warning. ## Rows: 489 ## Columns: 14 ## $ campaignid <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"20… ## $ sample     <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\",… ## $ level_1    <chr> \"Biota\", \"Biota\", \"Biota\", \"Biota\", \"Biota\", \"Biota\", \"Biot… ## $ level_2    <chr> \"Macroalgae\", \"Macroalgae\", \"Macroalgae\", \"Macroalgae\", \"Se… ## $ level_3    <chr> \"Erect coarse branching\", \"Erect coarse branching\", \"Erect … ## $ level_4    <chr> \"Brown\", \"Red\", \"Red\", \"Red\", NA, NA, NA, NA, NA, NA, \"Lami… ## $ level_5    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, \"Coarse san… ## $ level_6    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,… ## $ level_7    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,… ## $ level_8    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,… ## $ family     <chr> NA, NA, NA, NA, \"Cymodoceaceae\", \"Cymodoceaceae\", \"Posidoni… ## $ genus      <chr> NA, NA, NA, NA, \"Amphibolis\", \"Thalassodendron\", \"Posidonia… ## $ species    <chr> NA, NA, NA, NA, \"spp\", \"spp\", \"spp\", \"spp\", \"spp\", NA, NA, … ## $ number     <dbl> 2, 3, 2, 1, 14, 14, 14, 14, 14, 14, 1, 1, 3, 5, 8, 1, 2, 3,… saveRDS(tidy.habitat, file = here::here(paste0(\"r-workflows/data/staging/\", name, \"_habitat.rds\"))) tidy.relief <- relief %>%   dplyr::select(campaignid, sample, starts_with(\"level\"), scientific) %>%   dplyr::filter(!level_2 %in% c(\"\",\"Unscorable\", NA)) %>%                 dplyr::mutate(number = 1) %>%    left_join(catami) %>%   group_by(campaignid, sample, across(starts_with(\"level\"))) %>%    dplyr::tally(number, name = \"number\") %>%   ungroup() %>%                                                        glimpse() ## Joining with `by = join_by(level_2, level_3, level_4, level_5)` ## Rows: 73 ## Columns: 11 ## $ campaignid <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"20… ## $ sample     <chr> \"10\", \"10\", \"10\", \"12\", \"12\", \"14\", \"14\", \"14\", \"15\", \"15\",… ## $ level_2    <chr> \"Relief\", \"Relief\", \"Relief\", \"Relief\", \"Relief\", \"Relief\",… ## $ level_3    <chr> \"High\", \"High\", \"Low / moderate\", \"High\", \"Low / moderate\",… ## $ level_4    <chr> \"High (>3m)\", \"Wall\", \"Moderate (1-3m)\", \"High (>3m)\", \"Mod… ## $ level_5    <chr> \"3\", \"4\", \"2\", \"3\", \"2\", \"3\", \"1\", \"2\", \"3\", \"4\", \"1\", \"2\",… ## $ level_1    <chr> \"Physical\", \"Physical\", \"Physical\", \"Physical\", \"Physical\",… ## $ level_6    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,… ## $ level_7    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,… ## $ level_8    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,… ## $ number     <dbl> 8, 10, 5, 17, 4, 14, 3, 8, 16, 1, 4, 6, 20, 2, 13, 6, 14, 1… saveRDS(tidy.relief, file = here::here(paste0(\"r-workflows/data/staging/\", name, \"_relief.rds\")))"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/fish-modelling.html","id":"r-setup","dir":"Articles > R-workflows","previous_headings":"","what":"R setup","title":"Generate spatial predictions of fish using FSSgam","text":"Load libraries. packages available CRAN, aside ‘FSSgam’, can installed following instructions provided GitHub repository https://github.com/beckyfisher/FSSgam. Set study name. Study names used throughout make reproducible code can easily shifted different campaigns projects still providing meaningful filenames. Load fish count data. data created previous workflow, ‘Format & visualise fish data’.","code":"library(CheckEM) library(tidyverse) library(mgcv) library(devtools) library(FSSgam) library(here) library(ggplot2) library(ggnewscale) library(viridis) library(terra) library(sf) library(patchwork) name <- 'example-bruv-workflow' tidy.count <- readRDS(here::here(paste0('r-workflows/data/tidy/',                        name,'_tidy-count.rds'))) %>%   glimpse() ## Rows: 64 ## Columns: 17 ## $ campaignid   <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"… ## $ sample       <chr> \"10\", \"10\", \"12\", \"12\", \"14\", \"14\", \"15\", \"15\", \"16\", \"16… ## $ response     <chr> \"total_abundance\", \"species_richness\", \"total_abundance\",… ## $ number       <dbl> 111, 13, 94, 15, 191, 9, 146, 16, 99, 14, 312, 18, 41, 14… ## $ longitude_dd <dbl> 114.8533, 114.8533, 114.8816, 114.8816, 114.8686, 114.868… ## $ latitude_dd  <dbl> -34.08387, -34.08387, -34.13249, -34.13249, -34.07530, -3… ## $ depth        <chr> \"44.3\", \"44.3\", \"42.6\", \"42.6\", \"42.7\", \"42.7\", \"45.3\", \"… ## $ mbdepth      <dbl> -42.77519, -42.77519, -42.02835, -42.02835, -41.07679, -4… ## $ slope        <dbl> 0.005708777, 0.005708777, 0.013768068, 0.013768068, 0.078… ## $ aspect       <dbl> 72.31942, 72.31942, 110.35012, 110.35012, 215.54254, 215.… ## $ tpi          <dbl> 0.05208921, 0.05208921, 0.03892708, 0.03892708, 0.2611088… ## $ tri          <dbl> 0.05208921, 0.05208921, 0.06246567, 0.06246567, 0.3096442… ## $ roughness    <dbl> 0.11757660, 0.11757660, 0.30690765, 0.30690765, 0.7959022… ## $ detrended    <dbl> -2.8542883, -2.8542883, -5.8822656, -5.8822656, -6.646017… ## $ mean_relief  <dbl> 3.217391, 3.217391, 2.809524, 2.809524, 2.440000, 2.44000… ## $ sd_relief    <dbl> 0.7952428, 0.7952428, 0.4023739, 0.4023739, 0.7118052, 0.… ## $ reef         <dbl> 0.8888889, 0.8888889, 1.0000000, 1.0000000, 0.9322034, 0.…"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/fish-modelling.html","id":"set-up-data-for-modelling","dir":"Articles > R-workflows","previous_headings":"","what":"Set up data for modelling","title":"Generate spatial predictions of fish using FSSgam","text":"Set potential predictor variables may used explain patterns found response variables. important select ecologically meaningful variables influence chosen response variable. Create correlation matrix assess correlations predictor variables. variables correlation greater 0.95, one variables included model selection. example dataset, ‘roughness’, ‘slope’ ‘tri’ highly correlated, include roughness final predictor variable. Plot individual predictors assess transformations necessary. suggest use transformations absolutely necessary. example dataset, response variables relatively balanced distributions, therefor left untransformed. important note example dataset, spread predictor variables across full range ideal, gaps key predictors depth detrended bathymetry. working GAMs, gaps outliers like may create spurious relationships, therefor suggest running scripts complete data small example dataset provided .  Reset predictor variables remove highly correlated variables include transformed variables. Check make sure response variables less 80% zeroes. Full-subset GAM modelling produce unreliable results data zero inflated. Add directory save model outputs, set R environment model selection.","code":"pred.vars <- c(\"mbdepth\", \"roughness\", \"slope\", \"detrended\",                \"tpi\", \"tri\", \"aspect\", \"reef\") round(cor(tidy.count[ , pred.vars]), 2) ##           mbdepth roughness slope detrended   tpi   tri aspect  reef ## mbdepth      1.00     -0.66 -0.65     -0.89  0.03 -0.59  -0.32 -0.20 ## roughness   -0.66      1.00  0.99      0.48  0.29  0.99   0.06  0.23 ## slope       -0.65      0.99  1.00      0.47  0.29  0.99   0.06  0.22 ## detrended   -0.89      0.48  0.47      1.00  0.00  0.42   0.39  0.36 ## tpi          0.03      0.29  0.29      0.00  1.00  0.35  -0.02  0.04 ## tri         -0.59      0.99  0.99      0.42  0.35  1.00   0.04  0.24 ## aspect      -0.32      0.06  0.06      0.39 -0.02  0.04   1.00  0.01 ## reef        -0.20      0.23  0.22      0.36  0.04  0.24   0.01  1.00 CheckEM::plot_transformations(pred.vars = pred.vars, dat = tidy.count) pred.vars <- c(\"mbdepth\", \"roughness\", \"detrended\",                \"tpi\", \"aspect\", \"reef\") unique.vars <- unique(as.character(tidy.count$response))  resp.vars <- character() for(i in 1:length(unique.vars)){   temp.dat <- tidy.count[which(tidy.count$response == unique.vars[i]), ]   if(length(which(temp.dat$number == 0)) / nrow(temp.dat) < 0.8){     resp.vars <- c(resp.vars, unique.vars[i])} } resp.vars ## [1] \"total_abundance\"  \"species_richness\" outdir <- (\"r-workflows/model output/fish/\")  out.all <- list() var.imp <- list()"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/fish-modelling.html","id":"run-the-full-subset-model-selection-process-for-count-metrics","dir":"Articles > R-workflows","previous_headings":"","what":"Run the full subset model selection process for count metrics","title":"Generate spatial predictions of fish using FSSgam","text":"loop adapted @beckyfisher/FSSgam, examples documentation available GitHub Fisher, R, Wilson, SK, Sin, TM, Lee, AC, Langlois, TJ. simple function full-subsets multiple regression ecology R. Ecol Evol. 2018; 8: 6104–6113. https://doi.org/10.1002/ece3.4134. Tidy model fits importance scores. combined models fits importance scores model selection lenght metrics. Load fish length data. data created previous workflow, ‘Format & visualise fish data’. Check make sure response variables less 80% zeroes. Full-subset GAM modelling produce unreliable results data zero inflated. Set R environment model selection.","code":"for(i in 1:length(resp.vars)){   use.dat = as.data.frame(tidy.count[which(tidy.count$response == resp.vars[i]),])   print(resp.vars[i])    Model1  <- gam(number ~ s(mbdepth, k = 3, bs = 'cr'),                  family = gaussian(link = \"identity\"),  data = use.dat)      model.set <- generate.model.set(use.dat = use.dat,                                test.fit = Model1,                                pred.vars.cont = pred.vars,                                factor.smooth.interactions = NA,                                k = 3)   out.list <- fit.model.set(model.set,                          max.models = 600,                          parallel = T)   names(out.list)      out.list$failed.models    mod.table = out.list$mod.data.out    mod.table = mod.table[order(mod.table$AICc),]   mod.table$cumsum.wi = cumsum(mod.table$wi.AICc)   out.i = mod.table[which(mod.table$delta.AICc <= 2),]   out.all = c(out.all,list(out.i))   var.imp = c(var.imp,list(out.list$variable.importance$aic$variable.weights.raw))      for(m in 1:nrow(out.i)){     best.model.name = as.character(out.i$modname[m])     png(file = here::here(paste(outdir, paste(name, m, resp.vars[i], \"mod_fits.png\", sep = \"_\"), sep = \"/\")))     if(best.model.name != \"null\"){       par(mfrow = c(3,1), mar = c(9, 4, 3, 1))       best.model = out.list$success.models[[best.model.name]]       plot(best.model, all.terms = T,pages = 1,residuals = T,pch = 16)       mtext(side = 2, text = resp.vars[i], outer = F)}       dev.off()   } } names(out.all) <- resp.vars names(var.imp) <- resp.vars all.mod.fits <- list_rbind(out.all, names_to = \"response\") all.var.imp  <- as.data.frame(do.call(\"rbind\", var.imp)) tidy.length <- readRDS(here::here(paste0('r-workflows/data/tidy/',                        name,'_tidy-length.rds'))) %>%   glimpse() ## Rows: 64 ## Columns: 18 ## $ campaignid   <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"… ## $ sample       <chr> \"15\", \"17\", \"19\", \"23\", \"24\", \"26\", \"29\", \"3\", \"31\", \"32\"… ## $ number       <dbl> 1, 1, 8, 3, 2, 3, 4, 1, 4, 6, 1, 3, 1, 2, 4, 2, 6, 1, 13,… ## $ status       <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"N… ## $ response     <chr> \"greater than Lm\", \"greater than Lm\", \"greater than Lm\", … ## $ longitude_dd <dbl> 114.8444, 114.8576, 114.7822, 114.9190, 114.8485, 114.928… ## $ latitude_dd  <dbl> -34.08478, -34.09635, -34.12047, -34.12832, -34.11789, -3… ## $ depth        <chr> \"45.3\", \"43.3\", \"73.6\", \"41\", \"45.6\", \"36\", \"42.6\", \"46.7… ## $ mbdepth      <dbl> -44.29804, -42.74676, -71.60112, -38.25594, -44.23959, -4… ## $ slope        <dbl> 0.108975978, 0.008719478, 0.880997142, 0.444838455, 0.103… ## $ aspect       <dbl> 264.03427, 30.76545, 262.35388, 294.10675, 257.20307, 40.… ## $ tpi          <dbl> -0.19527912, 0.02505112, 1.04176044, 0.47694588, 0.042278… ## $ tri          <dbl> 0.34487247, 0.03473282, 2.80258274, 1.83670998, 0.3347983… ## $ roughness    <dbl> 0.91366196, 0.09923935, 9.01136017, 5.30128479, 1.2933082… ## $ detrended    <dbl> -0.2281526, -3.1375041, 17.9911461, -8.6934719, 2.9724391… ## $ mean_relief  <dbl> 2.518519, 3.333333, 2.583333, 3.555556, 3.360000, 4.00000… ## $ sd_relief    <dbl> 0.8024180, 0.9128709, 0.5036102, 0.8555853, 0.4898979, 0.… ## $ reef         <dbl> 0.7741935, 1.0000000, 0.9493671, 1.0000000, 1.0000000, 1.… unique.vars <- unique(as.character(tidy.length$response))  resp.vars <- character() for(i in 1:length(unique.vars)){   temp.dat <- tidy.length[which(tidy.length$response == unique.vars[i]), ]   if(length(which(temp.dat$number == 0)) / nrow(temp.dat) < 0.8){     resp.vars <- c(resp.vars, unique.vars[i])} } resp.vars ## [1] \"greater than Lm\" out.all = list() var.imp = list()"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/fish-modelling.html","id":"run-the-full-subset-model-selection-process-for-length-metrics","dir":"Articles > R-workflows","previous_headings":"","what":"Run the full subset model selection process for length metrics","title":"Generate spatial predictions of fish using FSSgam","text":"loop adapted @beckyfisher/FSSgam, examples documentation available GitHub Fisher, R, Wilson, SK, Sin, TM, Lee, AC, Langlois, TJ. simple function full-subsets multiple regression ecology R. Ecol Evol. 2018; 8: 6104–6113. https://doi.org/10.1002/ece3.4134. Combine model fits importance scores previously created full subsets modelling count metrics, save files. Combine count length data easy spatial prediction. Read bathymetry derivatives.  Transform spatial bathymetry derivatives dataframe predict onto. Manually set best model full subsets model selection process. select ‘best’ model parsimonious model within 2 AICc lowest AICc. suggest select models using statistically rigorous criteria best suits analysis project.    Predict response variables across extent bathymetry derivatives. Save spatial predictions. computer crashes way don’t need run whole script . Pivot data long format easy plotting. Reset response variables loop plotting. Load marine park data. dataset used 2022 Collaborative Australian Protected Areas Database, available free download https://fed.dcceew.gov.au/datasets/782c02c691014efe8ffbd27445fe41d7_0/explore. Feel free replace shapefile suitable dataset available study area. Loop response variable create ggplot figure . Combine plots using patchwork.","code":"for(i in 1:length(resp.vars)){   use.dat = as.data.frame(tidy.length[which(tidy.length$response == resp.vars[i]),])   print(resp.vars[i])    Model1  <- gam(number ~ s(mbdepth, k = 3, bs = 'cr'),                  family = tw(),  data = use.dat)      model.set <- generate.model.set(use.dat = use.dat,                                test.fit = Model1,                                pred.vars.cont = pred.vars,                                factor.smooth.interactions = NA,                                k = 3                                )   out.list <- fit.model.set(model.set,                          max.models = 600,                          parallel = T)   names(out.list)      out.list$failed.models   mod.table = out.list$mod.data.out   mod.table = mod.table[order(mod.table$AICc),]   mod.table$cumsum.wi = cumsum(mod.table$wi.AICc)   out.i = mod.table[which(mod.table$delta.AICc<=2),]   out.all = c(out.all, list(out.i))   var.imp = c(var.imp, list(out.list$variable.importance$aic$variable.weights.raw))      for(m in 1:nrow(out.i)){     best.model.name = as.character(out.i$modname[m])     png(file = here::here(paste(outdir, paste(name, m, resp.vars[i], \"mod_fits.png\", sep = \"_\"), sep = \"/\")))     if(best.model.name != \"null\"){       par(mfrow = c(3,1), mar = c(9, 4, 3, 1))       best.model = out.list$success.models[[best.model.name]]       plot(best.model, all.terms = T, pages = 1, residuals = T, pch = 16)       mtext(side = 2, text = resp.vars[i], outer = F)}       dev.off()   } } names(out.all) <- resp.vars names(var.imp) <- resp.vars all.mod.fits <- bind_rows(all.mod.fits, list_rbind(out.all, names_to = \"response\")) all.var.imp  <- bind_rows(all.var.imp, as.data.frame(do.call(\"rbind\",var.imp))) write.csv(all.mod.fits[ , -2], file = here::here(paste0(outdir, name, \"_all.mod.fits.csv\"))) write.csv(all.var.imp,         file = here::here(paste0(outdir, name, \"_all.var.imp.csv\"))) dat <- bind_rows(tidy.count, tidy.length) %>%   glimpse() ## Rows: 128 ## Columns: 18 ## $ campaignid   <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"… ## $ sample       <chr> \"10\", \"10\", \"12\", \"12\", \"14\", \"14\", \"15\", \"15\", \"16\", \"16… ## $ response     <chr> \"total_abundance\", \"species_richness\", \"total_abundance\",… ## $ number       <dbl> 111, 13, 94, 15, 191, 9, 146, 16, 99, 14, 312, 18, 41, 14… ## $ longitude_dd <dbl> 114.8533, 114.8533, 114.8816, 114.8816, 114.8686, 114.868… ## $ latitude_dd  <dbl> -34.08387, -34.08387, -34.13249, -34.13249, -34.07530, -3… ## $ depth        <chr> \"44.3\", \"44.3\", \"42.6\", \"42.6\", \"42.7\", \"42.7\", \"45.3\", \"… ## $ mbdepth      <dbl> -42.77519, -42.77519, -42.02835, -42.02835, -41.07679, -4… ## $ slope        <dbl> 0.005708777, 0.005708777, 0.013768068, 0.013768068, 0.078… ## $ aspect       <dbl> 72.31942, 72.31942, 110.35012, 110.35012, 215.54254, 215.… ## $ tpi          <dbl> 0.05208921, 0.05208921, 0.03892708, 0.03892708, 0.2611088… ## $ tri          <dbl> 0.05208921, 0.05208921, 0.06246567, 0.06246567, 0.3096442… ## $ roughness    <dbl> 0.11757660, 0.11757660, 0.30690765, 0.30690765, 0.7959022… ## $ detrended    <dbl> -2.8542883, -2.8542883, -5.8822656, -5.8822656, -6.646017… ## $ mean_relief  <dbl> 3.217391, 3.217391, 2.809524, 2.809524, 2.440000, 2.44000… ## $ sd_relief    <dbl> 0.7952428, 0.7952428, 0.4023739, 0.4023739, 0.7118052, 0.… ## $ reef         <dbl> 0.8888889, 0.8888889, 1.0000000, 1.0000000, 0.9322034, 0.… ## $ status       <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N… preds  <- readRDS(here::here(paste0(\"r-workflows/data/spatial/rasters/\",                           name, \"_bathymetry_derivatives.rds\"))) plot(preds) preddf <- as.data.frame(preds, xy = TRUE, na.rm = TRUE) %>%   clean_names() %>%   glimpse() ## Rows: 73,350 ## Columns: 9 ## $ x         <dbl> 115.1714, 115.1739, 115.1764, 115.1789, 115.1814, 115.1839, … ## $ y         <dbl> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33.6… ## $ mbdepth   <dbl> -14.83014, -13.89184, -14.18757, -14.48647, -14.47323, -14.3… ## $ slope     <dbl> 0.24350203, 0.19746646, 0.17799167, 0.18316828, 0.22091857, … ## $ aspect    <dbl> 339.995240, 341.597571, 21.180346, 12.600024, 356.337121, 35… ## $ tpi       <dbl> -3.721524e-01, 5.277313e-01, 1.502453e-01, -1.123428e-03, 9.… ## $ tri       <dbl> 0.9656481, 0.8277034, 0.6934198, 0.6945946, 0.8081013, 0.902… ## $ roughness <dbl> 2.807414, 2.421717, 2.196986, 2.156502, 2.581898, 2.606502, … ## $ detrended <dbl> -2.871674, -2.161609, -2.683798, -3.207528, -3.417629, -3.56… # Indicator species greater than size of maturity m_mature <- gam(number ~                   s(aspect, k = 3, bs = \"cr\") +                   s(tpi, k = 3, bs = \"cr\"),                 data = dplyr::filter(dat, response %in% \"greater than Lm\"),                 family = tw()) summary(m_mature) ##  ## Family: Tweedie(p=1.269)  ## Link function: log  ##  ## Formula: ## number ~ s(aspect, k = 3, bs = \"cr\") + s(tpi, k = 3, bs = \"cr\") ##  ## Parametric coefficients: ##             Estimate Std. Error t value Pr(>|t|)    ## (Intercept)   0.6895     0.2203    3.13    0.004 ** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##             edf Ref.df     F p-value   ## s(aspect) 1.000  1.000 4.192  0.0498 * ## s(tpi)    1.361  1.591 0.393  0.7185   ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## R-sq.(adj) =  0.021   Deviance explained = 12.7% ## -REML = 61.763  Scale est. = 2.425     n = 32 plot(m_mature, pages = 1, residuals = T, cex = 5) # Total abundance m_totabund <- gam(number ~                    s(detrended, k = 3, bs = \"cr\"),                  data = dplyr::filter(dat, response %in% \"total_abundance\"),                  family = gaussian(link = \"identity\")) summary(m_totabund) ##  ## Family: gaussian  ## Link function: identity  ##  ## Formula: ## number ~ s(detrended, k = 3, bs = \"cr\") ##  ## Parametric coefficients: ##             Estimate Std. Error t value Pr(>|t|)     ## (Intercept)   131.59      13.24   9.942 5.24e-11 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##              edf Ref.df     F p-value    ## s(detrended)   1      1 8.448 0.00681 ** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## R-sq.(adj) =  0.194   Deviance explained =   22% ## GCV = 5980.1  Scale est. = 5606.4    n = 32 plot(m_totabund, pages = 1, residuals = T, cex = 5) # Species richness m_specrich <- gam(number ~                      s(mbdepth, k = 3, bs = \"cr\"),                    data = dplyr::filter(dat, response %in% \"species_richness\"),                    family = gaussian(link = \"identity\")) summary(m_specrich) ##  ## Family: gaussian  ## Link function: identity  ##  ## Formula: ## number ~ s(mbdepth, k = 3, bs = \"cr\") ##  ## Parametric coefficients: ##             Estimate Std. Error t value Pr(>|t|)     ## (Intercept)  14.2500     0.6553   21.75   <2e-16 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##            edf Ref.df     F p-value ## s(mbdepth)   1      1 2.458   0.127 ##  ## R-sq.(adj) =  0.0449   Deviance explained = 7.57% ## GCV = 14.657  Scale est. = 13.741    n = 32 plot(m_specrich, pages = 1, residuals = T, cex = 5) preddf <- cbind(preddf,                  \"pmature\" = predict(m_mature, preddf, type = \"response\"),                 \"ptotabund\" = predict(m_totabund, preddf, type = \"response\"),                 \"pspecrich\" = predict(m_specrich, preddf, type = \"response\")) %>%   glimpse() ## Rows: 73,350 ## Columns: 12 ## $ x         <dbl> 115.1714, 115.1739, 115.1764, 115.1789, 115.1814, 115.1839, … ## $ y         <dbl> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33.6… ## $ mbdepth   <dbl> -14.83014, -13.89184, -14.18757, -14.48647, -14.47323, -14.3… ## $ slope     <dbl> 0.24350203, 0.19746646, 0.17799167, 0.18316828, 0.22091857, … ## $ aspect    <dbl> 339.995240, 341.597571, 21.180346, 12.600024, 356.337121, 35… ## $ tpi       <dbl> -3.721524e-01, 5.277313e-01, 1.502453e-01, -1.123428e-03, 9.… ## $ tri       <dbl> 0.9656481, 0.8277034, 0.6934198, 0.6945946, 0.8081013, 0.902… ## $ roughness <dbl> 2.807414, 2.421717, 2.196986, 2.156502, 2.581898, 2.606502, … ## $ detrended <dbl> -2.871674, -2.161609, -2.683798, -3.207528, -3.417629, -3.56… ## $ pmature   <dbl> 4.6062374, 3.5770040, 0.6489945, 0.6475193, 4.1814433, 4.152… ## $ ptotabund <dbl> 141.0566, 138.7161, 140.4373, 142.1637, 142.8562, 143.3297, … ## $ pspecrich <dbl> 17.35890, 17.44649, 17.41888, 17.39098, 17.39222, 17.39953, … saveRDS(preddf, file = here::here(paste0(\"r-workflows/model output/fish/\",                                name, \"_fish-prediction.RDS\"))) dat <- preddf %>%   dplyr::select(x, y, starts_with(\"p\")) %>%   pivot_longer(names_to = \"response\", values_to = \"value\",                cols = !c(x, y)) %>%   glimpse() ## Rows: 220,050 ## Columns: 4 ## $ x        <dbl> 115.1714, 115.1714, 115.1714, 115.1739, 115.1739, 115.1739, 1… ## $ y        <dbl> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33.60… ## $ response <chr> \"pmature\", \"ptotabund\", \"pspecrich\", \"pmature\", \"ptotabund\", … ## $ value    <dbl> 4.6062374, 141.0566210, 17.3588980, 3.5770040, 138.7160753, 1… resp.vars <- unique(dat$response) marine.parks <- st_read(here::here(\"r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp\")) %>%   st_make_valid() %>%   dplyr::mutate(ZONE_TYPE = str_replace_all(ZONE_TYPE,                                              \"\\\\s*\\\\([^\\\\)]+\\\\)\", \"\")) %>%   dplyr::filter(str_detect(ZONE_TYPE, \"Sanctuary|National Park\"),                 STATE %in% \"WA\") %>%                           st_transform(4326) ## Reading layer `Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine' from data source `/home/runner/work/CheckEM/CheckEM/r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp'  ##   using driver `ESRI Shapefile' ## Simple feature collection with 3775 features and 26 fields ## Geometry type: MULTIPOLYGON ## Dimension:     XY ## Bounding box:  xmin: 70.71702 ymin: -58.44947 xmax: 170.3667 ymax: -8.473407 ## Geodetic CRS:  WGS 84 for (i in 1:length(resp.vars)) {   use.dat <- dat %>%     dplyr::filter(response %in% resp.vars[i])      p <- ggplot() +     geom_tile(data = use.dat, aes(x, y, fill = value)) +     scale_fill_gradientn(colours = c(\"#fde725\", \"#21918c\", \"#440154\"), na.value = \"transparent\") +     labs(fill = resp.vars[i], x = NULL, y = NULL) +     new_scale_fill() +                          geom_sf(data = marine.parks, fill = NA, colour = \"#7bbc63\",              size = 0.2, show.legend = F) +     coord_sf(xlim = c(min(dat$x), max(dat$x)),              ylim = c(min(dat$y), max(dat$y))) +     theme_minimal() +     theme(axis.text.x = element_text(size = 7))   assign(paste0(\"gg_\", resp.vars[i]), p) } gg_pmature + gg_ptotabund + gg_pspecrich +   theme(legend.justification = \"left\") +   plot_layout(ncol = 2, nrow = 2)"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-fish.html","id":"r-set-up","dir":"Articles > R-workflows","previous_headings":"","what":"R set up","title":"Format & visualise fish data","text":"Load necessary libraries. Set study name.","code":"library(CheckEM) library(tidyverse) library(ggplot2) library(sf) library(here) library(leaflet) name <- \"example-bruv-workflow\""},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-fish.html","id":"read-in-the-data","dir":"Articles > R-workflows","previous_headings":"","what":"Read in the data","title":"Format & visualise fish data","text":"Load format metadata. Load format habitat data. create ‘reef’ column consists reef-forming habitat found study area, used subsequent fish modelling scripts. Load length maturity data. maturity dataset loaded package installed. Load format maxn data, transform total abundance species richness. two response variables used subsequent fish modelling scripts. Load format length data.","code":"metadata.bathy.derivatives <- readRDS(here::here(paste0(\"r-workflows/data/tidy/\", name, \"_metadata-bathymetry-derivatives.rds\"))) %>%   glimpse() ## Rows: 32 ## Columns: 22 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", \"3… ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:49\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\", … ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ x                           <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ y                           <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ longitude_dd                <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ latitude_dd                 <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ ID                          <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,… ## $ mbdepth                     <dbl> -34.97151, -36.35807, -40.68553, -38.25594… ## $ slope                       <dbl> 0.146843375, 0.812689749, 0.694289634, 0.4… ## $ aspect                      <dbl> 209.89577, 62.41434, 40.87387, 294.10675, … ## $ TPI                         <dbl> 0.42153454, 2.39535522, -0.67607403, 0.476… ## $ TRI                         <dbl> 0.75557327, 3.29823494, 2.39221191, 1.8367… ## $ roughness                   <dbl> 2.21119308, 8.36493301, 8.36493301, 5.3012… ## $ detrended                   <dbl> -5.6631737, -7.0394716, -11.2637815, -8.69… habitat <- readRDS(here::here(paste0(\"r-workflows/data/tidy/\", name, \"_tidy-habitat.rds\"))) %>%   dplyr::mutate(number = number / total_points_annotated) %>%   dplyr::select(campaignid, sample, longitude_dd, latitude_dd, depth, mbdepth, slope, aspect, tpi, tri, roughness, detrended, habitat, number, mean_relief, sd_relief) %>%   pivot_wider(names_from = habitat, values_from = number, values_fill = 0) %>%   CheckEM::clean_names() %>%   dplyr::mutate(reef = consolidated_hard + macroalgae + seagrasses + sessile_invertebrates) %>%              dplyr::select(-c(consolidated_hard, macroalgae, seagrasses, sessile_invertebrates, unconsolidated_soft)) %>%   glimpse() ## Rows: 32 ## Columns: 15 ## $ campaignid   <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"… ## $ sample       <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", \"37\", \"3\", \"2\", \"… ## $ longitude_dd <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 114.9105, 114.911… ## $ latitude_dd  <dbl> -34.13155, -34.12953, -34.12729, -34.12832, -34.12296, -3… ## $ depth        <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\", \"44.4\", \"46.1\",… ## $ mbdepth      <dbl> -34.97151, -36.35807, -40.68553, -38.25594, -39.91339, -4… ## $ slope        <dbl> 0.146843375, 0.812689749, 0.694289634, 0.444838455, 0.322… ## $ aspect       <dbl> 209.89577, 62.41434, 40.87387, 294.10675, 307.15484, 319.… ## $ tpi          <dbl> 0.42153454, 2.39535522, -0.67607403, 0.47694588, 0.875010… ## $ tri          <dbl> 0.75557327, 3.29823494, 2.39221191, 1.83670998, 1.3206706… ## $ roughness    <dbl> 2.21119308, 8.36493301, 8.36493301, 5.30128479, 3.3831062… ## $ detrended    <dbl> -5.6631737, -7.0394716, -11.2637815, -8.6934719, -9.84557… ## $ mean_relief  <dbl> 3.034483, 3.900000, 4.000000, 3.555556, 4.000000, 3.76190… ## $ sd_relief    <dbl> 1.1174831, 0.4472136, 0.0000000, 0.8555853, 0.0000000, 0.… ## $ reef         <dbl> 0.9266055, 1.0000000, 1.0000000, 1.0000000, 1.0000000, 1.… maturity.mean <- maturity %>%   dplyr::group_by(family, genus, species, sex) %>%   dplyr::slice(which.min(l50_mm)) %>%   ungroup() %>%   dplyr::group_by(family, genus, species) %>%   dplyr::summarise(l50 = mean(l50_mm)) %>%   ungroup() %>%   glimpse() ## `summarise()` has grouped output by 'family', 'genus'. You can override using ## the `.groups` argument. ## Rows: 42 ## Columns: 4 ## $ family  <chr> \"Arripidae\", \"Berycidae\", \"Carangidae\", \"Carangidae\", \"Carchar… ## $ genus   <chr> \"Arripis\", \"Centroberyx\", \"Pseudocaranx\", \"Seriola\", \"Carcharh… ## $ species <chr> \"truttaceus\", \"gerrardi\", \"spp\", \"hippos\", \"obscurus\", \"plumbe… ## $ l50     <dbl> 600.0, 266.0, 310.0, 831.0, 2540.0, 1360.0, 670.0, 400.0, 466.… tidy.maxn <- readRDS(here::here(paste0(\"r-workflows/data/staging/\", name, \"_complete-maxn.rds\"))) %>%   dplyr::group_by(campaignid, sample, scientific) %>%   dplyr::summarise(maxn = sum(maxn)) %>%   pivot_wider(names_from = \"scientific\", values_from = maxn, values_fill = 0) %>%   dplyr::ungroup() %>%   dplyr::mutate(total_abundance = rowSums(.[, 3:(ncol(.))], na.rm = TRUE), species_richness = rowSums(.[, 3:(ncol(.))] > 0)) %>%    dplyr::select(campaignid, sample, total_abundance, species_richness) %>%   pivot_longer(cols = c(\"total_abundance\", \"species_richness\"), names_to = \"response\", values_to = \"number\") %>%   dplyr::left_join(habitat) %>%   glimpse() ## `summarise()` has grouped output by 'campaignid', 'sample'. You can override ## using the `.groups` argument. ## Joining with `by = join_by(campaignid, sample)` ## Rows: 64 ## Columns: 17 ## $ campaignid   <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"… ## $ sample       <chr> \"10\", \"10\", \"12\", \"12\", \"14\", \"14\", \"15\", \"15\", \"16\", \"16… ## $ response     <chr> \"total_abundance\", \"species_richness\", \"total_abundance\",… ## $ number       <dbl> 111, 13, 94, 15, 191, 9, 146, 16, 99, 14, 312, 18, 41, 14… ## $ longitude_dd <dbl> 114.8533, 114.8533, 114.8816, 114.8816, 114.8686, 114.868… ## $ latitude_dd  <dbl> -34.08387, -34.08387, -34.13249, -34.13249, -34.07530, -3… ## $ depth        <chr> \"44.3\", \"44.3\", \"42.6\", \"42.6\", \"42.7\", \"42.7\", \"45.3\", \"… ## $ mbdepth      <dbl> -42.77519, -42.77519, -42.02835, -42.02835, -41.07679, -4… ## $ slope        <dbl> 0.005708777, 0.005708777, 0.013768068, 0.013768068, 0.078… ## $ aspect       <dbl> 72.31942, 72.31942, 110.35012, 110.35012, 215.54254, 215.… ## $ tpi          <dbl> 0.05208921, 0.05208921, 0.03892708, 0.03892708, 0.2611088… ## $ tri          <dbl> 0.05208921, 0.05208921, 0.06246567, 0.06246567, 0.3096442… ## $ roughness    <dbl> 0.11757660, 0.11757660, 0.30690765, 0.30690765, 0.7959022… ## $ detrended    <dbl> -2.8542883, -2.8542883, -5.8822656, -5.8822656, -6.646017… ## $ mean_relief  <dbl> 3.217391, 3.217391, 2.809524, 2.809524, 2.440000, 2.44000… ## $ sd_relief    <dbl> 0.7952428, 0.7952428, 0.4023739, 0.4023739, 0.7118052, 0.… ## $ reef         <dbl> 0.8888889, 0.8888889, 1.0000000, 1.0000000, 0.9322034, 0.… lengths <- readRDS(here::here(paste0(\"r-workflows/data/staging/\", name, \"_complete-length.rds\"))) %>%   # dplyr::mutate(depth = as.numeric(depth)) %>%                         left_join(habitat) %>%   left_join(maturity.mean) %>%   dplyr::mutate(number = 1) %>%   glimpse() ## Joining with `by = join_by(campaignid, sample, depth, longitude_dd, ## latitude_dd)` ## Joining with `by = join_by(family, genus, species)` ## Rows: 4,212 ## Columns: 31 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", … ## $ family                      <chr> \"Dasyatidae\", \"Gerreidae\", \"Heterodontidae… ## $ genus                       <chr> \"Dasyatis\", \"Parequula\", \"Heterodontus\", \"… ## $ species                     <chr> \"brevicaudata\", \"melbournensis\", \"portusja… ## $ length                      <dbl> 1076.08643, 71.45003, NA, NA, 86.76808, 14… ## $ range                       <chr> \"2463.40578\", \"594.55232\", \"952.35412\", \"9… ## $ date_time                   <chr> \"18/03/2023 2:44\", \"18/03/2023 2:44\", \"18/… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"44.3\", \"4… ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ zone_type                   <chr> \"National Park Zone (IUCN II)\", \"National … ## $ longitude_dd                <dbl> 114.8533, 114.8533, 114.8533, 114.8533, 11… ## $ latitude_dd                 <dbl> -34.08388, -34.08388, -34.08388, -34.08388… ## $ status                      <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\"… ## $ mbdepth                     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ slope                       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ aspect                      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ tpi                         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ tri                         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ roughness                   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ detrended                   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ mean_relief                 <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ sd_relief                   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ reef                        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ l50                         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ number                      <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-fish.html","id":"format-data-for-visualisation-and-modelling","dir":"Articles > R-workflows","previous_headings":"","what":"Format data for visualisation and modelling","title":"Format & visualise fish data","text":"Filter length data include ‘indicator species’. case study, three species defined bioregional-scale demersal fish indicators West Australian Department Primary Industries Regional Development. equivalent study area, suggest using ecologically-relevant highly-targeted species. Create unique list samples per campaign, fill zeroes back processed length data. Create dataframe indicator species greater length maturity. Create dataframe indicator species smaller length maturity. Join two datasets.","code":"indicator.species <- lengths %>%   dplyr::mutate(scientific = paste(genus, species, sep = \" \")) %>%   dplyr::filter(scientific %in% c(\"Choerodon rubescens\", \"Chrysophrys auratus\", \"Glaucosoma hebraicum\")) %>%   glimpse() ## Rows: 77 ## Columns: 32 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"15\", \"17\", \"19\", \"19\", \"19\", \"19\", \"19\", … ## $ family                      <chr> \"Sparidae\", \"Glaucosomatidae\", \"Sparidae\",… ## $ genus                       <chr> \"Chrysophrys\", \"Glaucosoma\", \"Chrysophrys\"… ## $ species                     <chr> \"auratus\", \"hebraicum\", \"auratus\", \"auratu… ## $ length                      <dbl> 635.3467, 714.0737, 733.1903, 427.6258, 52… ## $ range                       <chr> \"2065.51517\", \"1598.43370\", \"3266.31550\", … ## $ date_time                   <chr> \"18/03/2023 2:50\", \"15/03/2023 3:00\", \"18/… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"45.3\", \"43.3\", \"73.6\", \"73.6\", \"73.6\", \"7… ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ zone_type                   <chr> \"National Park Zone (IUCN II)\", \"National … ## $ longitude_dd                <dbl> 114.8444, 114.8576, 114.7822, 114.7822, 11… ## $ latitude_dd                 <dbl> -34.08478, -34.09635, -34.12047, -34.12047… ## $ status                      <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\"… ## $ mbdepth                     <dbl> NA, -42.74676, -71.60112, -71.60112, -71.6… ## $ slope                       <dbl> NA, 0.008719478, 0.880997142, 0.880997142,… ## $ aspect                      <dbl> NA, 30.76545, 262.35388, 262.35388, 262.35… ## $ tpi                         <dbl> NA, 0.02505112, 1.04176044, 1.04176044, 1.… ## $ tri                         <dbl> NA, 0.03473282, 2.80258274, 2.80258274, 2.… ## $ roughness                   <dbl> NA, 0.09923935, 9.01136017, 9.01136017, 9.… ## $ detrended                   <dbl> NA, -3.137504, 17.991146, 17.991146, 17.99… ## $ mean_relief                 <dbl> NA, 3.333333, 2.583333, 2.583333, 2.583333… ## $ sd_relief                   <dbl> NA, 0.9128709, 0.5036102, 0.5036102, 0.503… ## $ reef                        <dbl> NA, 1.0000000, 0.9493671, 0.9493671, 0.949… ## $ l50                         <dbl> 352.0, 310.5, 352.0, 352.0, 352.0, 352.0, … ## $ number                      <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, … ## $ scientific                  <chr> \"Chrysophrys auratus\", \"Glaucosoma hebraic… metadata.length <- lengths %>%   distinct(campaignid, sample, status) %>%   glimpse() ## Rows: 32 ## Columns: 3 ## $ campaignid <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"20… ## $ sample     <chr> \"10\", \"12\", \"14\", \"15\", \"16\", \"17\", \"19\", \"2\", \"21\", \"22\", … ## $ status     <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"No-… greater.mat <- indicator.species %>%   dplyr::filter(length > l50) %>%   dplyr::group_by(campaignid, sample) %>%   dplyr::summarise(number = sum(number)) %>%   ungroup() %>%   right_join(metadata.length) %>%   dplyr::mutate(number = ifelse(is.na(number), 0, number)) %>%   dplyr::mutate(response = \"greater than Lm\") %>%   left_join(habitat) %>%   dplyr::glimpse() ## `summarise()` has grouped output by 'campaignid'. You can override using the ## `.groups` argument. ## Joining with `by = join_by(campaignid, sample)` ## Joining with `by = join_by(campaignid, sample)` ## Rows: 32 ## Columns: 18 ## $ campaignid   <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"… ## $ sample       <chr> \"15\", \"17\", \"19\", \"23\", \"24\", \"26\", \"29\", \"3\", \"31\", \"32\"… ## $ number       <dbl> 1, 1, 8, 3, 2, 3, 4, 1, 4, 6, 1, 3, 1, 2, 4, 2, 6, 1, 13,… ## $ status       <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"N… ## $ response     <chr> \"greater than Lm\", \"greater than Lm\", \"greater than Lm\", … ## $ longitude_dd <dbl> 114.8444, 114.8576, 114.7822, 114.9190, 114.8485, 114.928… ## $ latitude_dd  <dbl> -34.08478, -34.09635, -34.12047, -34.12832, -34.11789, -3… ## $ depth        <chr> \"45.3\", \"43.3\", \"73.6\", \"41\", \"45.6\", \"36\", \"42.6\", \"46.7… ## $ mbdepth      <dbl> -44.29804, -42.74676, -71.60112, -38.25594, -44.23959, -4… ## $ slope        <dbl> 0.108975978, 0.008719478, 0.880997142, 0.444838455, 0.103… ## $ aspect       <dbl> 264.03427, 30.76545, 262.35388, 294.10675, 257.20307, 40.… ## $ tpi          <dbl> -0.19527912, 0.02505112, 1.04176044, 0.47694588, 0.042278… ## $ tri          <dbl> 0.34487247, 0.03473282, 2.80258274, 1.83670998, 0.3347983… ## $ roughness    <dbl> 0.91366196, 0.09923935, 9.01136017, 5.30128479, 1.2933082… ## $ detrended    <dbl> -0.2281526, -3.1375041, 17.9911461, -8.6934719, 2.9724391… ## $ mean_relief  <dbl> 2.518519, 3.333333, 2.583333, 3.555556, 3.360000, 4.00000… ## $ sd_relief    <dbl> 0.8024180, 0.9128709, 0.5036102, 0.8555853, 0.4898979, 0.… ## $ reef         <dbl> 0.7741935, 1.0000000, 0.9493671, 1.0000000, 1.0000000, 1.… smaller.mat <- indicator.species %>%   dplyr::filter(length < l50) %>%   dplyr::group_by(campaignid, sample) %>%   dplyr::summarise(number = sum(number)) %>%   ungroup() %>%   right_join(metadata.length) %>%   dplyr::mutate(number = ifelse(is.na(number), 0, number)) %>%   dplyr::mutate(response = \"smaller than Lm\") %>%   left_join(habitat) %>%   dplyr::glimpse() ## `summarise()` has grouped output by 'campaignid'. You can override using the ## `.groups` argument. ## Joining with `by = join_by(campaignid, sample)` ## Joining with `by = join_by(campaignid, sample)` ## Rows: 32 ## Columns: 18 ## $ campaignid   <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"… ## $ sample       <chr> \"26\", \"4\", \"7\", \"10\", \"12\", \"14\", \"15\", \"16\", \"17\", \"19\",… ## $ number       <dbl> 1, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, … ## $ status       <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"N… ## $ response     <chr> \"smaller than Lm\", \"smaller than Lm\", \"smaller than Lm\", … ## $ longitude_dd <dbl> 114.9284, 114.9112, 114.7854, 114.8533, 114.8816, 114.868… ## $ latitude_dd  <dbl> -34.12729, -34.11597, -34.09623, -34.08387, -34.13249, -3… ## $ depth        <chr> \"36\", \"45\", \"62.7\", \"44.3\", \"42.6\", \"42.7\", \"45.3\", \"45.4… ## $ mbdepth      <dbl> -40.68553, -42.80315, -60.38860, -42.77519, -42.02835, -4… ## $ slope        <dbl> 0.694289634, 0.045436668, 0.115437569, 0.005708777, 0.013… ## $ aspect       <dbl> 40.87387, 319.32290, 319.71953, 72.31942, 110.35012, 215.… ## $ tpi          <dbl> -0.67607403, 0.17132854, 0.07896280, 0.05208921, 0.038927… ## $ tri          <dbl> 2.39221191, 0.20512867, 0.37800837, 0.05208921, 0.0624656… ## $ roughness    <dbl> 8.36493301, 0.54244614, 1.60873032, 0.11757660, 0.3069076… ## $ detrended    <dbl> -11.2637815, -12.7394981, 19.9898605, -2.8542883, -5.8822… ## $ mean_relief  <dbl> 4.000000, 3.761905, 3.000000, 3.217391, 2.809524, 2.44000… ## $ sd_relief    <dbl> 0.0000000, 0.4364358, 0.0000000, 0.7952428, 0.4023739, 0.… ## $ reef         <dbl> 1.0000000, 1.0000000, 1.0000000, 0.8888889, 1.0000000, 0.… tidy.length <- bind_rows(greater.mat, smaller.mat) %>%   glimpse() ## Rows: 64 ## Columns: 18 ## $ campaignid   <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"… ## $ sample       <chr> \"15\", \"17\", \"19\", \"23\", \"24\", \"26\", \"29\", \"3\", \"31\", \"32\"… ## $ number       <dbl> 1, 1, 8, 3, 2, 3, 4, 1, 4, 6, 1, 3, 1, 2, 4, 2, 6, 1, 13,… ## $ status       <chr> \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"No-take\", \"N… ## $ response     <chr> \"greater than Lm\", \"greater than Lm\", \"greater than Lm\", … ## $ longitude_dd <dbl> 114.8444, 114.8576, 114.7822, 114.9190, 114.8485, 114.928… ## $ latitude_dd  <dbl> -34.08478, -34.09635, -34.12047, -34.12832, -34.11789, -3… ## $ depth        <chr> \"45.3\", \"43.3\", \"73.6\", \"41\", \"45.6\", \"36\", \"42.6\", \"46.7… ## $ mbdepth      <dbl> -44.29804, -42.74676, -71.60112, -38.25594, -44.23959, -4… ## $ slope        <dbl> 0.108975978, 0.008719478, 0.880997142, 0.444838455, 0.103… ## $ aspect       <dbl> 264.03427, 30.76545, 262.35388, 294.10675, 257.20307, 40.… ## $ tpi          <dbl> -0.19527912, 0.02505112, 1.04176044, 0.47694588, 0.042278… ## $ tri          <dbl> 0.34487247, 0.03473282, 2.80258274, 1.83670998, 0.3347983… ## $ roughness    <dbl> 0.91366196, 0.09923935, 9.01136017, 5.30128479, 1.2933082… ## $ detrended    <dbl> -0.2281526, -3.1375041, 17.9911461, -8.6934719, 2.9724391… ## $ mean_relief  <dbl> 2.518519, 3.333333, 2.583333, 3.555556, 3.360000, 4.00000… ## $ sd_relief    <dbl> 0.8024180, 0.9128709, 0.5036102, 0.8555853, 0.4898979, 0.… ## $ reef         <dbl> 0.7741935, 1.0000000, 0.9493671, 1.0000000, 1.0000000, 1.…"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-fish.html","id":"visualise-the-fish-count-data","dir":"Articles > R-workflows","previous_headings":"","what":"Visualise the fish count data","title":"Format & visualise fish data","text":"Filter count (maxn) data include one response. example count metrics included total abundance species richness. Visualise count data bubble plot. White bubbles represent zeroes size blue bubbles represents abundance.","code":"response.name <- 'total_abundance'  overzero <-  tidy.maxn %>%    filter(response %in% response.name & number > 0)   equalzero <- tidy.maxn %>%    filter(response %in% response.name & number == 0) bubble.plot <- leaflet(data = tidy.maxn) %>%                        addTiles() %>%                                                       addProviderTiles('Esri.WorldImagery', group = \"World Imagery\") %>%   addLayersControl(baseGroups = c(\"Open Street Map\", \"World Imagery\"), options = layersControlOptions(collapsed = FALSE))  if (nrow(overzero)) {                                                  bubble.plot <- bubble.plot %>%     addCircleMarkers(data = overzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = ~ number / 10, fillOpacity = 0.5, stroke = FALSE, label = ~ as.character(sample))}  if (nrow(equalzero)) {                                               bubble.plot <- bubble.plot %>%     addCircleMarkers(data = equalzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = 2, fillOpacity = 0.5, color = \"white\", stroke = FALSE, label = ~ as.character(sample))} bubble.plot"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-fish.html","id":"visualise-the-fish-length-data","dir":"Articles > R-workflows","previous_headings":"","what":"Visualise the fish length data","title":"Format & visualise fish data","text":"Filter length data include one response. example length metrics included indicator species greater smaller length maturity. Visualise count data bubble plot. White bubbles represent zeroes size blue bubbles represents abundance.","code":"response.name <- 'greater than Lm'  overzero <-  tidy.length %>%    filter(response %in% response.name & number > 0)   equalzero <- tidy.length %>%    filter(response %in% response.name & number == 0) bubble.plot <- leaflet(data = tidy.length) %>%                        addTiles() %>%                                                       addProviderTiles('Esri.WorldImagery', group = \"World Imagery\") %>%   addLayersControl(baseGroups = c(\"Open Street Map\", \"World Imagery\"), options = layersControlOptions(collapsed = FALSE))  if (nrow(overzero)) {                                                  bubble.plot <- bubble.plot %>%     addCircleMarkers(data = overzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = ~ number + 3, fillOpacity = 0.5, stroke = FALSE, label = ~ as.character(sample))}  if (nrow(equalzero)) {                                               bubble.plot <- bubble.plot %>%     addCircleMarkers(data = equalzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = 2, fillOpacity = 0.5, color = \"white\", stroke = FALSE, label = ~ as.character(sample))} bubble.plot"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-fish.html","id":"save-tidy-datasets-for-modelling","dir":"Articles > R-workflows","previous_headings":"","what":"Save tidy datasets for modelling","title":"Format & visualise fish data","text":"Save count response data (total abundance species richness). Save length response data (indicator species greater smaller length maturity).","code":"saveRDS(tidy.maxn, file = here::here(paste0(\"r-workflows/data/tidy/\", name, \"_tidy-count.rds\"))) saveRDS(tidy.length, file = here::here(paste0(\"r-workflows/data/tidy/\", name, \"_tidy-length.rds\")))"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-habitat.html","id":"r-set-up","dir":"Articles > R-workflows","previous_headings":"","what":"R set up","title":"Format & visualise habitat data","text":"Load necessary libraries. Set study name.","code":"library(CheckEM) library(tidyverse) library(ggbeeswarm) library(RColorBrewer) library(leaflet) library(leaflet.minicharts) library(here) name <- \"example-bruv-workflow\""},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-habitat.html","id":"read-in-the-data","dir":"Articles > R-workflows","previous_headings":"","what":"Read in the data","title":"Format & visualise habitat data","text":"Load metadata bathymetry derivatives joined . Load habitat data format ‘broad’ classes modelling. classes included example just recommendation, however deciding habitat classes model, suggest using ecologically meaningful classes rare model. Load relief data summarise mean standard deviation relief.","code":"metadata.bathy.derivatives <- readRDS(here::here(paste0(\"r-workflows/data/tidy/\", name, \"_metadata-bathymetry-derivatives.rds\"))) %>%   dplyr::mutate(sample = as.character(sample)) %>%   glimpse() ## Rows: 32 ## Columns: 22 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", \"3… ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:49\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\", … ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ x                           <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ y                           <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ longitude_dd                <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ latitude_dd                 <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ ID                          <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,… ## $ mbdepth                     <dbl> -34.97151, -36.35807, -40.68553, -38.25594… ## $ slope                       <dbl> 0.146843375, 0.812689749, 0.694289634, 0.4… ## $ aspect                      <dbl> 209.89577, 62.41434, 40.87387, 294.10675, … ## $ TPI                         <dbl> 0.42153454, 2.39535522, -0.67607403, 0.476… ## $ TRI                         <dbl> 0.75557327, 3.29823494, 2.39221191, 1.8367… ## $ roughness                   <dbl> 2.21119308, 8.36493301, 8.36493301, 5.3012… ## $ detrended                   <dbl> -5.6631737, -7.0394716, -11.2637815, -8.69… habitat <- readRDS(here::here(paste0(\"r-workflows/data/staging/\", name, \"_habitat.rds\"))) %>%   dplyr::mutate(habitat = case_when(level_2 %in% \"Macroalgae\" ~ level_2, level_2 %in% \"Seagrasses\" ~ level_2, level_2 %in% \"Substrate\" & level_3 %in% \"Consolidated (hard)\" ~ level_3, level_2 %in% \"Substrate\" & level_3 %in% \"Unconsolidated (soft)\" ~ level_3,  level_2 %in% \"Sponges\" ~ \"Sessile invertebrates\", level_2 %in% \"Sessile invertebrates\" ~ level_2, level_2 %in% \"Bryozoa\" ~ \"Sessile invertebrates\", level_2 %in% \"Cnidaria\" ~ \"Sessile invertebrates\")) %>%    dplyr::select(campaignid, sample, habitat, number) %>%   group_by(campaignid, sample, habitat) %>%    dplyr::tally(number, name = \"number\") %>% dplyr::mutate(total_points_annotated = sum(number)) %>%    ungroup() %>%    pivot_wider(names_from = \"habitat\", values_from = \"number\", values_fill = 0) %>%   dplyr::mutate(reef = Macroalgae + Seagrasses + `Sessile invertebrates` + `Consolidated (hard)`) %>%   pivot_longer(cols = c(\"Macroalgae\", \"Seagrasses\", \"Sessile invertebrates\", \"Consolidated (hard)\", \"Unconsolidated (soft)\", \"reef\"), names_to = \"habitat\", values_to = \"number\") %>%   glimpse() ## Rows: 198 ## Columns: 5 ## $ campaignid             <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo… ## $ sample                 <chr> \"10\", \"10\", \"10\", \"10\", \"10\", \"10\", \"12\", \"12\",… ## $ total_points_annotated <dbl> 97, 97, 97, 97, 97, 97, 71, 71, 71, 71, 71, 71,… ## $ habitat                <chr> \"Macroalgae\", \"Seagrasses\", \"Sessile invertebra… ## $ number                 <dbl> 8, 84, 2, 0, 3, 94, 57, 12, 2, 0, 0, 71, 50, 12… tidy.relief <- readRDS(here::here(paste0(\"r-workflows/data/staging/\", name, \"_relief.rds\"))) %>%   uncount(number) %>%   group_by(campaignid, sample) %>%   dplyr::summarise(mean.relief = mean(as.numeric(level_5)), sd.relief = sd(as.numeric(level_5), na.rm = T)) %>%   ungroup() %>%   glimpse() ## `summarise()` has grouped output by 'campaignid'. You can override using the ## `.groups` argument. ## Rows: 32 ## Columns: 4 ## $ campaignid  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"2… ## $ sample      <chr> \"10\", \"12\", \"14\", \"15\", \"16\", \"17\", \"19\", \"2\", \"21\", \"22\",… ## $ mean.relief <dbl> 3.217391, 2.809524, 2.440000, 2.518519, 4.000000, 3.333333… ## $ sd.relief   <dbl> 0.7952428, 0.4023739, 0.7118052, 0.8024180, 0.0000000, 0.9…"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-habitat.html","id":"format-the-habitat-and-relief-data-for-plotting-and-modelling","dir":"Articles > R-workflows","previous_headings":"","what":"Format the habitat and relief data for plotting and modelling","title":"Format & visualise habitat data","text":"Join habitat data relief, metadata bathymetry derivatives. Format relief format suitable exploratory plotting.","code":"tidy.habitat <- metadata.bathy.derivatives %>%   left_join(habitat) %>%   left_join(tidy.relief) %>%   dplyr::mutate(longitude_dd = as.numeric(longitude_dd),                 latitude_dd = as.numeric(latitude_dd)) %>%   clean_names() %>%   glimpse() ## Joining with `by = join_by(campaignid, sample)` ## Joining with `by = join_by(campaignid, sample)` ## Rows: 192 ## Columns: 27 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"35\", \"35\", \"35\", \"35\", \"35\", \"5\", \"… ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:36\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"39.6\", \"39.6\", \"39.6\", \"39.6\", \"3… ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ x                           <dbl> 114.9236, 114.9236, 114.9236, 114.9236, 11… ## $ y                           <dbl> -34.13155, -34.13155, -34.13155, -34.13155… ## $ longitude_dd                <dbl> 114.9236, 114.9236, 114.9236, 114.9236, 11… ## $ latitude_dd                 <dbl> -34.13155, -34.13155, -34.13155, -34.13155… ## $ id                          <dbl> 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, … ## $ mbdepth                     <dbl> -34.97151, -34.97151, -34.97151, -34.97151… ## $ slope                       <dbl> 0.1468434, 0.1468434, 0.1468434, 0.1468434… ## $ aspect                      <dbl> 209.89577, 209.89577, 209.89577, 209.89577… ## $ tpi                         <dbl> 0.4215345, 0.4215345, 0.4215345, 0.4215345… ## $ tri                         <dbl> 0.7555733, 0.7555733, 0.7555733, 0.7555733… ## $ roughness                   <dbl> 2.211193, 2.211193, 2.211193, 2.211193, 2.… ## $ detrended                   <dbl> -5.663174, -5.663174, -5.663174, -5.663174… ## $ total_points_annotated      <dbl> 114, 114, 114, 114, 114, 114, 146, 146, 14… ## $ habitat                     <chr> \"Macroalgae\", \"Seagrasses\", \"Sessile inver… ## $ number                      <dbl> 96, 6, 3, 1, 8, 106, 110, 36, 0, 0, 0, 146… ## $ mean_relief                 <dbl> 3.034483, 3.034483, 3.034483, 3.034483, 3.… ## $ sd_relief                   <dbl> 1.1174831, 1.1174831, 1.1174831, 1.1174831… plot.relief <- readRDS(here::here(paste0(\"r-workflows/data/staging/\", name, \"_relief.rds\"))) %>%   group_by(campaignid, sample, level_5) %>%   dplyr::summarise(number = sum(number)) %>%   ungroup() %>%   dplyr::mutate(class.relief = as.factor(level_5)) %>%   glimpse() ## `summarise()` has grouped output by 'campaignid', 'sample'. You can override ## using the `.groups` argument. ## Rows: 73 ## Columns: 5 ## $ campaignid   <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_stereo-BRUVs\", \"… ## $ sample       <chr> \"10\", \"10\", \"10\", \"12\", \"12\", \"14\", \"14\", \"14\", \"15\", \"15… ## $ level_5      <chr> \"2\", \"3\", \"4\", \"2\", \"3\", \"1\", \"2\", \"3\", \"1\", \"2\", \"3\", \"4… ## $ number       <dbl> 5, 8, 10, 4, 17, 3, 8, 14, 4, 6, 16, 1, 20, 6, 2, 13, 10,… ## $ class.relief <fct> 2, 3, 4, 2, 3, 1, 2, 3, 1, 2, 3, 4, 4, 2, 3, 4, 2, 3, 3, …"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-habitat.html","id":"visualise-the-habitat-and-relief-data","dir":"Articles > R-workflows","previous_headings":"","what":"Visualise the habitat and relief data","title":"Format & visualise habitat data","text":"Plot occurence data per habitat class. data point represents unique sample. Plot occurence data level relief. Create colour palette plotting. Format habitat wide format suitable plotting. Visualise habitat classes spatial pie charts. Choose individual habitat class visualise spatial bubble plots. Visualise individual habitat classes.","code":"ggplot() +   geom_quasirandom(data = tidy.habitat, aes(x = total_points_annotated, y = habitat), groupOnX = F, method = \"quasirandom\", alpha = 0.25, size = 1.8, width = 0.2) +   labs(x = \"Number of points\", y = \"\") +   theme_classic() ## Orientation inferred to be along y-axis; override with ## `position_quasirandom(orientation = 'x')` ggplot() +   geom_quasirandom(data = plot.relief, aes(x = number, y = class.relief), groupOnX = F, method = \"quasirandom\", alpha = 0.25, size = 1.8, width = 0.05) +   labs(x = \"Number of points\", y = \"Relief (0-5)\") +    theme_classic() ## Orientation inferred to be along y-axis; override with ## `position_quasirandom(orientation = 'x')` cols <- colorRampPalette(brewer.pal(12, \"Paired\"))(length(unique(tidy.habitat$habitat))) plot.habitat <- tidy.habitat %>%   pivot_wider(names_from = \"habitat\", values_from = \"number\", names_prefix = \"broad.\") %>%   glimpse() ## Rows: 32 ## Columns: 31 ## $ campaignid                    <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC… ## $ sample                        <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", … ## $ date_time                     <chr> \"14/03/2023 23:36\", \"14/03/2023 23:49\", … ## $ location                      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, … ## $ site                          <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, … ## $ depth                         <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\"… ## $ successful_count              <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\"… ## $ successful_length             <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\"… ## $ successful_habitat_forward    <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\"… ## $ successful_habitat_backward   <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\"… ## $ x                             <dbl> 114.9236, 114.9292, 114.9284, 114.9190, … ## $ y                             <dbl> -34.13155, -34.12953, -34.12729, -34.128… ## $ longitude_dd                  <dbl> 114.9236, 114.9292, 114.9284, 114.9190, … ## $ latitude_dd                   <dbl> -34.13155, -34.12953, -34.12729, -34.128… ## $ id                            <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1… ## $ mbdepth                       <dbl> -34.97151, -36.35807, -40.68553, -38.255… ## $ slope                         <dbl> 0.146843375, 0.812689749, 0.694289634, 0… ## $ aspect                        <dbl> 209.89577, 62.41434, 40.87387, 294.10675… ## $ tpi                           <dbl> 0.42153454, 2.39535522, -0.67607403, 0.4… ## $ tri                           <dbl> 0.75557327, 3.29823494, 2.39221191, 1.83… ## $ roughness                     <dbl> 2.21119308, 8.36493301, 8.36493301, 5.30… ## $ detrended                     <dbl> -5.6631737, -7.0394716, -11.2637815, -8.… ## $ total_points_annotated        <dbl> 114, 146, 213, 123, 196, 88, 25, 19, 33,… ## $ mean_relief                   <dbl> 3.034483, 3.900000, 4.000000, 3.555556, … ## $ sd_relief                     <dbl> 1.1174831, 0.4472136, 0.0000000, 0.85558… ## $ broad.Macroalgae              <dbl> 96, 110, 105, 50, 28, 50, 7, 1, 16, 30, … ## $ broad.Seagrasses              <dbl> 6, 36, 108, 66, 168, 36, 0, 6, 6, 54, 12… ## $ `broad.Sessile invertebrates` <dbl> 3, 0, 0, 7, 0, 2, 2, 0, 0, 0, 2, 0, 1, 0… ## $ `broad.Consolidated (hard)`   <dbl> 1, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0… ## $ `broad.Unconsolidated (soft)` <dbl> 8, 0, 0, 0, 0, 0, 13, 12, 11, 0, 0, 0, 0… ## $ broad.reef                    <dbl> 106, 146, 213, 123, 196, 88, 12, 7, 22, … leaflet() %>%                                             addTiles(group = \"Open Street Map\") %>%                              addProviderTiles('Esri.WorldImagery', group = \"World Imagery\") %>%   addLayersControl(baseGroups = c(\"World Imagery\", \"Open Street Map\"), options = layersControlOptions(collapsed = FALSE)) %>%   addMinicharts(plot.habitat$longitude_dd, plot.habitat$latitude_dd, type = \"pie\", colorPalette = cols, chartdata = plot.habitat[grep(\"broad\", names(plot.habitat))], width = 20, transitionTime = 0) %>%                    setView(mean(as.numeric(plot.habitat$longitude_dd)),            mean(as.numeric(plot.habitat$latitude_dd)), zoom = 12) hab.name <- 'Sessile invertebrates'  overzero <-  tidy.habitat %>%    filter(habitat %in% hab.name & number > 0)   equalzero <- tidy.habitat %>%    filter(habitat %in% hab.name & number == 0) bubble.plot <- leaflet(data = tidy.habitat) %>%                        addTiles() %>%                                                       addProviderTiles('Esri.WorldImagery', group = \"World Imagery\") %>%   addLayersControl(baseGroups = c(\"Open Street Map\", \"World Imagery\"), options = layersControlOptions(collapsed = FALSE))  if (nrow(overzero)) {                                                  bubble.plot <- bubble.plot %>%     addCircleMarkers(data = overzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = ~ number + 3, fillOpacity = 0.5, stroke = FALSE, label = ~ as.character(sample))}  if (nrow(equalzero)) {                                               bubble.plot <- bubble.plot %>%     addCircleMarkers(data = equalzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = 2, fillOpacity = 0.5, color = \"white\", stroke = FALSE, label = ~ as.character(sample))} bubble.plot"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/format-visualise-habitat.html","id":"save-the-final-tidy-habitat-data","dir":"Articles > R-workflows","previous_headings":"","what":"Save the final tidy habitat data","title":"Format & visualise habitat data","text":"","code":"saveRDS(tidy.habitat, file = here::here(paste(\"r-workflows/data/tidy/\", paste(name,\"tidy-habitat.rds\", sep = \"_\"), sep = \"/\")))"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"r-setup","dir":"Articles > R-workflows","previous_headings":"","what":"R setup","title":"Generate spatial predictions of habitat using FSSgam","text":"Load libraries. Set study name.","code":"library(CheckEM) library(tidyverse) library(mgcv) library(devtools) library(FSSgam) library(here) library(ggplot2) library(ggnewscale) library(viridis) library(terra) library(sf) library(patchwork) name <- 'example-bruv-workflow'"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"load-data","dir":"Articles > R-workflows","previous_headings":"","what":"Load data","title":"Generate spatial predictions of habitat using FSSgam","text":"Load habitat point annotation data.","code":"dat <- readRDS(here::here(paste0(\"r-workflows/data/tidy/\",                        name, \"_tidy-habitat.rds\"))) %>%   glimpse() ## Rows: 192 ## Columns: 27 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"35\", \"35\", \"35\", \"35\", \"35\", \"5\", \"… ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:36\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"39.6\", \"39.6\", \"39.6\", \"39.6\", \"3… ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ x                           <dbl> 114.9236, 114.9236, 114.9236, 114.9236, 11… ## $ y                           <dbl> -34.13155, -34.13155, -34.13155, -34.13155… ## $ longitude_dd                <dbl> 114.9236, 114.9236, 114.9236, 114.9236, 11… ## $ latitude_dd                 <dbl> -34.13155, -34.13155, -34.13155, -34.13155… ## $ id                          <dbl> 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, … ## $ mbdepth                     <dbl> -34.97151, -34.97151, -34.97151, -34.97151… ## $ slope                       <dbl> 0.1468434, 0.1468434, 0.1468434, 0.1468434… ## $ aspect                      <dbl> 209.89577, 209.89577, 209.89577, 209.89577… ## $ tpi                         <dbl> 0.4215345, 0.4215345, 0.4215345, 0.4215345… ## $ tri                         <dbl> 0.7555733, 0.7555733, 0.7555733, 0.7555733… ## $ roughness                   <dbl> 2.211193, 2.211193, 2.211193, 2.211193, 2.… ## $ detrended                   <dbl> -5.663174, -5.663174, -5.663174, -5.663174… ## $ total_points_annotated      <dbl> 114, 114, 114, 114, 114, 114, 146, 146, 14… ## $ habitat                     <chr> \"Macroalgae\", \"Seagrasses\", \"Sessile inver… ## $ number                      <dbl> 96, 6, 3, 1, 8, 106, 110, 36, 0, 0, 0, 146… ## $ mean_relief                 <dbl> 3.034483, 3.034483, 3.034483, 3.034483, 3.… ## $ sd_relief                   <dbl> 1.1174831, 1.1174831, 1.1174831, 1.1174831…"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"set-up-data-for-modelling","dir":"Articles > R-workflows","previous_headings":"","what":"Set up data for modelling","title":"Generate spatial predictions of habitat using FSSgam","text":"Set predictor variables. Check correlation predictor variables remove anything highly correlated (>0.95). Plot individual predictors assess transformations necessary. suggest use transformations absolutely necessary. example dataset, response variables relatively balanced distributions, therefor left untransformed.  Reset predictor variables remove highly correlated variables include transformed variables. Check make sure response variables less 80% zeroes. Full-subset GAM modelling produce unreliable results data zero inflated. Add directory save model outputs, set R environment model selection.","code":"names(dat) ##  [1] \"campaignid\"                  \"sample\"                      ##  [3] \"date_time\"                   \"location\"                    ##  [5] \"site\"                        \"depth\"                       ##  [7] \"successful_count\"            \"successful_length\"           ##  [9] \"successful_habitat_forward\"  \"successful_habitat_backward\" ## [11] \"x\"                           \"y\"                           ## [13] \"longitude_dd\"                \"latitude_dd\"                 ## [15] \"id\"                          \"mbdepth\"                     ## [17] \"slope\"                       \"aspect\"                      ## [19] \"tpi\"                         \"tri\"                         ## [21] \"roughness\"                   \"detrended\"                   ## [23] \"total_points_annotated\"      \"habitat\"                     ## [25] \"number\"                      \"mean_relief\"                 ## [27] \"sd_relief\" pred.vars <- c(\"mbdepth\",\"roughness\", \"detrended\",                 \"slope\", \"tpi\", \"aspect\", \"tri\") round(cor(dat[ , pred.vars]), 2) ##           mbdepth roughness detrended slope   tpi aspect   tri ## mbdepth      1.00     -0.66     -0.89 -0.65  0.03  -0.32 -0.59 ## roughness   -0.66      1.00      0.48  0.99  0.29   0.06  0.99 ## detrended   -0.89      0.48      1.00  0.47  0.00   0.39  0.42 ## slope       -0.65      0.99      0.47  1.00  0.29   0.06  0.99 ## tpi          0.03      0.29      0.00  0.29  1.00  -0.02  0.35 ## aspect      -0.32      0.06      0.39  0.06 -0.02   1.00  0.04 ## tri         -0.59      0.99      0.42  0.99  0.35   0.04  1.00 plot_transformations(pred.vars = pred.vars, dat = dat) pred.vars <- c(\"depth\",\"roughness\", \"detrended\",                 \"tpi\", \"aspect\", \"tri\") resp.vars.all = unique(as.character(dat$habitat)) resp.vars = character() for(i in 1:length(resp.vars.all)){   temp.dat = dat[which(dat$habitat == resp.vars.all[i]),]   if(length(which(temp.dat$habitat == 0)) / nrow(temp.dat) < 0.8){     resp.vars = c(resp.vars, resp.vars.all[i])} } resp.vars ## [1] \"Macroalgae\"            \"Seagrasses\"            \"Sessile invertebrates\" ## [4] \"Consolidated (hard)\"   \"Unconsolidated (soft)\" \"reef\" outdir    <- (\"r-workflows/model output/habitat/\") out.all   <- list() var.imp   <- list()"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"run-the-full-subset-model-selection-process","dir":"Articles > R-workflows","previous_headings":"","what":"Run the full subset model selection process","title":"Generate spatial predictions of habitat using FSSgam","text":"loop adapted @beckyfisher/FSSgam, examples documentation available GitHub Fisher, R, Wilson, SK, Sin, TM, Lee, AC, Langlois, TJ. simple function full-subsets multiple regression ecology R. Ecol Evol. 2018; 8: 6104–6113. https://doi.org/10.1002/ece3.4134 Save model fits importance scores.","code":"for(i in 1:length(resp.vars)){   print(resp.vars[i])   use.dat <- dat[dat$habitat == resp.vars[i],]   use.dat   <- as.data.frame(use.dat)   Model1  <- gam(cbind(number, (total_points_annotated - number)) ~                     s(mbdepth, bs = 'cr'),                  family = binomial(\"logit\"),  data = use.dat)      model.set <- generate.model.set(use.dat = use.dat,                                   test.fit = Model1,                                   pred.vars.cont = pred.vars,                                   cyclic.vars = c(\"aspect\"),                                   k = 5,                                   cov.cutoff = 0.7   )   out.list <- fit.model.set(model.set,                             max.models = 600,                             parallel = T)   names(out.list)      out.list$failed.models    mod.table <- out.list$mod.data.out   mod.table <- mod.table[order(mod.table$AICc), ]   mod.table$cumsum.wi <- cumsum(mod.table$wi.AICc)   out.i     <- mod.table[which(mod.table$delta.AICc <= 2), ]   out.all   <- c(out.all, list(out.i))   var.imp   <- c(var.imp, list(out.list$variable.importance$aic$variable.weights.raw))      for(m in 1:nrow(out.i)){     best.model.name <- as.character(out.i$modname[m])          png(file = here::here(paste(outdir, m, resp.vars[i], \"mod_fits.png\", sep = \"\")))     if(best.model.name != \"null\"){       par(mfrow = c(3, 1), mar = c(9, 4, 3, 1))       best.model = out.list$success.models[[best.model.name]]       plot(best.model, all.terms = T, pages = 1, residuals = T, pch = 16)       mtext(side = 2, text = resp.vars[i], outer = F)}       dev.off()   } } names(out.all) <- resp.vars names(var.imp) <- resp.vars all.mod.fits <- list_rbind(out.all, names_to = \"response\") all.var.imp  <- do.call(\"rbind\",var.imp) write.csv(all.mod.fits[ , -2], file = here::here(paste0(outdir, name, \"_all.mod.fits.csv\"))) write.csv(all.var.imp,         file = here::here(paste0(outdir, name, \"_all.var.imp.csv\")))"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"spatially-predict-the-top-model-from-the-model-selection-process","dir":"Articles > R-workflows","previous_headings":"","what":"Spatially predict the top model from the model selection process","title":"Generate spatial predictions of habitat using FSSgam","text":"Transform habitat data wide format easy prediction. Load raster bathymetry data derivatives.  Transform raster dataframe predict onto. Manually set top model full subset model selection.","code":"widedat <- dat %>%   pivot_wider(values_from = \"number\", names_from = \"habitat\", values_fill = 0) %>%   clean_names() %>%   glimpse() ## Rows: 32 ## Columns: 31 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", \"3… ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:49\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\", … ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ x                           <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ y                           <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ longitude_dd                <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ latitude_dd                 <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ id                          <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,… ## $ mbdepth                     <dbl> -34.97151, -36.35807, -40.68553, -38.25594… ## $ slope                       <dbl> 0.146843375, 0.812689749, 0.694289634, 0.4… ## $ aspect                      <dbl> 209.89577, 62.41434, 40.87387, 294.10675, … ## $ tpi                         <dbl> 0.42153454, 2.39535522, -0.67607403, 0.476… ## $ tri                         <dbl> 0.75557327, 3.29823494, 2.39221191, 1.8367… ## $ roughness                   <dbl> 2.21119308, 8.36493301, 8.36493301, 5.3012… ## $ detrended                   <dbl> -5.6631737, -7.0394716, -11.2637815, -8.69… ## $ total_points_annotated      <dbl> 114, 146, 213, 123, 196, 88, 25, 19, 33, 8… ## $ mean_relief                 <dbl> 3.034483, 3.900000, 4.000000, 3.555556, 4.… ## $ sd_relief                   <dbl> 1.1174831, 0.4472136, 0.0000000, 0.8555853… ## $ macroalgae                  <dbl> 96, 110, 105, 50, 28, 50, 7, 1, 16, 30, 57… ## $ seagrasses                  <dbl> 6, 36, 108, 66, 168, 36, 0, 6, 6, 54, 12, … ## $ sessile_invertebrates       <dbl> 3, 0, 0, 7, 0, 2, 2, 0, 0, 0, 2, 0, 1, 0, … ## $ consolidated_hard           <dbl> 1, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, … ## $ unconsolidated_soft         <dbl> 8, 0, 0, 0, 0, 0, 13, 12, 11, 0, 0, 0, 0, … ## $ reef                        <dbl> 106, 146, 213, 123, 196, 88, 12, 7, 22, 84… preds  <- rast(here::here(paste0(\"r-workflows/data/spatial/rasters/\",                           name, \"_bathymetry_derivatives.rds\"))) plot(preds) preddf <- as.data.frame(preds, xy = TRUE, na.rm = TRUE) %>%   dplyr::mutate(depth = abs(mbdepth)) %>%                                          clean_names() %>%   glimpse() ## Rows: 73,350 ## Columns: 10 ## $ x         <dbl> 115.1714, 115.1739, 115.1764, 115.1789, 115.1814, 115.1839, … ## $ y         <dbl> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33.6… ## $ mbdepth   <dbl> -14.83014, -13.89184, -14.18757, -14.48647, -14.47323, -14.3… ## $ slope     <dbl> 0.24350203, 0.19746646, 0.17799167, 0.18316828, 0.22091857, … ## $ aspect    <dbl> 339.995240, 341.597571, 21.180346, 12.600024, 356.337121, 35… ## $ tpi       <dbl> -3.721524e-01, 5.277313e-01, 1.502453e-01, -1.123428e-03, 9.… ## $ tri       <dbl> 0.9656481, 0.8277034, 0.6934198, 0.6945946, 0.8081013, 0.902… ## $ roughness <dbl> 2.807414, 2.421717, 2.196986, 2.156502, 2.581898, 2.606502, … ## $ detrended <dbl> -2.871674, -2.161609, -2.683798, -3.207528, -3.417629, -3.56… ## $ depth     <dbl> 14.83014, 13.89184, 14.18757, 14.48647, 14.47323, 14.39490, … # Sessile invertebrates m_inverts <- gam(cbind(sessile_invertebrates, total_points_annotated - sessile_invertebrates) ~                   s(detrended,     k = 5, bs = \"cr\")  +                   s(roughness, k = 5, bs = \"cr\") +                  s(tpi, k = 5, bs = \"cr\"),                 data = widedat, method = \"REML\", family = binomial(\"logit\")) summary(m_inverts) ##  ## Family: binomial  ## Link function: logit  ##  ## Formula: ## cbind(sessile_invertebrates, total_points_annotated - sessile_invertebrates) ~  ##     s(detrended, k = 5, bs = \"cr\") + s(roughness, k = 5, bs = \"cr\") +  ##         s(tpi, k = 5, bs = \"cr\") ##  ## Parametric coefficients: ##             Estimate Std. Error z value Pr(>|z|)     ## (Intercept)  -3.0800     0.1913   -16.1   <2e-16 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##                edf Ref.df Chi.sq  p-value     ## s(detrended) 3.640  3.900 304.73  < 2e-16 *** ## s(roughness) 2.814  3.054  45.07  < 2e-16 *** ## s(tpi)       3.495  3.853  28.32 6.79e-06 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## R-sq.(adj) =  0.973   Deviance explained = 95.8% ## -REML = 74.944  Scale est. = 1         n = 32 plot(m_inverts, pages = 1, residuals = T, cex = 5) # Rock m_rock <- gam(cbind(consolidated_hard, total_points_annotated - consolidated_hard) ~                     s(aspect,     k = 5, bs = \"cr\") +                    s(detrended, k = 5, bs = \"cr\") +                    s(tpi, k = 5, bs = \"cr\"),                   data = widedat, method = \"REML\", family = binomial(\"logit\")) summary(m_rock) ##  ## Family: binomial  ## Link function: logit  ##  ## Formula: ## cbind(consolidated_hard, total_points_annotated - consolidated_hard) ~  ##     s(aspect, k = 5, bs = \"cr\") + s(detrended, k = 5, bs = \"cr\") +  ##         s(tpi, k = 5, bs = \"cr\") ##  ## Parametric coefficients: ##             Estimate Std. Error z value Pr(>|z|)     ## (Intercept)   -6.552      0.638  -10.27   <2e-16 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##                edf Ref.df Chi.sq  p-value     ## s(aspect)    3.651  3.905 18.024  0.00133 **  ## s(detrended) 3.211  3.591 24.691 3.45e-05 *** ## s(tpi)       1.000  1.000  5.016  0.02512 *   ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## R-sq.(adj) =  0.886   Deviance explained = 84.5% ## -REML = 28.343  Scale est. = 1         n = 32 plot(m_rock, pages = 1, residuals = T, cex = 5) # Sand m_sand <- gam(cbind(unconsolidated_soft, total_points_annotated - unconsolidated_soft) ~                  s(aspect,     k = 5, bs = \"cr\")  +                  s(detrended, k = 5, bs = \"cr\") +                 s(roughness, k = 5, bs = \"cr\"),                data = widedat, method = \"REML\", family = binomial(\"logit\")) summary(m_sand) ##  ## Family: binomial  ## Link function: logit  ##  ## Formula: ## cbind(unconsolidated_soft, total_points_annotated - unconsolidated_soft) ~  ##     s(aspect, k = 5, bs = \"cr\") + s(detrended, k = 5, bs = \"cr\") +  ##         s(roughness, k = 5, bs = \"cr\") ##  ## Parametric coefficients: ##             Estimate Std. Error z value Pr(>|z|)     ## (Intercept)  -17.238      3.503  -4.921 8.62e-07 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##                edf Ref.df  Chi.sq p-value     ## s(aspect)    3.854  3.978  69.703  <2e-16 *** ## s(detrended) 3.729  3.948 100.173  <2e-16 *** ## s(roughness) 1.860  2.096   8.829  0.0165 *   ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## R-sq.(adj) =  0.915   Deviance explained = 86.7% ## -REML = 64.978  Scale est. = 1         n = 32 plot(m_sand, pages = 1, residuals = T, cex = 5) # Seagrasses m_seagrass <- gam(cbind(seagrasses, total_points_annotated - seagrasses) ~                  s(aspect,     k = 5, bs = \"cr\")  +                  s(detrended, k = 5, bs = \"cr\") +                  s(roughness, k = 5, bs = \"cr\"),                data = widedat, method = \"REML\", family = binomial(\"logit\")) summary(m_seagrass) ##  ## Family: binomial  ## Link function: logit  ##  ## Formula: ## cbind(seagrasses, total_points_annotated - seagrasses) ~ s(aspect,  ##     k = 5, bs = \"cr\") + s(detrended, k = 5, bs = \"cr\") + s(roughness,  ##     k = 5, bs = \"cr\") ##  ## Parametric coefficients: ##             Estimate Std. Error z value Pr(>|z|)     ## (Intercept)  -59.548      6.444  -9.241   <2e-16 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##                edf Ref.df Chi.sq p-value     ## s(aspect)    3.899  3.991  122.4  <2e-16 *** ## s(detrended) 3.966  3.998  186.7  <2e-16 *** ## s(roughness) 3.675  3.916  161.9  <2e-16 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## R-sq.(adj) =  0.794   Deviance explained = 85.7% ## -REML = 156.76  Scale est. = 1         n = 32 plot(m_seagrass, pages = 1, residuals = T, cex = 5) # Macroalgae m_macro <- gam(cbind(macroalgae, total_points_annotated - macroalgae) ~                   s(mbdepth,     k = 5, bs = \"cr\")  +                   s(detrended, k = 5, bs = \"cr\") +                  s(tpi, k = 5, bs = \"cr\"),                 data = widedat, method = \"REML\", family = binomial(\"logit\")) summary(m_macro) ##  ## Family: binomial  ## Link function: logit  ##  ## Formula: ## cbind(macroalgae, total_points_annotated - macroalgae) ~ s(mbdepth,  ##     k = 5, bs = \"cr\") + s(detrended, k = 5, bs = \"cr\") + s(tpi,  ##     k = 5, bs = \"cr\") ##  ## Parametric coefficients: ##             Estimate Std. Error z value Pr(>|z|)     ## (Intercept)  -1.1228     0.1203  -9.336   <2e-16 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##                edf Ref.df Chi.sq p-value     ## s(mbdepth)   3.856  3.978 130.06  <2e-16 *** ## s(detrended) 3.818  3.970  42.82  <2e-16 *** ## s(tpi)       3.946  3.995 114.31  <2e-16 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## R-sq.(adj) =  0.486   Deviance explained =   70% ## -REML = 200.04  Scale est. = 1         n = 32 plot(m_macro, pages = 1, residuals = T, cex = 5) # Reef m_reef <- gam(cbind(reef, total_points_annotated - reef) ~                   s(aspect,     k = 5, bs = \"cr\")  +                   s(detrended, k = 5, bs = \"cr\") +                  s(roughness, k = 5, bs = \"cr\"),                 data = widedat, method = \"REML\", family = binomial(\"logit\")) summary(m_reef) ##  ## Family: binomial  ## Link function: logit  ##  ## Formula: ## cbind(reef, total_points_annotated - reef) ~ s(aspect, k = 5,  ##     bs = \"cr\") + s(detrended, k = 5, bs = \"cr\") + s(roughness,  ##     k = 5, bs = \"cr\") ##  ## Parametric coefficients: ##             Estimate Std. Error z value Pr(>|z|)     ## (Intercept)   17.238      3.503   4.921 8.62e-07 *** ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## Approximate significance of smooth terms: ##                edf Ref.df  Chi.sq p-value     ## s(aspect)    3.854  3.978  69.703  <2e-16 *** ## s(detrended) 3.729  3.948 100.173  <2e-16 *** ## s(roughness) 1.860  2.096   8.829  0.0165 *   ## --- ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ##  ## R-sq.(adj) =  0.915   Deviance explained = 86.7% ## -REML = 64.978  Scale est. = 1         n = 32 plot(m_reef, pages = 1, residuals = T, cex = 5)"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"predict-rasterise-and-plot-habitat-predictions","dir":"Articles > R-workflows","previous_headings":"","what":"Predict, rasterise and plot habitat predictions","title":"Generate spatial predictions of habitat using FSSgam","text":"","code":"preddf <- cbind(preddf,                  \"pmacro\" = predict(m_macro, preddf, type = \"response\"),                 \"prock\" = predict(m_rock, preddf, type = \"response\"),                 \"psand\" = predict(m_sand, preddf, type = \"response\"),                 \"pseagrass\" = predict(m_seagrass, preddf, type = \"response\"),                 \"pinverts\" = predict(m_inverts, preddf, type = \"response\"),                 \"preef\" = predict(m_reef, preddf, type = \"response\")) %>%   glimpse() ## Rows: 73,350 ## Columns: 16 ## $ x         <dbl> 115.1714, 115.1739, 115.1764, 115.1789, 115.1814, 115.1839, … ## $ y         <dbl> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33.6… ## $ mbdepth   <dbl> -14.83014, -13.89184, -14.18757, -14.48647, -14.47323, -14.3… ## $ slope     <dbl> 0.24350203, 0.19746646, 0.17799167, 0.18316828, 0.22091857, … ## $ aspect    <dbl> 339.995240, 341.597571, 21.180346, 12.600024, 356.337121, 35… ## $ tpi       <dbl> -3.721524e-01, 5.277313e-01, 1.502453e-01, -1.123428e-03, 9.… ## $ tri       <dbl> 0.9656481, 0.8277034, 0.6934198, 0.6945946, 0.8081013, 0.902… ## $ roughness <dbl> 2.807414, 2.421717, 2.196986, 2.156502, 2.581898, 2.606502, … ## $ detrended <dbl> -2.871674, -2.161609, -2.683798, -3.207528, -3.417629, -3.56… ## $ depth     <dbl> 14.83014, 13.89184, 14.18757, 14.48647, 14.47323, 14.39490, … ## $ pmacro    <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, … ## $ prock     <dbl> 0.003615863, 0.001094975, 0.016496455, 0.070776192, 0.002887… ## $ psand     <dbl> 2.220446e-16, 2.220446e-16, 8.055590e-05, 5.453682e-05, 2.22… ## $ pseagrass <dbl> 0.8902369, 0.9195383, 0.7179510, 0.5948303, 0.9359649, 0.930… ## $ pinverts  <dbl> 0.002299087, 0.002142416, 0.002216036, 0.002736343, 0.002876… ## $ preef     <dbl> 1.0000000, 1.0000000, 0.9999194, 0.9999455, 1.0000000, 1.000…"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"tidy-and-save-the-final-dataset","dir":"Articles > R-workflows","previous_headings":"","what":"Tidy and save the final dataset","title":"Generate spatial predictions of habitat using FSSgam","text":"Create column ‘dominant’ habitat Save final predictions","code":"preddf$dom_tag <- apply(preddf %>% dplyr::select(pmacro, prock, psand, pseagrass, pinverts), 1,                          FUN = function(x){names(which.max(x))}) glimpse(preddf) ## Rows: 73,350 ## Columns: 17 ## $ x         <dbl> 115.1714, 115.1739, 115.1764, 115.1789, 115.1814, 115.1839, … ## $ y         <dbl> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33.6… ## $ mbdepth   <dbl> -14.83014, -13.89184, -14.18757, -14.48647, -14.47323, -14.3… ## $ slope     <dbl> 0.24350203, 0.19746646, 0.17799167, 0.18316828, 0.22091857, … ## $ aspect    <dbl> 339.995240, 341.597571, 21.180346, 12.600024, 356.337121, 35… ## $ tpi       <dbl> -3.721524e-01, 5.277313e-01, 1.502453e-01, -1.123428e-03, 9.… ## $ tri       <dbl> 0.9656481, 0.8277034, 0.6934198, 0.6945946, 0.8081013, 0.902… ## $ roughness <dbl> 2.807414, 2.421717, 2.196986, 2.156502, 2.581898, 2.606502, … ## $ detrended <dbl> -2.871674, -2.161609, -2.683798, -3.207528, -3.417629, -3.56… ## $ depth     <dbl> 14.83014, 13.89184, 14.18757, 14.48647, 14.47323, 14.39490, … ## $ pmacro    <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, … ## $ prock     <dbl> 0.003615863, 0.001094975, 0.016496455, 0.070776192, 0.002887… ## $ psand     <dbl> 2.220446e-16, 2.220446e-16, 8.055590e-05, 5.453682e-05, 2.22… ## $ pseagrass <dbl> 0.8902369, 0.9195383, 0.7179510, 0.5948303, 0.9359649, 0.930… ## $ pinverts  <dbl> 0.002299087, 0.002142416, 0.002216036, 0.002736343, 0.002876… ## $ preef     <dbl> 1.0000000, 1.0000000, 0.9999194, 0.9999455, 1.0000000, 1.000… ## $ dom_tag   <chr> \"pmacro\", \"pmacro\", \"pmacro\", \"pmacro\", \"pmacro\", \"pmacro\", … saveRDS(preddf, file = here::here(paste0(\"r-workflows/model output/habitat/\",                                name, \"_habitat-prediction.RDS\")))"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"set-up-for-plotting","dir":"Articles > R-workflows","previous_headings":"","what":"Set up for plotting","title":"Generate spatial predictions of habitat using FSSgam","text":"Load marine park data. dataset used 2022 Collaborative Australian Protected Areas Database, available free download https://fed.dcceew.gov.au/datasets/782c02c691014efe8ffbd27445fe41d7_0/explore. Feel free replace shapefile suitable dataset available study area. Set colours habitat plotting.","code":"marine.parks <- st_read(here::here(\"r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp\")) %>%   st_make_valid() %>%   dplyr::mutate(ZONE_TYPE = str_replace_all(ZONE_TYPE,\"\\\\s*\\\\([^\\\\)]+\\\\)\", \"\")) %>%   dplyr::filter(str_detect(ZONE_TYPE, \"Sanctuary|National Park\"), STATE %in% \"WA\") %>%                           st_transform(4326) ## Reading layer `Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine' from data source `/home/runner/work/CheckEM/CheckEM/r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp'  ##   using driver `ESRI Shapefile' ## Simple feature collection with 3775 features and 26 fields ## Geometry type: MULTIPOLYGON ## Dimension:     XY ## Bounding box:  xmin: 70.71702 ymin: -58.44947 xmax: 170.3667 ymax: -8.473407 ## Geodetic CRS:  WGS 84 unique(preddf$dom_tag) ## [1] \"pmacro\"    \"psand\"     \"pinverts\"  \"pseagrass\" \"prock\" hab_fills <- scale_fill_manual(values = c(   \"psand\" = \"wheat\",   \"pinverts\" = \"plum\",   \"pseagrass\" = \"forestgreen\",   \"pmacro\" = \"darkgoldenrod4\" ), name = \"Habitat\")"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"plot-the-dominant-habitats","dir":"Articles > R-workflows","previous_headings":"","what":"Plot the dominant habitats","title":"Generate spatial predictions of habitat using FSSgam","text":"Build plot elements display.","code":"ggplot() +   geom_tile(data = preddf, aes(x, y, fill = dom_tag)) +   hab_fills +    new_scale_fill() +   geom_sf(data = marine.parks, fill = NA, colour = \"#7bbc63\",            size = 0.2, show.legend = F) +   coord_sf(xlim = c(min(preddf$x), max(preddf$x)),            ylim = c(min(preddf$y), max(preddf$y))) +   labs(x = NULL, y = NULL, colour = NULL) +   theme_minimal()"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/habitat-modelling.html","id":"plot-the-individual-habitat-probabilities","dir":"Articles > R-workflows","previous_headings":"","what":"Plot the individual habitat probabilities","title":"Generate spatial predictions of habitat using FSSgam","text":"Transform habitat predictions long format easy plotting ggplot::facet_wrap. Build plot elements individual habitat probabilities.","code":"indclass <- preddf %>%   pivot_longer(cols = starts_with(\"p\"), names_to = \"habitat\",                 values_to = \"Probability\") %>%   dplyr::mutate(habitat = case_when(habitat %in% \"pinverts\" ~ \"Sessile invertebrates\",                                     habitat %in% \"pmacro\" ~ \"Macroalgae\",                                     habitat %in% \"prock\" ~ \"Rock\",                                     habitat %in% \"psand\" ~ \"Sand\",                                     habitat %in% \"pseagrass\" ~ \"Seagrass\",                                     habitat %in% \"preef\" ~ \"Reef\")) %>%   glimpse() ## Rows: 440,100 ## Columns: 13 ## $ x           <dbl> 115.1714, 115.1714, 115.1714, 115.1714, 115.1714, 115.1714… ## $ y           <dbl> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33… ## $ mbdepth     <dbl> -14.83014, -14.83014, -14.83014, -14.83014, -14.83014, -14… ## $ slope       <dbl> 0.2435020, 0.2435020, 0.2435020, 0.2435020, 0.2435020, 0.2… ## $ aspect      <dbl> 339.99524, 339.99524, 339.99524, 339.99524, 339.99524, 339… ## $ tpi         <dbl> -0.372152448, -0.372152448, -0.372152448, -0.372152448, -0… ## $ tri         <dbl> 0.9656481, 0.9656481, 0.9656481, 0.9656481, 0.9656481, 0.9… ## $ roughness   <dbl> 2.807414, 2.807414, 2.807414, 2.807414, 2.807414, 2.807414… ## $ detrended   <dbl> -2.871674, -2.871674, -2.871674, -2.871674, -2.871674, -2.… ## $ depth       <dbl> 14.83014, 14.83014, 14.83014, 14.83014, 14.83014, 14.83014… ## $ dom_tag     <chr> \"pmacro\", \"pmacro\", \"pmacro\", \"pmacro\", \"pmacro\", \"pmacro\"… ## $ habitat     <chr> \"Macroalgae\", \"Rock\", \"Sand\", \"Seagrass\", \"Sessile inverte… ## $ Probability <dbl> 1.000000e+00, 3.615863e-03, 2.220446e-16, 8.902369e-01, 2.… ggplot() +   geom_tile(data = indclass, aes(x, y, fill = Probability)) +   scale_fill_viridis(option = \"D\", direction = -1) +   new_scale_fill() +                        geom_sf(data = marine.parks, fill = NA, colour = \"#7bbc63\",            size = 0.2, show.legend = F) +   coord_sf(xlim = c(min(preddf$x), max(preddf$x)),            ylim = c(min(preddf$y), max(preddf$y))) +   labs(x = NULL, y = NULL, fill = \"Probability\") +   theme_minimal() +   facet_wrap(~habitat) +   theme(axis.text.x = element_text(size = 7))"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/spatial-layers.html","id":"r-set-up","dir":"Articles > R-workflows","previous_headings":"","what":"R set up","title":"Generate spatial layers for modelling","text":"Load necessary libraries. Set study name.","code":"library(sf) library(terra) library(stars) library(starsExtra) library(tidyverse) library(here) name <- 'example-bruv-workflow'"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/spatial-layers.html","id":"load-bathymetry-data-and-create-bathymetry-derivatives","dir":"Articles > R-workflows","previous_headings":"","what":"Load bathymetry data and create bathymetry derivatives","title":"Generate spatial layers for modelling","text":"bathymetry data used example relatively low spatial resolution dataset downloaded https://ecat.ga.gov.au/geonetwork/srv/eng/catalog.search#/metadata/148758. Feel free replace suitable bathymetry .tif format. Calculate terrain derivatives. Calculate detrended bathymetry. Join bathymetry terrain detrended derivatives. Save spatial-layers.","code":"bathy <- rast(here::here(\"r-workflows/data/spatial/rasters/swc_ga250m.tif\")) %>%   clamp(upper = 0, lower = -250, values = F) %>%   trim() preds <- terrain(bathy, neighbors = 8,                  v = c(\"slope\", \"aspect\", \"TPI\", \"TRI\", \"roughness\"),           # Remove here as necessary                  unit = \"degrees\") zstar <- st_as_stars(bathy)                                                     detre <- detrend(zstar, parallel = 8)                                            detre <- as(object = detre, Class = \"SpatRaster\")                                names(detre) <- c(\"detrended\", \"lineartrend\") preds <- rast(list(bathy, preds, detre[[1]]))                                    names(preds)[1] <- \"mbdepth\" preds_w <- wrap(preds) saveRDS(preds_w,            file = here::here(paste0(\"r-workflows/data/spatial/rasters/\",                          name, \"_bathymetry_derivatives.rds\")))"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/spatial-layers.html","id":"load-metadata-and-extract-site-specific-derivatives","dir":"Articles > R-workflows","previous_headings":"","what":"Load metadata and extract site-specific derivatives","title":"Generate spatial layers for modelling","text":"Read metadata. Convert metadata spatial file. Check see metadata bathymetry align correctly. Add latitude longitude coordinates back metadata. Extract bathymetry derivatives sampling location.","code":"metadata <- readRDS(here::here(paste0(\"r-workflows/data/tidy/\",                              name, \"_Metadata.rds\"))) %>%   dplyr::mutate(longitude_dd = as.numeric(longitude_dd),                 latitude_dd = as.numeric(latitude_dd)) %>%   glimpse() ## Rows: 32 ## Columns: 12 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", \"3… ## $ longitude_dd                <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ latitude_dd                 <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:49\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\", … ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … metadata.vect <- vect(metadata, geom = c(\"longitude_dd\", \"latitude_dd\"), crs = \"epsg:4326\") plot(preds[[1]]) plot(metadata.vect, add = T) tidy.metadata_t   <- as.data.frame(metadata.vect, geom = \"XY\") %>%   left_join(metadata) ## Joining with `by = join_by(campaignid, sample, date_time, location, site, ## depth, successful_count, successful_length, successful_habitat_forward, ## successful_habitat_backward)` metadata.bathy.derivatives   <- cbind(tidy.metadata_t,                                       terra::extract(preds, metadata.vect)) %>%   dplyr::filter(!is.na(depth),                                                                   !is.na(roughness)) %>%   glimpse() ## Rows: 32 ## Columns: 22 ## $ campaignid                  <chr> \"2023-03_SwC_stereo-BRUVs\", \"2023-03_SwC_s… ## $ sample                      <chr> \"35\", \"5\", \"26\", \"23\", \"29\", \"4\", \"32\", \"3… ## $ date_time                   <chr> \"14/03/2023 23:36\", \"14/03/2023 23:49\", \"1… ## $ location                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ site                        <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA… ## $ depth                       <chr> \"39.6\", \"42.7\", \"36\", \"41\", \"42.6\", \"45\", … ## $ successful_count            <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_length           <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_forward  <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ successful_habitat_backward <chr> \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", \"Yes\", … ## $ x                           <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ y                           <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ longitude_dd                <dbl> 114.9236, 114.9292, 114.9284, 114.9190, 11… ## $ latitude_dd                 <dbl> -34.13155, -34.12953, -34.12729, -34.12832… ## $ ID                          <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,… ## $ mbdepth                     <dbl> -34.97151, -36.35807, -40.68553, -38.25594… ## $ slope                       <dbl> 0.146843375, 0.812689749, 0.694289634, 0.4… ## $ aspect                      <dbl> 209.89577, 62.41434, 40.87387, 294.10675, … ## $ TPI                         <dbl> 0.42153454, 2.39535522, -0.67607403, 0.476… ## $ TRI                         <dbl> 0.75557327, 3.29823494, 2.39221191, 1.8367… ## $ roughness                   <dbl> 2.21119308, 8.36493301, 8.36493301, 5.3012… ## $ detrended                   <dbl> -5.6631737, -7.0394716, -11.2637815, -8.69…"},{"path":"https://globalarchivemanual.github.io/CheckEM/articles/r-workflows/spatial-layers.html","id":"save-the-joined-metadata-and-bathymetry-derivatives","dir":"Articles > R-workflows","previous_headings":"","what":"Save the joined metadata and bathymetry derivatives","title":"Generate spatial layers for modelling","text":"","code":"saveRDS(metadata.bathy.derivatives, here::here(paste0(\"r-workflows/data/tidy/\", name, \"_metadata-bathymetry-derivatives.rds\")))"},{"path":"https://globalarchivemanual.github.io/CheckEM/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Brooke Gibbons. Author, maintainer. Claude Spencer. Author. Tim Langlois. Author. Todd Bond. Contributor. Jacquomo Monk. Contributor. Jordan Goetze. Contributor. . Funder. . Funder.","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Gibbons B, Spencer C, Langlois T (2023). CheckEM: R package Shiny App Formatting, Checking, Visualising Analysing Stereo-Video Annotation Data. R package version 1.0, https://globalarchivemanual.github.io/CheckEM/.","code":"@Manual{,   title = {CheckEM: An R package and Shiny App for Formatting, Checking, Visualising and Analysing Stereo-Video Annotation Data},   author = {Brooke Gibbons and Claude Spencer and Tim Langlois},   year = {2023},   note = {R package version 1.0},   url = {https://globalarchivemanual.github.io/CheckEM/}, }"},{"path":"https://globalarchivemanual.github.io/CheckEM/index.html","id":"checkem","dir":"","previous_headings":"","what":"An R package and Shiny App for Formatting, Checking, Visualising and Analysing Stereo-Video Annotation Data","title":"An R package and Shiny App for Formatting, Checking, Visualising and Analysing Stereo-Video Annotation Data","text":"CheckEM R package shiny app checking, visualizing analysing stereo-video annotation data. idea behind CheckEM provide fish benthic ecologists set tools quickly effectively quality control, format analyse data collected using stereo-video methods. provided: R workflows fish benthic annotation data sets using functions CheckEM. web based app hosted shinyapps.io enable users stereo-video aren’t familiar R quality control format annotations user guide CheckEM shiny app Annotation guides EventMeasure TransectMeasure. hope efforts standardise annotation QC stereo-video data result data meet FAIR principles interoperability reusability.","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/index.html","id":"to-install-in-r","dir":"","previous_headings":"","what":"To install in R","title":"An R package and Shiny App for Formatting, Checking, Visualising and Analysing Stereo-Video Annotation Data","text":"","code":"install.packages('devtools') library('devtools')  devtools::install_github(\"GlobalArchiveManual/CheckEM\") library(CheckEM)"},{"path":"https://globalarchivemanual.github.io/CheckEM/index.html","id":"checkem-is-available-as-a-shiny-app","dir":"","previous_headings":"","what":"CheckEM is available as a shiny app","title":"An R package and Shiny App for Formatting, Checking, Visualising and Analysing Stereo-Video Annotation Data","text":"CheckEM available web based app hosted shinyapps.io can accessed link can run local version CheckEM (without internet) using R via:","code":"CheckEM::runCheckEM()"},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/clean_names.html","id":null,"dir":"Reference","previous_headings":"","what":"A function to standardise names in a dataframe — clean_names","title":"A function to standardise names in a dataframe — clean_names","text":"function standardise names dataframe","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/clean_names.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A function to standardise names in a dataframe — clean_names","text":"","code":"clean_names(dat)"},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/clean_names.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"A function to standardise names in a dataframe — clean_names","text":"dat","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/clean_names.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"A function to standardise names in a dataframe — clean_names","text":"dataframe lower case names, _ separators","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/has_special_characters.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to check if a string contains any special characters — has_special_characters","title":"Function to check if a string contains any special characters — has_special_characters","text":"Function check string contains special characters","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/has_special_characters.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to check if a string contains any special characters — has_special_characters","text":"","code":"has_special_characters(string)"},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/has_special_characters.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to check if a string contains any special characters — has_special_characters","text":"string","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_TM.html","id":null,"dir":"Reference","previous_headings":"","what":"A function to read .txt exports from SeaGIS TransectMeasure — read_TM","title":"A function to read .txt exports from SeaGIS TransectMeasure — read_TM","text":"function read .txt exports SeaGIS TransectMeasure","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_TM.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A function to read .txt exports from SeaGIS TransectMeasure — read_TM","text":"","code":"read_TM(dir, sample)"},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_TM.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"A function to read .txt exports from SeaGIS TransectMeasure — read_TM","text":"dir directory .txt files saved sample Either character value define sample recorded \"opcode\" \"period\"","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_TM.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"A function to read .txt exports from SeaGIS TransectMeasure — read_TM","text":"dataframe column campaignID sample","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_files_txt.html","id":null,"dir":"Reference","previous_headings":"","what":"Title — read_files_txt","title":"Title — read_files_txt","text":"Title","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_files_txt.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Title — read_files_txt","text":"","code":"read_files_txt(dir)"},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_files_txt.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Title — read_files_txt","text":"flnm","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_metadata.html","id":null,"dir":"Reference","previous_headings":"","what":"A function to read GlobalArchive format metadata — read_metadata","title":"A function to read GlobalArchive format metadata — read_metadata","text":"function read GlobalArchive format metadata","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_metadata.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A function to read GlobalArchive format metadata — read_metadata","text":"","code":"read_metadata(dir)"},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_metadata.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"A function to read GlobalArchive format metadata — read_metadata","text":"dir directory .txt files saved","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/read_metadata.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"A function to read GlobalArchive format metadata — read_metadata","text":"dataframe column campaignID sample","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/runCheckEM.html","id":null,"dir":"Reference","previous_headings":"","what":"Run CheckEM shiny app locally — runCheckEM","title":"Run CheckEM shiny app locally — runCheckEM","text":"Run CheckEM shiny app locally","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/runCheckEM.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run CheckEM shiny app locally — runCheckEM","text":"","code":"runCheckEM()"},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/runCheckEM.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run CheckEM shiny app locally — runCheckEM","text":"launch local version CheckEM browser","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/runCheckEM.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Run CheckEM shiny app locally — runCheckEM","text":"","code":"## Not run: if (FALSE) CheckEM::runCheckEM()"},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/standardize_tibble.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to standardize column names and types — standardize_tibble","title":"Function to standardize column names and types — standardize_tibble","text":"Function standardize column names types","code":""},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/standardize_tibble.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to standardize column names and types — standardize_tibble","text":"","code":"standardize_tibble(tibble)"},{"path":"https://globalarchivemanual.github.io/CheckEM/reference/standardize_tibble.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to standardize column names and types — standardize_tibble","text":"tibble","code":""}]
