<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Format &amp; visualise habitat data • CheckEM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../favicon.ico">
<link rel="manifest" href="../../site.webmanifest">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Format &amp; visualise habitat data">
<meta name="google-site-verification" content="m4gXBtqSSJWTmWMwNasopAohP855o_IZ16gJxBTnZ1o">
<!-- Global site tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XRY4CFB9QS"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XRY4CFB9QS');
</script><meta name="google-site-verification" content="m4gXBtqSSJWTmWMwNasopAohP855o_IZ16gJxBTnZ1o">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">CheckEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Field Manuals</h6></li>
    <li><a class="external-link dropdown-item" href="https://benthic-bruvs-field-manual.github.io/">Baited Remote Underwater Stereo-video (stereo-BRUVs)</a></li>
    <li><a class="external-link dropdown-item" href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13189">Diver Operated Stereo-video (stereo-DOVs)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Annotation Guides</h6></li>
    <li><a class="dropdown-item" href="../../articles/manuals/EventMeasure_annotation_guide.html">Fish annotation guide (EventMeasure)</a></li>
    <li><a class="dropdown-item" href="../../articles/manuals/TransectMeasure_annotation_guide.html">Benthos annotation guide (TransectMeasure)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>CheckEM Guides</h6></li>
    <li><a class="dropdown-item" href="../../articles/manuals/CheckEM_user_guide.html">CheckEM PDF user manual</a></li>
    <li><a class="dropdown-item" href="../../articles/manuals/CheckEM_video.html">CheckEM instructional video</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-r-workflows" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">R Workflows</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-r-workflows">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Create sampling design</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/sampling-design.html">Create a spatially-balanced sampling design using GRTS</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Check Data</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-habitat.html">Check habitat data from TransectMeasure</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-fish-point.html">Check fish data from single point based methods</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-fish-transect.html">Check fish data from transect based methods</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Format Data</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/spatial-layers.html">Generate spatial layers for modelling</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/format-visualise-habitat.html">Format &amp; visualise habitat data</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/format-visualise-fish.html">Format &amp; visualise fish data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/habitat-modelling.html">Generate spatial predictions of habitat using FSSgam</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-modelling.html">Select top models for fish using FSSgam</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-predictions.html">Generate Generalized Additive Model predictions of fish</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-spatial-prediction.html">Spatially predict fish distributions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../articles/community-updates">Improve CheckEM - Contribute to Species Records</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GlobalArchiveManual/CheckEM"><span class="fa fa-github"></span> GitHub</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.nespmarinecoastal.edu.au/">ARDC</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Format &amp; visualise habitat data</h1>
                        <h4 data-toc-skip class="author">Claude Spencer
&amp; Brooke Gibbons</h4>
            
            <h4 data-toc-skip class="date">2023-11-13</h4>
      

      <div class="d-none name"><code>format-visualise-habitat.Rmd</code></div>
    </div>

    
    
<p>This script takes the checked habitat data from the previous workflow
steps, visualises the data and exports it into a format suitable for
modelling. The exploratory visualisation of the data allows for trends
and patterns in the raw data to be investigated.</p>
<div class="section level2">
<h2 id="r-set-up">R set up<a class="anchor" aria-label="anchor" href="#r-set-up"></a>
</h2>
<p>Load the necessary libraries.</p>
<!-- ```{r libraries, results='hide', warning=FALSE, message=FALSE} -->
<!-- library('remotes') -->
<!-- options(timeout=9999999) -->
<!-- # remotes::install_github("GlobalArchiveManual/CheckEM") -->
<!-- library(CheckEM) -->
<!-- library(tidyverse) -->
<!-- library(ggbeeswarm) -->
<!-- library(RColorBrewer) -->
<!-- library(leaflet) -->
<!-- library(leaflet.minicharts) -->
<!-- library(here) -->
<!-- ``` -->
<!-- Set the study name. -->
<!-- ```{r study-name} -->
<!-- name <- "example-bruv-workflow" -->
<!-- ``` -->
<!-- # Read in the data -->
<!-- Load the metadata with bathymetry derivatives joined on. -->
<!-- ```{r load-metadata} -->
<!-- metadata.bathy.derivatives <- readRDS(here::here(paste0("r-workflows/data/tidy/", name, "_metadata-bathymetry-derivatives.rds"))) %>% -->
<!--   dplyr::mutate(sample = as.character(sample)) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Load the habitat data and format it into 'broad' classes for modelling. The classes included in the example are just a recommendation, however when deciding on your own habitat classes to model, we suggest using ecologically meaningful classes that will not be too rare to model. -->
<!-- ```{r load-habitat} -->
<!-- habitat <- readRDS(here::here(paste0("r-workflows/data/staging/", name, "_habitat.rds"))) %>% -->
<!--   dplyr::mutate(habitat = case_when(level_2 %in% "Macroalgae" ~ level_2, level_2 %in% "Seagrasses" ~ level_2, level_2 %in% "Substrate" & level_3 %in% "Consolidated (hard)" ~ level_3, level_2 %in% "Substrate" & level_3 %in% "Unconsolidated (soft)" ~ level_3,  level_2 %in% "Sponges" ~ "Sessile invertebrates", level_2 %in% "Sessile invertebrates" ~ level_2, level_2 %in% "Bryozoa" ~ "Sessile invertebrates", level_2 %in% "Cnidaria" ~ "Sessile invertebrates")) %>%  -->
<!--   dplyr::select(campaignid, sample, habitat, count) %>% -->
<!--   group_by(campaignid, sample, habitat) %>%  -->
<!--   dplyr::summarise(count = sum(count)) %>%  -->
<!--   dplyr::mutate(total_points_annotated = sum(count)) %>%  -->
<!--   ungroup() %>%  -->
<!--   pivot_wider(names_from = "habitat", values_from = "count", values_fill = 0) %>% -->
<!--   dplyr::mutate(reef = Macroalgae + Seagrasses + `Sessile invertebrates` + `Consolidated (hard)`) %>% -->
<!--   pivot_longer(cols = c("Macroalgae", "Seagrasses", "Sessile invertebrates", "Consolidated (hard)", "Unconsolidated (soft)", "reef"), names_to = "habitat", values_to = "count") %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Load the relief data and summarise this into mean and standard deviation relief. -->
<!-- ```{r load-relief} -->
<!-- tidy.relief <- readRDS(here::here(paste0("r-workflows/data/staging/", name, "_relief.rds"))) %>% -->
<!--   uncount(count) %>% -->
<!--   group_by(campaignid, sample) %>% -->
<!--   dplyr::summarise(mean.relief = mean(as.numeric(level_5)), sd.relief = sd(as.numeric(level_5), na.rm = T)) %>% -->
<!--   ungroup() %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- # Format the habitat and relief data for plotting and modelling -->
<!-- Join the habitat data with relief, metadata and bathymetry derivatives. -->
<!-- ```{r format-habitat} -->
<!-- tidy.habitat <- metadata.bathy.derivatives %>% -->
<!--   left_join(habitat) %>% -->
<!--   left_join(tidy.relief) %>% -->
<!--   dplyr::mutate(longitude_dd = as.numeric(longitude_dd), -->
<!--                 latitude_dd = as.numeric(latitude_dd)) %>% -->
<!--   clean_names() %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Format the relief into a format suitable for exploratory plotting. -->
<!-- ```{r format-relief} -->
<!-- plot.relief <- readRDS(here::here(paste0("r-workflows/data/staging/", name, "_relief.rds"))) %>% -->
<!--   group_by(campaignid, sample, level_5) %>% -->
<!--   dplyr::summarise(count = sum(count)) %>% -->
<!--   ungroup() %>% -->
<!--   dplyr::mutate(class.relief = as.factor(level_5)) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- # Visualise the habitat and relief data -->
<!-- Plot the occurence data per habitat class. Each data point represents a unique sample. -->
<!-- ```{r plot-habitat} -->
<!-- ggplot() + -->
<!--   geom_quasirandom(data = tidy.habitat, aes(x = (count/total_points_annotated), y = habitat), groupOnX = F, method = "quasirandom", alpha = 0.25, size = 1.8, width = 0.2) + -->
<!--   labs(x = "Number of points", y = "") + -->
<!--   theme_classic() -->
<!-- ``` -->
<!-- Plot the occurence data for each level of relief. -->
<!-- ```{r plot-relief} -->
<!-- ggplot() + -->
<!--   geom_quasirandom(data = plot.relief, aes(x = count, y = class.relief), groupOnX = F, method = "quasirandom", alpha = 0.25, size = 1.8, width = 0.05) + -->
<!--   labs(x = "Number of points", y = "Relief (0-5)") +  -->
<!--   theme_classic() -->
<!-- ``` -->
<!-- Create a colour palette for plotting. -->
<!-- ```{r colours} -->
<!-- cols <- colorRampPalette(brewer.pal(12, "Paired"))(length(unique(tidy.habitat$habitat)))  -->
<!-- ``` -->
<!-- Format the habitat into wide format suitable for plotting. -->
<!-- ```{r wide-habitat} -->
<!-- plot.habitat <- tidy.habitat %>% -->
<!--   pivot_wider(names_from = "habitat", values_from = "count", names_prefix = "broad.") %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Visualise the habitat classes as spatial pie charts. -->
<!-- ```{r pie-charts} -->
<!-- leaflet() %>%                                           -->
<!--   addTiles(group = "Open Street Map") %>%                            -->
<!--   addProviderTiles('Esri.WorldImagery', group = "World Imagery") %>% -->
<!--   addLayersControl(baseGroups = c("World Imagery", "Open Street Map"), options = layersControlOptions(collapsed = FALSE)) %>% -->
<!--   addMinicharts(plot.habitat$longitude_dd, plot.habitat$latitude_dd, type = "pie", colorPalette = cols, chartdata = plot.habitat[grep("broad", names(plot.habitat))], width = 20, transitionTime = 0) %>%                  -->
<!--   setView(mean(as.numeric(plot.habitat$longitude_dd)),  -->
<!--           mean(as.numeric(plot.habitat$latitude_dd)), zoom = 12) -->
<!-- ``` -->
<!-- Choose an individual habitat class to visualise as spatial bubble plots. -->
<!-- ```{r individual-habitats} -->
<!-- hab.name <- 'Sessile invertebrates' -->
<!-- overzero <-  tidy.habitat %>%  -->
<!--   filter(habitat %in% hab.name & count > 0)  -->
<!-- equalzero <- tidy.habitat %>%  -->
<!--   filter(habitat %in% hab.name & count == 0) -->
<!-- ``` -->
<!-- Visualise the individual habitat classes. -->
<!-- ```{r bubble-plots} -->
<!-- bubble.plot <- leaflet(data = tidy.habitat) %>%                      -->
<!--   addTiles() %>%                                                     -->
<!--   addProviderTiles('Esri.WorldImagery', group = "World Imagery") %>% -->
<!--   addLayersControl(baseGroups = c("Open Street Map", "World Imagery"), options = layersControlOptions(collapsed = FALSE)) -->
<!-- if (nrow(overzero)) {                                                -->
<!--   bubble.plot <- bubble.plot %>% -->
<!--     addCircleMarkers(data = overzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = ~ count + 3, fillOpacity = 0.5, stroke = FALSE, label = ~ as.character(sample))} -->
<!-- if (nrow(equalzero)) {                                             -->
<!--   bubble.plot <- bubble.plot %>% -->
<!--     addCircleMarkers(data = equalzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = 2, fillOpacity = 0.5, color = "white", stroke = FALSE, label = ~ as.character(sample))} -->
<!-- bubble.plot -->
<!-- ``` -->
<!-- # Save the final tidy habitat data -->
<!-- ```{r save-habitat} -->
<!-- saveRDS(tidy.habitat, file = here::here(paste("r-workflows/data/tidy/", paste(name,"tidy-habitat.rds", sep = "_"), sep = "/"))) -->
<!-- ``` -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p><img src="https://ardc.edu.au/wp-content/uploads/2022/09/ardc-logo.svg" height="60" alt="ARDC">    <img src="https://www.nespmarinecoastal.edu.au/wp-content/themes/MarineAndCoastalHubTheme/images/logo.svg" height="70" alt="National Environmental Science Program: Marine and Coastal">     Package developed by Brooke Gibbons, Claude Spencer, Tim Langlois.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
