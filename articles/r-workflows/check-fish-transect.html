<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CheckEM">
<title>Check fish data from transect based methods • CheckEM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Check fish data from transect based methods">
<meta property="og:description" content="CheckEM">
<meta property="og:image" content="https://globalarchivemanual.github.io/CheckEM/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XRY4CFB9QS"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XRY4CFB9QS');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light" data-bs-theme="default"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">CheckEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-user-guides">User Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-user-guides">
    <h6 class="dropdown-header" data-toc-skip>Field Manuals</h6>
    <a class="external-link dropdown-item" href="https://benthic-bruvs-field-manual.github.io/">Baited Remote Underwater Stereo-video (stereo-BRUVs)</a>
    <a class="external-link dropdown-item" href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13189">Diver Operated Stereo-video (stereo-DOVs)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Annotation Guides</h6>
    <a class="dropdown-item" href="../../articles/manuals/EventMeasure_annotation_guide.html">Fish annotation guide (EventMeasure)</a>
    <a class="dropdown-item" href="../../articles/manuals/TransectMeasure_annotation_guide.html">Benthos annotation guide (TransectMeasure)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>CheckEM Guides</h6>
    <a class="dropdown-item" href="../../articles/manuals/CheckEM_user_guide.html">CheckEM PDF user manual</a>
    <a class="dropdown-item" href="../../articles/manuals/CheckEM_video.html">CheckEM instructional video</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-r-workflows">R Workflows</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-r-workflows">
    <h6 class="dropdown-header" data-toc-skip>Check Data</h6>
    <a class="dropdown-item" href="../../articles/r-workflows/check-habitat.html">Check habitat data from TransectMeasure</a>
    <a class="dropdown-item" href="../../articles/r-workflows/check-fish-point.html">Check fish data from single point based methods</a>
    <a class="dropdown-item" href="../../articles/r-workflows/check-fish-transect.html">Check fish data from transect based methods</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Format Data</h6>
    <a class="dropdown-item" href="../../articles/r-workflows/spatial-layers.html">Generate spatial layers for modelling</a>
    <a class="dropdown-item" href="../../articles/r-workflows/format-visualise-habitat.html">Format &amp; visualise habitat data</a>
    <a class="dropdown-item" href="../../articles/r-workflows/format-visualise-fish.html">Format &amp; visualise fish data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Modelling</h6>
    <a class="dropdown-item" href="../../articles/r-workflows/habitat-modelling.html">Generate spatial predictions of habitat using FSSgam</a>
    <a class="dropdown-item" href="../../articles/r-workflows/fish-modelling.html">Select top models for fish using FSSgam</a>
    <a class="dropdown-item" href="../../articles/r-workflows/fish-predictions.html">Generate Generalized Additive Model predictions of fish</a>
    <a class="dropdown-item" href="../../articles/r-workflows/fish-spatial-prediction.html">Spatially predict fish distributions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../reference/r-workflows/index.html">Functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GlobalArchiveManual/CheckEM" aria-label="GitHub">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.nespmarinecoastal.edu.au/" aria-label="ARDC"></a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Check fish data from transect based methods</h1>
                        <h4 data-toc-skip class="author">Brooke Gibbons,
Claude Spencer &amp; Jordan Goetze</h4>
            
            <h4 data-toc-skip class="date">2024-01-19</h4>
      
      
      <div class="d-none name"><code>check-fish-transect.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This script will take fish annotation data from transect based
methods (e.g. stereo-DOVs or ROVs), either exported from EventMeasure or
“Generic” format (see format requirements <a href="https://globalarchivemanual.github.io/CheckEM/articles/manuals/CheckEM_user_guide.html">here</a>),
and check for any errors in the annotation. The script will then format
the annotation data into a tidy format.</p>
<p>You also need a formatted sample metadata file “*_Metadata.csv” (see
format requirements <a href="https://globalarchivemanual.github.io/CheckEM/articles/manuals/CheckEM_user_guide.html">here</a>)</p>
</div>
<div class="section level2">
<h2 id="r-set-up">R set up<a class="anchor" aria-label="anchor" href="#r-set-up"></a>
</h2>
<p>First you will need to load the necessary libraries. If you haven’t
installed CheckEM before you will need to install CheckEM using the
install_github function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="co"># devtools::install_github("GlobalArchiveManual/CheckEM") # Use this to install the CheckEM package if you have not already done so</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://globalarchivemanual.github.io/CheckEM/">CheckEM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org" class="external-link">googlesheets4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span></code></pre></div>
<p>Next set the study name. This can be any name you like, all files
saved using this script will be prefixed with this name. Avoid having a
name that is too long. We recommend using a short project name that
includes the method e.g. “2020_ningaloo_stereo-BRUVs”.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">name</span> <span class="op">&lt;-</span> <span class="st">"example-dov-workflow"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="metadata">Metadata<a class="anchor" aria-label="anchor" href="#metadata"></a>
</h2>
<p>Now we load and tidy the metadata. If you have already completed this
step while checking your habitat data, then you can skip these next two
chunks of code and simply read in the metadata (see below).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_metadata.html">read_metadata</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"r-workflows/data/DOV example/raw/"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"DOVs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Change here to "DOVs"</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span>, <span class="va">longitude_dd</span>, <span class="va">latitude_dd</span>, <span class="va">date_time</span>, <span class="va">location</span>, <span class="va">site</span>, <span class="va">depth_m</span>, <span class="va">successful_count</span>, <span class="va">successful_length</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## reading metdata file: /home/runner/work/CheckEM/CheckEM/r-workflows/data/DOV example/raw//2009-05_Rottnest.sanctuaries_stereoDOVs_Metadata.csv</span></span></code></pre>
<pre><code><span><span class="co">## reading metdata file: /home/runner/work/CheckEM/CheckEM/r-workflows/data/DOV example/raw//2010-03_Rottnest.sanctuaries_stereoDOVs_Metadata.csv</span></span></code></pre>
<pre><code><span><span class="co">## Rows: 720</span></span>
<span><span class="co">## Columns: 10</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2009-05_Rottnest.sanctuaries_stereoDOVs", "2009-05_…</span></span>
<span><span class="co">## $ sample            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "9DAC1-1", "9DAC1-2", "9DAC1-3", "9DAC1-4", "9DAC1-5…</span></span>
<span><span class="co">## $ longitude_dd      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "115.5188948", "115.5188948", "115.5188948", "115.51…</span></span>
<span><span class="co">## $ latitude_dd       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "-31.98670238", "-31.98670238", "-31.98670238", "-31…</span></span>
<span><span class="co">## $ date_time         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2009-05-18T15:40:00+08:00", "2009-05-18T15:40:00+08…</span></span>
<span><span class="co">## $ location          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Armstrong", "Armstrong", "Armstrong", "Armstrong", …</span></span>
<span><span class="co">## $ site              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "AC1", "AC1", "AC1", "AC1", "AC1", "AC1", "AC1", "AC…</span></span>
<span><span class="co">## $ depth_m           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "11", "11", "11", "11", "11", "11", "11", "11", "11"…</span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span></code></pre>
<p>Save the metadata as an R data file (this creates a lighter file than
saving as a .csv or similar, it also maintains any column
formatting).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">metadata</span>, file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"r-workflows/data/tidy/"</span>,</span>
<span>                                <span class="va">name</span>, <span class="st">"_Metadata.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="marine-parks">Marine Parks<a class="anchor" aria-label="anchor" href="#marine-parks"></a>
</h3>
<p>Load marine park shape files, and extract fishing status
(e.g. ‘Fished’ or ‘No-take’) for use in modelling. The data set used
here is the 2022 Collaborative Australian Protected Areas Database,
which you can download for free <a href="https://fed.dcceew.gov.au/datasets/782c02c691014efe8ffbd27445fe41d7_0/explore" class="external-link">here</a>.</p>
<p>You may change this shape file to any suitable data set that is
available for your study area.</p>
<div class="section level4">
<h4 id="note-you-should-only-use-this-code-if-the-status-column-is-not-filled-out">NOTE: You should only use this code if the Status column is not
filled out<a class="anchor" aria-label="anchor" href="#note-you-should-only-use-this-code-if-the-status-column-is-not-filled-out"></a>
</h4>
<!-- # TODO Brooke - to make this work if does not overlap with any marine parks -->
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marine_parks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp"</span><span class="op">)</span><span class="op">)</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">geometry</span>, <span class="va">ZONE_TYPE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine' from data source `/home/runner/work/CheckEM/CheckEM/r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 3775 features and 26 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 70.71702 ymin: -58.44947 xmax: 170.3667 ymax: -8.473407</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">metadata</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude_dd"</span>, <span class="st">"latitude_dd"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># metadata &lt;- metadata_sf %&gt;%</span></span>
<span><span class="co">#   st_intersection(marine_parks) %&gt;%</span></span>
<span><span class="co">#   bind_cols(st_coordinates(.)) %&gt;%</span></span>
<span><span class="co">#   as.data.frame() %&gt;%</span></span>
<span><span class="co">#   dplyr::select(-c(geometry)) %&gt;%</span></span>
<span><span class="co">#   dplyr::rename(longitude_dd = X, latitude_dd = Y) %&gt;%</span></span>
<span><span class="co">#   dplyr::mutate(status = if_else(str_detect(ZONE_TYPE, "National|Sanctuary"),</span></span>
<span><span class="co">#                                 "No-take", "Fished")) %&gt;%</span></span>
<span><span class="co">#   clean_names() %&gt;%</span></span>
<span><span class="co">#   dplyr::glimpse()</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="find-nearest-marine-region">Find nearest Marine Region<a class="anchor" aria-label="anchor" href="#find-nearest-marine-region"></a>
</h3>
<p>Now we need to find the nearest marine region for each sample in the
metadata. Then we can use the life history lists to find species that
have not been observed in that marine region before.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">metadata</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude_dd"</span>, <span class="st">"latitude_dd"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">CheckEM</span><span class="fu">::</span><span class="va">aus_regions</span>, crs <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: sp</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">regions</span>, <span class="fl">4326</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">REGION</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">metadata_sf</span>, <span class="va">regions</span>, join <span class="op">=</span> <span class="va">st_nearest_feature</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>marine_region <span class="op">=</span> <span class="va">REGION</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 720</span></span>
<span><span class="co">## Columns: 9</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2009-05_Rottnest.sanctuaries_stereoDOVs", "2009-05_…</span></span>
<span><span class="co">## $ sample            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "9DAC1-1", "9DAC1-2", "9DAC1-3", "9DAC1-4", "9DAC1-5…</span></span>
<span><span class="co">## $ date_time         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2009-05-18T15:40:00+08:00", "2009-05-18T15:40:00+08…</span></span>
<span><span class="co">## $ location          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Armstrong", "Armstrong", "Armstrong", "Armstrong", …</span></span>
<span><span class="co">## $ site              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "AC1", "AC1", "AC1", "AC1", "AC1", "AC1", "AC1", "AC…</span></span>
<span><span class="co">## $ depth_m           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "11", "11", "11", "11", "11", "11", "11", "11", "11"…</span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span>
<span><span class="co">## $ marine_region     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "South-west", "South-west", "South-west", "South-wes…</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="fish-annotation-data">Fish annotation data<a class="anchor" aria-label="anchor" href="#fish-annotation-data"></a>
</h2>
<p>There are two types of fish annotation data formats that you can
check and format using this script: <em>EventMeasure database
outputs</em> or <em>Generic</em> files.</p>
<ul>
<li><p>For <em>EventMeasure database outputs</em> you will need to
export the database outputs using the EventMeasure software and the
.EMObs files. This will give you the ’_Points.txt’, ’_Lengths.txt’ and
’_3DPoints.txt’ files.</p></li>
<li><p><em>Generic</em> data is a much simpler format and allows users
who haven’t used EventMeasure to format QC their annotation data. You
will need a _Count.csv file and a _Length.csv file.</p></li>
</ul>
<p>For more information on the format of these files please see the <a href="https://globalarchivemanual.github.io/CheckEM/articles/manuals/CheckEM_user_guide.html">CheckEM
user guide</a></p>
<p>We recommend using the <em>EventMeasure database outputs</em> if they
are available and up to date. There are more checks possible with
EventMeasure data than <em>Generic</em> data. <strong>Note:</strong> If
you have used EventMeasure software to annotate your samples BUT have
made corrections on the exported data (e.g. in Excel), this corrected
data is now the true copy of the data and you should import your data as
<em>Generic</em> annotation files (e.g. count and length).</p>
<div class="section level3">
<h3 id="load-any-eventmeasure-points-txt-files">Load any EventMeasure Points.txt files<a class="anchor" aria-label="anchor" href="#load-any-eventmeasure-points-txt-files"></a>
</h3>
<p>This section of code will read in any Points.txt files that you have
saved in the directory you set. It will combine all of the files into
one data-frame, and get the campaignid name from the name of the file.
It is important that you consistently name your files with the same
campaignid (look out for different separators e.g. ‘-’, ’_‘, or’.’)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">points</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_points.html">read_points</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"r-workflows/data/DOV example/raw/"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 0</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="load-any-generic-count-files">Load any <em>Generic</em> count files<a class="anchor" aria-label="anchor" href="#load-any-generic-count-files"></a>
</h3>
<p>This section of code will read in any Count.csv files that you have
saved in the directory you set. It will combine all of the files into
one data frame, and get the campaignid name from the name of the
file.</p>
<p>It is important that you consistently name your files with the same
campaignid (look out for different separators e.g. ‘-’, ’_‘, or’.’)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_counts.html">read_counts</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"r-workflows/data/DOV example/raw/"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"DOVs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Change here to "DOVs"</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 0</span></span></code></pre>
<!-- ## Combine EventMeasure and *Generic* count together -->
<!-- Create and tidy the MaxN file. -->
<!-- ```{r create-maxn} -->
<!-- # Only run this if there is data in the counts data frame -->
<!-- if(nrow(points) > 1){ -->
<!--   maxn_points <- points %>%  -->
<!--     dplyr::group_by(campaignid, sample, filename, periodtime, frame, family, genus, species) %>% # If you have MaxN'd by stage (e.g. Adult, Juvenile) add stage here -->
<!--     dplyr::mutate(number = as.numeric(number)) %>% -->
<!--     dplyr::summarise(maxn = sum(number)) %>% -->
<!--     dplyr::ungroup() %>% -->
<!--     dplyr::group_by(campaignid, sample, family, genus, species) %>% -->
<!--     dplyr::slice(which.max(maxn)) %>% -->
<!--     dplyr::ungroup() %>% -->
<!--     dplyr::filter(!is.na(maxn)) %>% -->
<!--     dplyr::select(-frame) %>% -->
<!--     tidyr::replace_na(list(maxn = 0)) %>% -->
<!--     dplyr::mutate(maxn = as.numeric(maxn)) %>% -->
<!--     dplyr::filter(maxn > 0) %>% -->
<!--     dplyr::inner_join(metadata, by = join_by(campaignid, sample)) %>% -->
<!--     dplyr::filter(successful_count %in% c("Yes")) %>%  -->
<!--     dplyr::filter(maxn > 0) %>% -->
<!--     dplyr::select(campaignid, sample, family, genus, species, maxn) %>% -->
<!--     dplyr::glimpse() -->
<!-- } -->
<!-- # Only run this if there is data in the counts data frame -->
<!-- if(nrow(counts) > 1){ -->
<!--   maxn_counts <- counts %>% -->
<!--     dplyr::group_by(campaignid, sample, family, genus, species) %>% -->
<!--     dplyr::mutate(number = as.numeric(count)) %>% -->
<!--     dplyr::summarise(maxn = sum(number)) %>% -->
<!--     dplyr::ungroup() %>% -->
<!--     dplyr::group_by(campaignid, sample, family, genus, species) %>% -->
<!--     dplyr::slice(which.max(maxn)) %>% -->
<!--     dplyr::ungroup() %>% -->
<!--     dplyr::filter(!is.na(maxn)) %>% -->
<!--     tidyr::replace_na(list(maxn = 0)) %>% -->
<!--     dplyr::mutate(maxn = as.numeric(maxn)) %>% -->
<!--     dplyr::filter(maxn > 0) %>% -->
<!--     dplyr::inner_join(metadata, by = join_by(campaignid, sample)) %>% -->
<!--     dplyr::filter(successful_count %in% c("Yes")) %>% -->
<!--     dplyr::filter(maxn > 0) %>% -->
<!--     dplyr::select(campaignid, sample, family, genus, species, maxn) %>% -->
<!--     dplyr::glimpse() -->
<!-- } -->
<!-- # If only EventMeasure data then MaxN only includes Points data -->
<!-- # If only Generic data then MaxN only includes Count data -->
<!-- # If both exist, then MaxN includes both Points and Count data -->
<!-- maxn <- bind_rows(get0("maxn_points"), get0("maxn_counts")) # this works even if you only have one type of data -->
<!-- ``` -->
</div>
<div class="section level3">
<h3 id="load-any-eventmeasure-lengths-txt-andor-3dpoints-txt-files">Load any EventMeasure Lengths.txt and/or 3DPoints.txt files<a class="anchor" aria-label="anchor" href="#load-any-eventmeasure-lengths-txt-andor-3dpoints-txt-files"></a>
</h3>
<p>This section of code will read in any Lengths.txt and/or 3DPoints.txt
files that you have saved in the directory you set. It will combine all
of the files into one data-frame, and get the campaignid name from the
name of the file. It is important that you consistently name your files
with the same campaignid (look out for different separators e.g. ‘-’,
’_‘, or’.’)</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">em_length3dpoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_em_length.html">read_em_length</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"r-workflows/data/DOV example/raw/"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"DOVs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Change here to "DOVs"</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="st">"comment"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># there is a comment column in metadata, so you will need to remove this column from EM data</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">metadata</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">sample</span>, <span class="va">campaignid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">successful_length</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"Yes"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># dplyr::rename(length_mm = length) %&gt;%</span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 18</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ sample            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ length_mm         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ family            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ number            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ period            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ rms               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ range             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ precision         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ date_time         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ location          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ site              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ depth_m           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ marine_region     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="load-any-generic-length-files">Load any <em>Generic</em> length files<a class="anchor" aria-label="anchor" href="#load-any-generic-length-files"></a>
</h3>
<p>This section of code will read in any <em>Length.csv files that you
have saved in the directory you set. It will combine all of the files
into one data frame, and get the campaignid name from the name of the
file. It is important that you consistently name your files with the
same campaignid (look out for different separators e.g. ‘-’, ’</em>’, or
‘.’)</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gen_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_gen_length.html">read_gen_length</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"r-workflows/data/DOV example/raw/"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"DOVs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Change here to "DOVs"</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">metadata</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">successful_length</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"Yes"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 720</span></span>
<span><span class="co">## Columns: 17</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2009-05_Rottnest.sanctuaries_stereoDOVs", "2009-05_…</span></span>
<span><span class="co">## $ sample            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "9DAC1-1", "9DAC1-2", "9DAC1-3", "9DAC1-4", "9DAC1-5…</span></span>
<span><span class="co">## $ length_mm         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ family            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ genus             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ species           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ number            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ range             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ rms               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ precision         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ date_time         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2009-05-18T15:40:00+08:00", "2009-05-18T15:40:00+08…</span></span>
<span><span class="co">## $ location          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Armstrong", "Armstrong", "Armstrong", "Armstrong", …</span></span>
<span><span class="co">## $ site              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "AC1", "AC1", "AC1", "AC1", "AC1", "AC1", "AC1", "AC…</span></span>
<span><span class="co">## $ depth_m           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "11", "11", "11", "11", "11", "11", "11", "11", "11"…</span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span>
<span><span class="co">## $ marine_region     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "South-west", "South-west", "South-west", "South-wes…</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="combine-eventmeasure-and-generic-length-data">Combine EventMeasure and <em>Generic</em> length data<a class="anchor" aria-label="anchor" href="#combine-eventmeasure-and-generic-length-data"></a>
</h3>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If only EventMeasure data then length only includes Length and 3D points data</span></span>
<span><span class="co"># If only Generic data then length only includes generic length data</span></span>
<span><span class="co"># If both exist, then length includes both Length and 3D points and generic length data</span></span>
<span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">get0</a></span><span class="op">(</span><span class="st">"em_length3dpoints"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">get0</a></span><span class="op">(</span><span class="st">"gen_length"</span><span class="op">)</span><span class="op">)</span> <span class="co"># this works even if you only have one type of data</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="format-and-add-zeros-where-a-species-isnt-present">Format and add zeros where a species isn’t present<a class="anchor" aria-label="anchor" href="#format-and-add-zeros-where-a-species-isnt-present"></a>
</h3>
<!-- ### In the count data -->
<!-- Tidy and "complete" MaxN data (e.g. add zeros in the data where a species wasn't observed). -->
<!-- The final data set will have a row for each species in every sample (deployment). -->
<!-- ```{r tidy-maxn} -->
<!-- count <- maxn %>% -->
<!--   dplyr::mutate(family = ifelse(family %in% c("NA", "NANA", NA, "unknown", "", NULL, " ", NA_character_), "Unknown", as.character(family))) %>% -->
<!--   dplyr::mutate(genus = ifelse(genus %in% c("NA", "NANA", NA, "unknown", "", NULL, " ", NA_character_), "Unknown", as.character(genus))) %>% -->
<!--   dplyr::mutate(species = ifelse(species %in% c("NA", "NANA", NA, "unknown", "", NULL, " ", NA_character_), "spp", as.character(species))) %>% -->
<!--   dplyr::select(campaignid, sample, family, genus, species, maxn) %>% -->
<!--   tidyr::complete(nesting(campaignid, sample), nesting(family, genus, species)) %>% -->
<!--   tidyr::replace_na(list(maxn = 0)) %>% -->
<!--   group_by(campaignid, sample, family, genus, species) %>% -->
<!--   dplyr::summarise(count = sum(maxn)) %>% -->
<!--   ungroup() %>% -->
<!--   mutate(scientific = paste(family, genus, species, sep = " "))%>% -->
<!--   dplyr::select(campaignid, sample, scientific, count)%>% -->
<!--   spread(scientific, count, fill = 0) -->
<!-- count_families <- maxn %>% -->
<!--   dplyr::mutate(scientific = paste(family, genus, species, sep = " ")) %>% -->
<!--   filter(!(family %in% "Unknown")) %>% -->
<!--   dplyr::select(c(family, genus, species, scientific)) %>% -->
<!--   distinct() -->
<!-- complete_count <- count %>% -->
<!--   pivot_longer(names_to = "scientific", values_to = "count", -->
<!--                cols = 3:ncol(.)) %>% -->
<!--   inner_join(count_families, by = c("scientific")) %>% -->
<!--   full_join(metadata)%>% -->
<!--   glimpse() -->
<!-- ``` -->
<div class="section level4">
<h4 id="in-the-length-data">In the length data<a class="anchor" aria-label="anchor" href="#in-the-length-data"></a>
</h4>
<p>Tidy and complete length data (e.g. complete zeroes in the data). The
final data set will have a row for each species in every sample
(deployment).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complete_length</span> <span class="op">&lt;-</span> <span class="va">length</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">family</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="st">"NANA"</span>, <span class="cn">NA</span>, <span class="st">"unknown"</span>, <span class="st">""</span>, <span class="cn">NULL</span>, <span class="st">" "</span>, <span class="cn">NA_character_</span><span class="op">)</span>, <span class="st">"Unknown"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>genus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">genus</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="st">"NANA"</span>, <span class="cn">NA</span>, <span class="st">"unknown"</span>, <span class="st">""</span>, <span class="cn">NULL</span>, <span class="st">" "</span>, <span class="cn">NA_character_</span><span class="op">)</span>, <span class="st">"Unknown"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">genus</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">species</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="st">"NANA"</span>, <span class="cn">NA</span>, <span class="st">"unknown"</span>, <span class="st">""</span>, <span class="cn">NULL</span>, <span class="st">" "</span>, <span class="cn">NA_character_</span><span class="op">)</span>, <span class="st">"spp"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">family</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"Unknown"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># First make one row for every length measurement</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/uncount.html" class="external-link">uncount</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Add in missing samples</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">successful_length</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"Yes"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># Complete the data (add in zeros for every species)</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span>, <span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span>, <span class="va">length_mm</span>, <span class="va">number</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"range"</span>, <span class="st">"rms"</span>, <span class="st">"precision"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># this will keep EM only columns</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html" class="external-link">complete</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">nesting</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span><span class="op">)</span>, <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">nesting</a></span><span class="op">(</span><span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="external-link">replace_na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>number <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">number</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">metadata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(campaignid, sample, date_time, location, site,</span></span>
<span><span class="co">## depth_m, successful_count, successful_length, marine_region)`</span></span>
<span><span class="co">## Joining with `by = join_by(campaignid, sample)`</span></span></code></pre>
<pre><code><span><span class="co">## Rows: 720</span></span>
<span><span class="co">## Columns: 17</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2009-05_Rottnest.sanctuaries_stereoDOVs", "2009-05_…</span></span>
<span><span class="co">## $ sample            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "9DAC1-1", "9DAC1-10", "9DAC1-11", "9DAC1-12", "9DAC…</span></span>
<span><span class="co">## $ family            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ genus             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ species           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ length_mm         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ number            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span></span>
<span><span class="co">## $ range             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ rms               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ precision         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ date_time         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2009-05-18T15:40:00+08:00", "2009-05-18T15:40:00+08…</span></span>
<span><span class="co">## $ location          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Armstrong", "Armstrong", "Armstrong", "Armstrong", …</span></span>
<span><span class="co">## $ site              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "AC1", "AC1", "AC1", "AC1", "AC1", "AC1", "AC1", "AC…</span></span>
<span><span class="co">## $ depth_m           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "11", "11", "11", "11", "11", "11", "11", "11", "11"…</span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span>
<span><span class="co">## $ marine_region     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "South-west", "South-west", "South-west", "South-wes…</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="quality-control-checks">Quality Control Checks<a class="anchor" aria-label="anchor" href="#quality-control-checks"></a>
</h2>
<p>Now we have some-what tidy data we can begin to run some checks.</p>
<div class="section level3">
<h3 id="number-of-unique-samples-in-the-metadata">Number of unique samples in the metadata<a class="anchor" aria-label="anchor" href="#number-of-unique-samples-in-the-metadata"></a>
</h3>
<p>This is the total number of unique samples in the sample metadata (it
should also be the number of rows in the metadata data frame)</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">number_of_samples</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">number_of_samples</span><span class="op">)</span>, <span class="st">"unique samples in the metadata"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 720 unique samples in the metadata</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="check-for-duplicate-sample-names">Check for duplicate sample names<a class="anchor" aria-label="anchor" href="#check-for-duplicate-sample-names"></a>
</h3>
<p>If you have any duplicate samples within a campaign they will be
displayed here</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">duplicate_samples</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'campaignid'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">duplicate_samples</span><span class="op">)</span>, <span class="st">"samples duplicated in the metadata"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 samples duplicated in the metadata</span></span></code></pre>
<!-- ## Number of sample(s) without points or count data -->
<!-- This could be due to samples not observing fish (not an error) or a sample that should be marked as successful_count = No.  -->
<!-- It could also be due to a sample name spelt incorrectly in the count/points or sample metadata file. -->
<!-- ```{r samples-missing-count} -->
<!-- metadata_samples <- metadata %>% -->
<!--   dplyr::select(campaignid, sample, dplyr::any_of(c("opcode", "period")),  -->
<!--                 successful_count, successful_length) %>% -->
<!--   distinct() -->
<!-- samples <- maxn %>% -->
<!--   distinct(campaignid, sample) -->
<!-- missing_count <- anti_join(metadata_samples, samples, by = join_by(campaignid, sample)) -->
<!-- message(paste(nrow(missing_count), "samples in the metadata missing count data")) -->
<!-- ``` -->
<!-- ## Samples in the count data missing metadata -->
<!-- This next chunk checks for any samples that are in the count data but do not have a match in the sample metadata. -->
<!-- ```{r count-missing-metadata} -->
<!-- missing_metadata <- anti_join(samples, metadata_samples, by = join_by(campaignid, sample)) -->
<!-- message(paste(nrow(missing_metadata), "samples in count data missing metadata")) -->
<!-- ``` -->
</div>
<div class="section level3">
<h3 id="number-of-samples-without-length-or-3d-point-data">Number of sample(s) without length or 3D point data<a class="anchor" aria-label="anchor" href="#number-of-samples-without-length-or-3d-point-data"></a>
</h3>
<p>This could be due to samples not observing fish (not an error) or a
sample that should be marked as successful_length = No. It could also be
due to a sample name spelt incorrectly in the EMObs or Length file or
the sample metadata file.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata_samples</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"opcode"</span>, <span class="st">"period"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                <span class="va">successful_count</span>, <span class="va">successful_length</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="va">length</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span><span class="op">)</span></span>
<span></span>
<span><span class="va">missing_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">metadata_samples</span>, <span class="va">samples</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">missing_length</span><span class="op">)</span>, <span class="st">"samples in metadata missing length data"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 samples in metadata missing length data</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="samples-in-the-length-data-missing-metadata">Samples in the length data missing metadata<a class="anchor" aria-label="anchor" href="#samples-in-the-length-data-missing-metadata"></a>
</h3>
<p>This next chunk checks for any samples that are in the length data
but do not have a match in the sample metadata.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">samples</span>, <span class="va">metadata_samples</span>, by <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">missing_metadata</span><span class="op">)</span>, <span class="st">"samples in length data missing metadata"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 samples in length data missing metadata</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="periods-without-an-end-em-only">Periods without an end (EM only)<a class="anchor" aria-label="anchor" href="#periods-without-an-end-em-only"></a>
</h3>
<p>This check is only important if you have used periods to define your
sampling duration. It looks for any periods in the EMObs that do not
have an end time. This is important if you want to check the duration of
each period.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/read_periods.html">read_periods</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"r-workflows/data/DOV example/raw/"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"DOVs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## $ campaignid <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ sample     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ opcode     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ period     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ time_start <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ time_end   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ has_end    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">periods_without_end</span> <span class="op">&lt;-</span> <span class="va">periods</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">has_end</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">periods_without_end</span><span class="op">)</span>, <span class="st">"periods without an end"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 periods without an end</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">periods_without_end</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 7</span></span>
<span><span class="co">## $ campaignid <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ sample     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ opcode     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ period     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ time_start <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ time_end   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ has_end    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="samples-without-periods-em-only">Samples without periods (EM only)<a class="anchor" aria-label="anchor" href="#samples-without-periods-em-only"></a>
</h3>
<p>This check is only important if you have used periods to define your
sampling duration. You can use it to find any samples that are missing
periods.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata_samples</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"opcode"</span>, <span class="st">"period"</span><span class="op">)</span><span class="op">)</span>, <span class="va">successful_count</span>, <span class="va">successful_length</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/is.bool.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sample</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">periods_samples</span> <span class="op">&lt;-</span> <span class="va">periods</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"opcode"</span>, <span class="st">"period"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">missing_periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">metadata_samples</span>, <span class="va">periods_samples</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">sample</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(campaignid, sample)`</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">missing_periods</span><span class="op">)</span>, <span class="st">"samples missing period"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 720 samples missing period</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">missing_periods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 720</span></span>
<span><span class="co">## Columns: 3</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2009-05_Rottnest.sanctuaries_stereoDOVs", "2009-05_…</span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", "Ye…</span></span></code></pre>
<!-- ## Points outside Periods (EM only) -->
<!-- This check identifies any points that have been annotated outside of a period. -->
<!-- ```{r points-outside-periods} -->
<!-- points_outside_periods <- points %>% -->
<!--   dplyr::filter(period %in% c("NA", NA, NULL, "")) %>% -->
<!--   dplyr::select(campaignid, dplyr::any_of(c("opcode", "period")), family, genus, species, number, frame) -->
<!-- message(paste(nrow(points_outside_periods), "points outside a period")) -->
<!-- glimpse(points_outside_periods) -->
<!-- ``` -->
<!-- ## Length measurement(s) or 3D point(s) outside periods (EM only) -->
<!-- This check identifies any length measurements or 3D points that have been annotated outside of a period. -->
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lengths_outside_periods</span> <span class="op">&lt;-</span> <span class="va">em_length3dpoints</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">period</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="cn">NA</span>, <span class="cn">NULL</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"opcode"</span>, <span class="st">"period"</span><span class="op">)</span><span class="op">)</span>, <span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span>, <span class="va">number</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lengths_outside_periods</span><span class="op">)</span>, <span class="st">"lengths/3D points outside period"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 lengths/3D points outside period</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">lengths_outside_periods</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 6</span></span>
<span><span class="co">## $ campaignid <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ period     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ family     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ number     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span></code></pre>
<!-- ## Period(s) that are not the correct duration (EM only) -->
<!-- In this check you define the correct sampling duration (e.g. 60 minutes for stereo-BRUVs) and then identify any periods that are not that length. -->
<!-- ```{r periods-wrong-length} -->
<!-- period_length <- 60 # in minutes -->
<!-- periods_wrong <- periods %>% -->
<!--         dplyr::select(campaignid, dplyr::any_of(c("opcode", "period")), time_start, time_end, has_end) %>% -->
<!--         dplyr::distinct() %>% -->
<!--         dplyr::mutate(period_time = round(time_end - time_start)) %>% -->
<!--         dplyr::filter(!period_time %in% period_length) -->
<!-- message(paste(nrow(periods_wrong), "periods not", period_length, "minutes long")) -->
<!-- glimpse(periods_wrong) -->
<!-- ``` -->
<!-- ## Total number of individuals observed -->
<!-- This is the total number of individuals observed in the count data: -->
<!-- ```{r total-in-maxn} -->
<!-- total_count <- sum(complete_count$count) -->
<!-- message(paste(total_count, "fish counted in the count data")) -->
<!-- ``` -->
<p>This is the total number of individuals observed in the length
data:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">total_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">complete_length</span><span class="op">$</span><span class="va">number</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">total_length</span>, <span class="st">"fish counted in the length data"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 fish counted in the length data</span></span></code></pre>
<!-- ## Points without a number (EM only) -->
<!-- This is a check for EventMeasure data. Sometimes analysts will add points of interest that are not fish/sharks and remove the number so they are not summed in total abundance metrics. You should check to make sure no fish species accidentally had their number deleted. -->
<!-- ```{r points-without-a-number} -->
<!-- points_without_number <- points %>% -->
<!--   filter(number %in% c("NA", NA, 0, NULL, "", " ")) -->
<!-- message(paste(nrow(points_without_number), "points in the _Points.txt file that do not have a number")) -->
<!-- glimpse(points_without_number) -->
<!-- ``` -->
</div>
<div class="section level3">
<h3 id="length-measurements-or-3d-points-without-a-number-em-only">Length measurements or 3D points without a number (EM only)<a class="anchor" aria-label="anchor" href="#length-measurements-or-3d-points-without-a-number-em-only"></a>
</h3>
<p>This is a check for EventMeasure data. Sometimes analysts will add 3D
points to record the sync point. These can remain in the data but you
should double check that no fish are accidentally missing a number.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lengths_without_number</span> <span class="op">&lt;-</span> <span class="va">em_length3dpoints</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">number</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NA"</span>, <span class="cn">NA</span>, <span class="fl">0</span>, <span class="cn">NULL</span>, <span class="st">""</span>, <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">lengths_without_number</span><span class="op">)</span>, <span class="st">"lengths or 3D points in the EMObs that do not have a number"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 lengths or 3D points in the EMObs that do not have a number</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">lengths_without_number</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 18</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ sample            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ length_mm         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ family            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ number            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ period            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ rms               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ range             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ precision         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ date_time         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ location          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ site              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ depth_m           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ marine_region     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span></code></pre>
<!-- ## Species names that have been updated -->
<!-- Taxanomic advances means that species names are updated all the time, and analysts sometimes spell species names incorrectly. This check uses a data-frame saved inside the CheckEM package to identifies species names that have been updated or spelt incorrectly.  -->
<!-- You can choose if you would like to find the synonyms using an Australia specific list (*CheckEM::aus_synonyms*) or a Global list (*TO ADD*). -->
<!-- ### Synonyms in the count data -->
<!-- ```{r count-synonyms} -->
<!-- synonyms_in_count <- dplyr::left_join(complete_count, CheckEM::aus_synonyms) %>% -->
<!--       dplyr::filter(!is.na(genus_correct)) %>% -->
<!--       dplyr::mutate('old name' = paste(family, genus, species, sep = " ")) %>% -->
<!--       dplyr::mutate('new name' = paste(family_correct, genus_correct, species_correct, sep = " ")) %>% -->
<!--       dplyr::select('old name', 'new name') %>% -->
<!--       dplyr::distinct() -->
<!-- message(paste(nrow(synonyms_in_count), "synonyms used in the count data")) -->
<!-- glimpse(synonyms_in_count) -->
<!-- ``` -->
<div class="section level4">
<h4 id="synonyms-in-the-length-data">Synonyms in the length data<a class="anchor" aria-label="anchor" href="#synonyms-in-the-length-data"></a>
</h4>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">synonyms_in_length</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">complete_length</span>, <span class="fu">CheckEM</span><span class="fu">::</span><span class="va">aus_synonyms</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">genus_correct</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">'old name'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="st">'new name'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">family_correct</span>, <span class="va">genus_correct</span>, <span class="va">species_correct</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">'old name'</span>, <span class="st">'new name'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(family, genus, species)`</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">synonyms_in_length</span><span class="op">)</span>, <span class="st">"synonyms used in the length data"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 synonyms used in the length data</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">synonyms_in_length</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 2</span></span>
<span><span class="co">## $ `old name` <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ `new name` <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span></code></pre>
</div>
<div class="section level4">
<h4 id="change-synonyms-names-in-data">Change synonyms names in data<a class="anchor" aria-label="anchor" href="#change-synonyms-names-in-data"></a>
</h4>
<p>Now that we have identified species names that have been updated or
spelt wrong you need to decide if you want to change the names in your
data or continue using the old names. If you want to update the names
use the next two chunks. If you would like to retain the old names skip
the next two chunks.</p>
<p><strong>NOTE:</strong> this does not change your original annotation
files, only the data you save at the end of the script.</p>
<!-- ```{r change-count-synonyms} -->
<!-- complete_count <- dplyr::left_join(complete_count, CheckEM::aus_synonyms) %>% -->
<!--   dplyr::mutate(genus = ifelse(!genus_correct%in%c(NA), genus_correct, genus)) %>% -->
<!--   dplyr::mutate(species = ifelse(!is.na(species_correct), species_correct, species)) %>% -->
<!--   dplyr::mutate(family = ifelse(!is.na(family_correct), family_correct, family)) %>% -->
<!--   dplyr::select(-c(family_correct, genus_correct, species_correct)) %>% -->
<!--   dplyr::mutate(scientific = paste(family, genus, species)) -->
<!-- ``` -->
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complete_length</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">complete_length</span>, <span class="fu">CheckEM</span><span class="fu">::</span><span class="va">aus_synonyms</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>genus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="va">genus_correct</span><span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span>, <span class="va">genus_correct</span>, <span class="va">genus</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">species_correct</span><span class="op">)</span>, <span class="va">species_correct</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">family_correct</span><span class="op">)</span>, <span class="va">family_correct</span>, <span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">family_correct</span>, <span class="va">genus_correct</span>, <span class="va">species_correct</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scientific <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(family, genus, species)`</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="species-not-observed-in-the-region-before">Species not observed in the region before<a class="anchor" aria-label="anchor" href="#species-not-observed-in-the-region-before"></a>
</h3>
<p>In this check you use a list of species and their known geographical
ranges to check your data against to identify any species that are
outside of that range. There are two life history data sets to choose
from to check any species that are outside of their known geographical
range. They are the Australia and Global lists.</p>
<p>To use the Australia life history list use
<em>CheckEM::australia_life_history</em> to use the Global life history
list use <em>CheckEM::global_life_history</em>.</p>
<p>We run the check on both the count and length data, as sometimes a
species will be in the count and not the length. All species identified
in these checks are present in your chosen life-history list. Sometimes
range data is limited, so it is possible that a species flagged in this
check is actually present in that area. You need to critically think
about the species flagged by this check.</p>
<!-- ### Species out of range in the count data -->
<!-- Check for any species that are out of range in the count data. -->
<!-- ```{r count-species-not-in-area} -->
<!-- count_species_not_observed_region <- complete_count %>% -->
<!--   dplyr::distinct(campaignid, sample, family, genus, species, marine_region, count) %>% -->
<!--   dplyr::anti_join(., expand_life_history(CheckEM::australia_life_history), by = c("family", "genus", "species", "marine_region")) %>% -->
<!--   dplyr::filter(count > 0) %>% -->
<!--   dplyr::left_join(metadata) %>% -->
<!--   dplyr::select(campaignid, dplyr::any_of(c("opcode", "period")), family, genus, species, marine_region) %>% -->
<!--   dplyr::distinct() %>% -->
<!--   dplyr::rename('marine region not observed in' = marine_region) %>% -->
<!--   dplyr::semi_join(., CheckEM::australia_life_history, by = c("family", "genus", "species")) -->
<!-- message(paste(nrow(count_species_not_observed_region), "species not observed in the region before")) -->
<!-- glimpse(count_species_not_observed_region) -->
<!-- ``` -->
<div class="section level4">
<h4 id="species-out-of-range-in-the-length-data">Species out of range in the length data<a class="anchor" aria-label="anchor" href="#species-out-of-range-in-the-length-data"></a>
</h4>
<p>Check for any species that are out of range in the length data.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">length_species_not_observed_region</span> <span class="op">&lt;-</span> <span class="va">complete_length</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span>, <span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span>, <span class="va">marine_region</span>, <span class="va">number</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="../../reference/expand_life_history.html">expand_life_history</a></span><span class="op">(</span><span class="fu">CheckEM</span><span class="fu">::</span><span class="va">australia_life_history</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"genus"</span>, <span class="st">"species"</span>, <span class="st">"marine_region"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">number</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"opcode"</span>, <span class="st">"period"</span><span class="op">)</span><span class="op">)</span>, <span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span>, <span class="va">marine_region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">'marine region not observed in'</span> <span class="op">=</span> <span class="va">marine_region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">semi_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu">CheckEM</span><span class="fu">::</span><span class="va">australia_life_history</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"genus"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(campaignid, sample, marine_region)`</span></span></code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">length_species_not_observed_region</span><span class="op">)</span>, <span class="st">"species not observed in the region before"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 species not observed in the region before</span></span></code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">length_species_not_observed_region</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 5</span></span>
<span><span class="co">## $ campaignid                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ family                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus                           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species                         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ `marine region not observed in` <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="species-not-listed-in-the-life-history-list">Species not listed in the life history list<a class="anchor" aria-label="anchor" href="#species-not-listed-in-the-life-history-list"></a>
</h3>
<p>This next check identifies any species that are not listed in your
chosen life history list. It could be that you have misspelt the
family/genus/species name, the species name is invalid, the name has
been updated or that the species name should be included in the life
history list but is missing. Again you will need to critically think
about the species that are flagged to determine if this is an error or
not.</p>
<p>To use the Australia life history list use
<em>CheckEM::australia_life_history</em> to use the Global life history
list use <em>CheckEM::global_life_history</em>.</p>
<p><em>NOTE.</em> If you believe that a species flagged by this check
should be included in the life history list please email <a href="mailto:brooke.gibbons@uwa.edu.au" class="email">brooke.gibbons@uwa.edu.au</a> with the full species name
and which list it should be added to (Global or Australia).</p>
<!-- ### Species in the count data that are not listed -->
<!-- If you chose to update the names that have changed (synonyms) then this check won't include the previously used names. -->
<!-- ```{r count-species-not-in-list} -->
<!-- count_species_not_in_list <- complete_count %>% -->
<!--   dplyr::anti_join(., CheckEM::australia_life_history, by = c("family", "genus", "species")) %>% -->
<!--   dplyr::filter(count > 0) %>% -->
<!--   dplyr::left_join(metadata) %>% -->
<!--   dplyr::select(campaignid, dplyr::any_of(c("opcode", "period")), family, genus, species) %>% -->
<!--   dplyr::distinct()  -->
<!-- message(paste(nrow(count_species_not_in_list), "species not in chosen life history list")) -->
<!-- glimpse(count_species_not_in_list) -->
<!-- ``` -->
<div class="section level4">
<h4 id="species-in-the-length-data-that-are-not-listed">Species in the length data that are not listed<a class="anchor" aria-label="anchor" href="#species-in-the-length-data-that-are-not-listed"></a>
</h4>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">length_species_not_in_list</span> <span class="op">&lt;-</span> <span class="va">complete_length</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu">CheckEM</span><span class="fu">::</span><span class="va">australia_life_history</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"family"</span>, <span class="st">"genus"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">number</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"opcode"</span>, <span class="st">"period"</span><span class="op">)</span><span class="op">)</span>, <span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(campaignid, sample, date_time, location, site,</span></span>
<span><span class="co">## depth_m, successful_count, successful_length, marine_region)`</span></span></code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">length_species_not_in_list</span><span class="op">)</span>, <span class="st">"species not in chosen life history list"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 species not in chosen life history list</span></span></code></pre>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">length_species_not_in_list</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 4</span></span>
<span><span class="co">## $ campaignid <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ family     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="length-measurements-smaller-or-bigger-than-the-fishbase-minimum-and-maximums">Length measurements smaller or bigger than the fishbase minimum and
maximums<a class="anchor" aria-label="anchor" href="#length-measurements-smaller-or-bigger-than-the-fishbase-minimum-and-maximums"></a>
</h3>
<p>Length data is extremely valuable so it is important that fish are
precisely and accurately measured. You can use this check to identify
any measurements that are bigger than the maximum size listed on
fishbase. However, we think it is important that you check any species
that are nearing their maximum size (e.g 85% of maximum). We also think
it is important that you check for any species that are very small.
Fishbase does not list a minimum size, so we recommend checking the
length measurements against 15% of the maximum size.</p>
<p>In the function below you can edit these cut offs (15% and 85%) as
you see fit. If you believe the size limits for a particular species is
incorrect you fill out the feedback form on the <a href="https://marine-ecology.shinyapps.io/CheckEM/" class="external-link">CheckEM</a> web
based app (see tab <em>Edit maximum lengths</em>) to supply a new
maximum size limit.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">incorrect_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">complete_length</span>, <span class="fu"><a href="../../reference/create_min_max.html">create_min_max</a></span><span class="op">(</span><span class="fu">CheckEM</span><span class="fu">::</span><span class="va">australia_life_history</span>, minimum <span class="op">=</span> <span class="fl">0.15</span>, maximum <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">length_mm</span> <span class="op">&lt;</span> <span class="va">min_length_mm</span> <span class="op">|</span> <span class="va">length_mm</span> <span class="op">&gt;</span> <span class="va">max_length_mm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>reason <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">length_mm</span> <span class="op">&lt;</span> <span class="va">min_length_mm</span>, <span class="st">"too small"</span>, <span class="st">"too big"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="va">sample</span>, <span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span>, <span class="va">length_mm</span>, <span class="va">min_length_mm</span>, <span class="va">max_length_mm</span>, <span class="va">length_max_mm</span>, <span class="va">reason</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"em_comment"</span>, <span class="st">"frame_left"</span><span class="op">)</span><span class="op">)</span>, <span class="va">length_max_mm</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">reason</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"too small"</span><span class="op">)</span>, <span class="op">(</span><span class="va">min_length_mm</span> <span class="op">-</span> <span class="va">length_mm</span><span class="op">)</span>, <span class="op">(</span><span class="va">length_mm</span> <span class="op">-</span> <span class="va">max_length_mm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>percent_of_fb_max <span class="op">=</span> <span class="op">(</span><span class="va">length_mm</span><span class="op">/</span><span class="va">length_max_mm</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">campaignid</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"opcode"</span>, <span class="st">"period"</span><span class="op">)</span><span class="op">)</span>, <span class="va">family</span>, <span class="va">genus</span>, <span class="va">species</span>, <span class="va">length_mm</span>, <span class="va">min_length_mm</span>, <span class="va">max_length_mm</span>, <span class="va">length_max_mm</span>, <span class="va">reason</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"em_comment"</span>, <span class="st">"frame_left"</span><span class="op">)</span><span class="op">)</span>, <span class="va">difference</span>, <span class="va">percent_of_fb_max</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(genus)`</span></span>
<span><span class="co">## Joining with `by = join_by(family, genus, species)`</span></span>
<span><span class="co">## Joining with `by = join_by(campaignid, sample)`</span></span></code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">too_small</span> <span class="op">&lt;-</span> <span class="va">incorrect_lengths</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">reason</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"too small"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">too_big</span> <span class="op">&lt;-</span> <span class="va">incorrect_lengths</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">reason</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"too big"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">too_small</span><span class="op">)</span>, <span class="st">"lengths are too small"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 lengths are too small</span></span></code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">too_small</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 11</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ family            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ length_mm         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ min_length_mm     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ max_length_mm     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ length_max_mm     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ reason            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span></span>
<span><span class="co">## $ difference        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span></span>
<span><span class="co">## $ percent_of_fb_max <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span></code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">too_big</span><span class="op">)</span>, <span class="st">"lengths are too big"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 lengths are too big</span></span></code></pre>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">too_big</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 11</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ family            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ length_mm         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ min_length_mm     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ max_length_mm     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ length_max_mm     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ reason            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span></span>
<span><span class="co">## $ difference        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span></span>
<span><span class="co">## $ percent_of_fb_max <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="number-of-3d-points-and-length-measurements-over-the-rms-limit-em-only">Number of 3D points and length measurements over the RMS limit (EM
only)<a class="anchor" aria-label="anchor" href="#number-of-3d-points-and-length-measurements-over-the-rms-limit-em-only"></a>
</h3>
<p>In this check you can set the RMS limit, and then identify any
measurements that have a larger RMS.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rms_limit</span> <span class="op">&lt;-</span> <span class="fl">20</span> <span class="co"># in mm</span></span>
<span></span>
<span><span class="va">over_rms</span> <span class="op">&lt;-</span> <span class="va">complete_length</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">rms</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">rms_limit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">over_rms</span><span class="op">)</span>, <span class="st">"lengths over RMS limit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 lengths over RMS limit</span></span></code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">over_rms</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 18</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ sample            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ family            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ length_mm         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ number            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ range             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ rms               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ precision         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ date_time         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ location          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ site              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ depth_m           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ marine_region     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ scientific        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="number-of-length-measurements-over-the-precision-limit-em-only">Number of length measurements over the precision limit (EM
only)<a class="anchor" aria-label="anchor" href="#number-of-length-measurements-over-the-precision-limit-em-only"></a>
</h3>
<p>In this check you can set the precision limit, and then identify any
measurements that have a larger precision.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">precision_limit</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># in %</span></span>
<span></span>
<span><span class="va">over_precision</span> <span class="op">&lt;-</span> <span class="va">complete_length</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">precision</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">precision_limit</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">over_precision</span><span class="op">)</span>, <span class="st">"lengths over precision limit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 lengths over precision limit</span></span></code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">over_precision</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 18</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ sample            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ family            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ length_mm         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ number            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ range             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ rms               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ precision         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ date_time         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ location          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ site              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ depth_m           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ marine_region     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ scientific        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="number-of-3d-points-and-length-measurements-over-the-range-limit-em-only">Number of 3D points and length measurements over the range limit (EM
only)<a class="anchor" aria-label="anchor" href="#number-of-3d-points-and-length-measurements-over-the-range-limit-em-only"></a>
</h3>
<p>In this check you can set the range limit, and then identify any
measurements that have a larger range.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">range_limit</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># in metres</span></span>
<span></span>
<span><span class="va">over_range</span> <span class="op">&lt;-</span> <span class="va">complete_length</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">range</span><span class="op">)</span> <span class="op">&gt;</span> <span class="op">(</span><span class="va">range_limit</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">over_range</span><span class="op">)</span>, <span class="st">"lengths over range limit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 0 lengths over range limit</span></span></code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">over_range</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 0</span></span>
<span><span class="co">## Columns: 18</span></span>
<span><span class="co">## $ campaignid        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ sample            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ family            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ genus             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ species           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ length_mm         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ number            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ range             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ rms               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ precision         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> </span></span>
<span><span class="co">## $ date_time         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ location          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ site              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ depth_m           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_count  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ successful_length <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ marine_region     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span></span>
<span><span class="co">## $ scientific        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span></span></span></code></pre>
<!-- ## Samples where the MaxN does not equal the number of length measurements -->
<!-- ## Percent of MaxN Measured -->
</div>
</div>
<div class="section level2">
<h2 id="save-the-checked-data">Save the checked data<a class="anchor" aria-label="anchor" href="#save-the-checked-data"></a>
</h2>
<!-- Save MaxN as an R data file. -->
<!-- ```{r save-maxn} -->
<!-- saveRDS(complete_count, -->
<!--           file = here::here(paste0("r-workflows/data/staging/", -->
<!--                        name, "_complete-count.rds"))) -->
<!-- ``` -->
<!-- Save lengths as an R data file. -->
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">complete_length</span>,</span>
<span>          file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"r-workflows/data/staging/"</span>,</span>
<span>                       <span class="va">name</span>, <span class="st">"_complete-length.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p><img src="https://ardc.edu.au/wp-content/uploads/2022/09/ardc-logo.svg" height="60" alt="ARDC">    <img src="https://www.nespmarinecoastal.edu.au/wp-content/themes/MarineAndCoastalHubTheme/images/logo.svg" height="70" alt="National Environmental Science Program: Marine and Coastal">     Package developed by Brooke Gibbons, Claude Spencer, Tim Langlois.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
