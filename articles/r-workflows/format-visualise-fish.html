<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Format &amp; visualise fish data • CheckEM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../favicon.ico">
<link rel="manifest" href="../../site.webmanifest">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Format &amp; visualise fish data">
<meta name="google-site-verification" content="m4gXBtqSSJWTmWMwNasopAohP855o_IZ16gJxBTnZ1o">
<!-- Global site tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XRY4CFB9QS"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XRY4CFB9QS');
</script><meta name="google-site-verification" content="m4gXBtqSSJWTmWMwNasopAohP855o_IZ16gJxBTnZ1o">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">CheckEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Field Manuals</h6></li>
    <li><a class="external-link dropdown-item" href="https://benthic-bruvs-field-manual.github.io/">Baited Remote Underwater Stereo-video (stereo-BRUVs)</a></li>
    <li><a class="external-link dropdown-item" href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13189">Diver Operated Stereo-video (stereo-DOVs)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Annotation Guides</h6></li>
    <li><a class="dropdown-item" href="../../articles/manuals/EventMeasure_annotation_guide.html">Fish annotation guide (EventMeasure)</a></li>
    <li><a class="dropdown-item" href="../../articles/manuals/TransectMeasure_annotation_guide.html">Benthos annotation guide (TransectMeasure)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>CheckEM Guides</h6></li>
    <li><a class="dropdown-item" href="../../articles/manuals/CheckEM_user_guide.html">CheckEM PDF user manual</a></li>
    <li><a class="dropdown-item" href="../../articles/manuals/CheckEM_video.html">CheckEM instructional video</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-r-workflows" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">R Workflows</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-r-workflows">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Create sampling design</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/sampling-design.html">Create a spatially-balanced sampling design using GRTS</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Check Data</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-habitat.html">Check habitat data from TransectMeasure</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-fish-point.html">Check fish data from single point based methods</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-fish-transect.html">Check fish data from transect based methods</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Format Data</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/spatial-layers.html">Generate spatial layers for modelling</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/format-visualise-habitat.html">Format &amp; visualise habitat data</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/format-visualise-fish.html">Format &amp; visualise fish data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/habitat-modelling.html">Generate spatial predictions of habitat using FSSgam</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-modelling.html">Select top models for fish using FSSgam</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-predictions.html">Generate Generalized Additive Model predictions of fish</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-spatial-prediction.html">Spatially predict fish distributions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../articles/community-updates">Improve CheckEM - Contribute to Species Records</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GlobalArchiveManual/CheckEM"><span class="fa fa-github"></span> GitHub</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.nespmarinecoastal.edu.au/">ARDC</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Format &amp; visualise fish data</h1>
                        <h4 data-toc-skip class="author">Claude Spencer
&amp; Brooke Gibbons</h4>
            
            <h4 data-toc-skip class="date">2023-11-13</h4>
      

      <div class="d-none name"><code>format-visualise-fish.Rmd</code></div>
    </div>

    
    
<p>This script takes the checked fish data from the previous workflow
steps, visualises the data and exports it into a format suitable for
modelling. The exploratory visualisation of the data allows for trends
and patterns in the raw data to be investigated.</p>
<div class="section level2">
<h2 id="r-set-up">R set up<a class="anchor" aria-label="anchor" href="#r-set-up"></a>
</h2>
<p>Load the necessary libraries.</p>
<!-- ```{r libraries, results='hide', warning=FALSE, message=FALSE} -->
<!-- library('remotes') -->
<!-- options(timeout=9999999) -->
<!-- # remotes::install_github("GlobalArchiveManual/CheckEM") -->
<!-- library(CheckEM) -->
<!-- library(tidyverse) -->
<!-- library(ggplot2) -->
<!-- library(sf) -->
<!-- library(here) -->
<!-- library(leaflet) -->
<!-- ``` -->
<!-- Set the study name. -->
<!-- ```{r study-name} -->
<!-- name <- "example-bruv-workflow" -->
<!-- ``` -->
<!-- # Read in the data -->
<!-- Load and format the metadata. -->
<!-- ```{r load-metadata} -->
<!-- metadata.bathy.derivatives <- readRDS(here::here(paste0("r-workflows/data/tidy/", name, "_metadata-bathymetry-derivatives.rds"))) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Load and format the habitat data. Here we create a 'reef' column that consists of reef-forming habitat found in the study area, which will be used in subsequent fish modelling scripts. -->
<!-- ```{r load-habitat} -->
<!-- habitat <- readRDS(here::here(paste0("r-workflows/data/tidy/", name, "_tidy-habitat.rds"))) %>% -->
<!--   dplyr::mutate(number = count / total_points_annotated) %>% -->
<!--   dplyr::select(campaignid, sample, longitude_dd, latitude_dd, depth_m, mbdepth, slope, aspect, tpi, tri, roughness, detrended, habitat, number, mean_relief, sd_relief) %>% -->
<!--   pivot_wider(names_from = habitat, values_from = number, values_fill = 0) %>% -->
<!--   CheckEM::clean_names() %>% -->
<!--   dplyr::mutate(reef = consolidated_hard + macroalgae + seagrasses + sessile_invertebrates) %>%            -->
<!--   dplyr::select(-c(consolidated_hard, macroalgae, seagrasses, sessile_invertebrates, unconsolidated_soft)) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Load length of maturity data. The maturity dataset is loaded when the package is installed. -->
<!-- ```{r load-maturity} -->
<!-- maturity.mean <- maturity %>% -->
<!--   dplyr::group_by(family, genus, species, sex) %>% -->
<!--   dplyr::slice(which.min(l50_mm)) %>% -->
<!--   ungroup() %>% -->
<!--   dplyr::group_by(family, genus, species) %>% -->
<!--   dplyr::summarise(l50 = mean(l50_mm)) %>% -->
<!--   ungroup() %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Load and format count data, and transform this into total abundance and species richness. These two response variables will be used in subsequent fish modelling scripts. -->
<!-- ```{r tidy-count} -->
<!-- tidy.count <- readRDS(here::here(paste0("r-workflows/data/staging/", name, "_complete-count.rds"))) %>% -->
<!--   dplyr::filter(campaignid %in% "2023-03_SwC_stereo-BRUVs") %>% # Remove Pt Cloates campaign for now              -->
<!--   dplyr::group_by(campaignid, sample, status, scientific) %>% -->
<!--   dplyr::summarise(count = sum(count)) %>% -->
<!--   pivot_wider(names_from = "scientific", values_from = count, values_fill = 0) %>% -->
<!--   dplyr::ungroup() %>% -->
<!--   dplyr::mutate(total_abundance = rowSums(.[, 4:(ncol(.))], na.rm = TRUE), species_richness = rowSums(.[, 4:(ncol(.))] > 0)) %>%  -->
<!--   dplyr::select(campaignid, sample, status, total_abundance, species_richness) %>% -->
<!--   pivot_longer(cols = c("total_abundance", "species_richness"), names_to = "response", values_to = "number") %>% -->
<!--   dplyr::left_join(habitat) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Load and format length data. -->
<!-- ```{r load-lengths} -->
<!-- lengths <- readRDS(here::here(paste0("r-workflows/data/staging/", name, "_complete-length.rds"))) %>% -->
<!--   dplyr::filter(campaignid %in% "2023-03_SwC_stereo-BRUVs") %>% # Remove Pt Cloates campaign for now  -->
<!--   # dplyr::mutate(depth = as.numeric(depth)) %>%                       -->
<!--   left_join(habitat) %>% -->
<!--   left_join(maturity.mean) %>% -->
<!--   dplyr::mutate(number = 1) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- # Format data for visualisation and modelling -->
<!-- Filter length data to only include 'indicator species'. In our case study, these are three species that have been defined as bioregional-scale demersal fish indicators by the West Australian Department of Primary Industries and Regional Development. If there is no equivalent in your study area, we suggest using ecologically-relevant and highly-targeted species. -->
<!-- ```{r indicator species} -->
<!-- indicator.species <- lengths %>% -->
<!--   dplyr::mutate(scientific = paste(genus, species, sep = " ")) %>% -->
<!--   dplyr::filter(scientific %in% c("Choerodon rubescens", "Chrysophrys auratus", "Glaucosoma hebraicum")) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Create a unique list of the samples per campaign, to fill the zeroes back into processed length data. -->
<!-- ```{r metadata-length} -->
<!-- metadata.length <- lengths %>% -->
<!--   distinct(campaignid, sample, status) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Create a dataframe of the indicator species greater than length of maturity. -->
<!-- ```{r greater-than-maturity} -->
<!-- greater.mat <- indicator.species %>% -->
<!--   dplyr::filter(length_mm > l50) %>% -->
<!--   dplyr::group_by(campaignid, sample) %>% -->
<!--   dplyr::summarise(number = sum(number)) %>% -->
<!--   ungroup() %>% -->
<!--   right_join(metadata.length) %>% -->
<!--   dplyr::mutate(number = ifelse(is.na(number), 0, number)) %>% -->
<!--   dplyr::mutate(response = "greater than Lm") %>% -->
<!--   left_join(habitat) %>% -->
<!--   dplyr::glimpse() -->
<!-- ``` -->
<!-- Create a dataframe of the indicator species smaller than length of maturity. -->
<!-- ```{r smaller-than-maturity} -->
<!-- smaller.mat <- indicator.species %>% -->
<!--   dplyr::filter(length_mm < l50) %>% -->
<!--   dplyr::group_by(campaignid, sample) %>% -->
<!--   dplyr::summarise(number = sum(number)) %>% -->
<!--   ungroup() %>% -->
<!--   right_join(metadata.length) %>% -->
<!--   dplyr::mutate(number = ifelse(is.na(number), 0, number)) %>% -->
<!--   dplyr::mutate(response = "smaller than Lm") %>% -->
<!--   left_join(habitat) %>% -->
<!--   dplyr::glimpse() -->
<!-- ``` -->
<!-- Join the two datasets. -->
<!-- ```{r tidy-length} -->
<!-- tidy.length <- bind_rows(greater.mat, smaller.mat) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- # Visualise the fish count data -->
<!-- Filter the count (maxn) data to only include one response. In this example the count metrics included are total abundance and species richness. -->
<!-- ```{r count-plotdata} -->
<!-- response.name <- 'total_abundance' -->
<!-- overzero <-  tidy.count %>%  -->
<!--   filter(response %in% response.name & number > 0)  -->
<!-- equalzero <- tidy.count %>%  -->
<!--   filter(response %in% response.name & number == 0) -->
<!-- ``` -->
<!-- Visualise the count data as a bubble plot. White bubbles represent zeroes and the size of blue bubbles represents abundance. -->
<!-- ```{r visualise-count} -->
<!-- bubble.plot <- leaflet(data = tidy.count) %>%                      -->
<!--   addTiles() %>%                                                     -->
<!--   addProviderTiles('Esri.WorldImagery', group = "World Imagery") %>% -->
<!--   addLayersControl(baseGroups = c("Open Street Map", "World Imagery"), options = layersControlOptions(collapsed = FALSE)) -->
<!-- if (nrow(overzero)) {                                                -->
<!--   bubble.plot <- bubble.plot %>% -->
<!--     addCircleMarkers(data = overzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = ~ number / 10, fillOpacity = 0.5, stroke = FALSE, label = ~ as.character(sample))} -->
<!-- if (nrow(equalzero)) {                                             -->
<!--   bubble.plot <- bubble.plot %>% -->
<!--     addCircleMarkers(data = equalzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = 2, fillOpacity = 0.5, color = "white", stroke = FALSE, label = ~ as.character(sample))} -->
<!-- bubble.plot -->
<!-- ``` -->
<!-- # Visualise the fish length data -->
<!-- Filter the length data to only include one response. In this example the length metrics included are indicator species greater than and smaller than the length of maturity. -->
<!-- ```{r length-plotdata} -->
<!-- response.name <- 'greater than Lm' -->
<!-- overzero <-  tidy.length %>%  -->
<!--   dplyr::filter(response %in% response.name & number > 0)  -->
<!-- equalzero <- tidy.length %>%  -->
<!--   dplyr::filter(response %in% response.name & number == 0) -->
<!-- ``` -->
<!-- Visualise the count data as a bubble plot. White bubbles represent zeroes and the size of blue bubbles represents abundance. -->
<!-- ```{r visualise-length} -->
<!-- bubble.plot <- leaflet(data = tidy.length) %>%                      -->
<!--   addTiles() %>%                                                     -->
<!--   addProviderTiles('Esri.WorldImagery', group = "World Imagery") %>% -->
<!--   addLayersControl(baseGroups = c("Open Street Map", "World Imagery"), options = layersControlOptions(collapsed = FALSE)) -->
<!-- if (nrow(overzero)) {                                                -->
<!--   bubble.plot <- bubble.plot %>% -->
<!--     addCircleMarkers(data = overzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = ~ number + 3, fillOpacity = 0.5, stroke = FALSE, label = ~ as.character(sample))} -->
<!-- if (nrow(equalzero)) {                                             -->
<!--   bubble.plot <- bubble.plot %>% -->
<!--     addCircleMarkers(data = equalzero, lat = ~ latitude_dd, lng = ~ longitude_dd, radius = 2, fillOpacity = 0.5, color = "white", stroke = FALSE, label = ~ as.character(sample))} -->
<!-- bubble.plot -->
<!-- ``` -->
<!-- # Save tidy datasets for modelling -->
<!-- Save count response data (total abundance and species richness). -->
<!-- ```{r save-count} -->
<!-- saveRDS(tidy.count, file = here::here(paste0("r-workflows/data/tidy/", name, "_tidy-count.rds"))) -->
<!-- ``` -->
<!-- Save length response data (indicator species greater than and smaller than the length of maturity). -->
<!-- ```{r save-length} -->
<!-- saveRDS(tidy.length, file = here::here(paste0("r-workflows/data/tidy/", name, "_tidy-length.rds"))) -->
<!-- ``` -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p><img src="https://ardc.edu.au/wp-content/uploads/2022/09/ardc-logo.svg" height="60" alt="ARDC">    <img src="https://www.nespmarinecoastal.edu.au/wp-content/themes/MarineAndCoastalHubTheme/images/logo.svg" height="70" alt="National Environmental Science Program: Marine and Coastal">     Package developed by Brooke Gibbons, Claude Spencer, Tim Langlois.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
