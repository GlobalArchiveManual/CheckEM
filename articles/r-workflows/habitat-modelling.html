<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generate spatial predictions of habitat using FSSgam • CheckEM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Generate spatial predictions of habitat using FSSgam">
<!-- Global site tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XRY4CFB9QS"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XRY4CFB9QS');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">CheckEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Field Manuals</h6></li>
    <li><a class="external-link dropdown-item" href="https://benthic-bruvs-field-manual.github.io/">Baited Remote Underwater Stereo-video (stereo-BRUVs)</a></li>
    <li><a class="external-link dropdown-item" href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13189">Diver Operated Stereo-video (stereo-DOVs)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Annotation Guides</h6></li>
    <li><a class="dropdown-item" href="../../articles/manuals/EventMeasure_annotation_guide.html">Fish annotation guide (EventMeasure)</a></li>
    <li><a class="dropdown-item" href="../../articles/manuals/TransectMeasure_annotation_guide.html">Benthos annotation guide (TransectMeasure)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>CheckEM Guides</h6></li>
    <li><a class="dropdown-item" href="../../articles/manuals/CheckEM_user_guide.html">CheckEM PDF user manual</a></li>
    <li><a class="dropdown-item" href="../../articles/manuals/CheckEM_video.html">CheckEM instructional video</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-r-workflows" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">R Workflows</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-r-workflows">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Check Data</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-habitat.html">Check habitat data from TransectMeasure</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-fish-point.html">Check fish data from single point based methods</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-fish-transect.html">Check fish data from transect based methods</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Format Data</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/spatial-layers.html">Generate spatial layers for modelling</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/format-visualise-habitat.html">Format &amp; visualise habitat data</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/format-visualise-fish.html">Format &amp; visualise fish data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/habitat-modelling.html">Generate spatial predictions of habitat using FSSgam</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-modelling.html">Select top models for fish using FSSgam</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-predictions.html">Generate Generalized Additive Model predictions of fish</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-spatial-prediction.html">Spatially predict fish distributions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../reference">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GlobalArchiveManual/CheckEM"><span class="fa fa-github"></span> GitHub</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.nespmarinecoastal.edu.au/">ARDC</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../../logo.png" class="logo" alt=""><h1>Generate spatial predictions of habitat using FSSgam</h1>
                        <h4 data-toc-skip class="author">Claude Spencer
&amp; Brooke Gibbons</h4>
            
            <h4 data-toc-skip class="date">2023-11-13</h4>
      

      <div class="d-none name"><code>habitat-modelling.Rmd</code></div>
    </div>

    
    
<p>This script takes the checked habitat data from the previous workflow
steps, visualises the data and exports it into a format suitable for
modelling. The exploratory visualisation of the data allows for trends
and patterns in the raw data to be investigated.</p>
<div class="section level2">
<h2 id="r-setup">R setup<a class="anchor" aria-label="anchor" href="#r-setup"></a>
</h2>
<p>Load libraries.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://globalarchivemanual.github.io/CheckEM/">CheckEM</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FSSgam</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eliocamp.github.io/ggnewscale/" class="external-link">ggnewscale</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p>Set the study name.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">name</span> <span class="op">&lt;-</span> <span class="st">'example-bruv-workflow'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p>Load the habitat point annotation data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"r-workflows/data/tidy/"</span>, </span>
<span>                      <span class="va">name</span>, <span class="st">"_tidy-habitat.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 192</span></span>
<span><span class="co">## Columns: 27</span></span>
<span><span class="co">## $ campaignid                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2023-03_SwC_stereo-BRUVs", "2023-03_SwC_s…</span></span>
<span><span class="co">## $ sample                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "35", "35", "35", "35", "35", "35", "5", "…</span></span>
<span><span class="co">## $ date_time                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "14/03/2023 23:36", "14/03/2023 23:36", "1…</span></span>
<span><span class="co">## $ location                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">## $ site                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">## $ depth                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "39.6", "39.6", "39.6", "39.6", "39.6", "3…</span></span>
<span><span class="co">## $ successful_count            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", …</span></span>
<span><span class="co">## $ successful_length           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", …</span></span>
<span><span class="co">## $ successful_habitat_forward  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", …</span></span>
<span><span class="co">## $ successful_habitat_backward <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", …</span></span>
<span><span class="co">## $ x                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 114.9236, 114.9236, 114.9236, 114.9236, 11…</span></span>
<span><span class="co">## $ y                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -34.13155, -34.13155, -34.13155, -34.13155…</span></span>
<span><span class="co">## $ longitude_dd                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 114.9236, 114.9236, 114.9236, 114.9236, 11…</span></span>
<span><span class="co">## $ latitude_dd                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -34.13155, -34.13155, -34.13155, -34.13155…</span></span>
<span><span class="co">## $ id                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 63, 63, 63, 63, 63, 63, 64, 64, 64, 64, 64…</span></span>
<span><span class="co">## $ mbdepth                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -34.97151, -34.97151, -34.97151, -34.97151…</span></span>
<span><span class="co">## $ slope                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.1468434, 0.1468434, 0.1468434, 0.1468434…</span></span>
<span><span class="co">## $ aspect                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 209.89577, 209.89577, 209.89577, 209.89577…</span></span>
<span><span class="co">## $ tpi                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.4215345, 0.4215345, 0.4215345, 0.4215345…</span></span>
<span><span class="co">## $ tri                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.7555733, 0.7555733, 0.7555733, 0.7555733…</span></span>
<span><span class="co">## $ roughness                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.211193, 2.211193, 2.211193, 2.211193, 2.…</span></span>
<span><span class="co">## $ detrended                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -5.663174, -5.663174, -5.663174, -5.663174…</span></span>
<span><span class="co">## $ total_points_annotated      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 109, 109, 109, 109, 109, 109, 116, 116, 11…</span></span>
<span><span class="co">## $ habitat                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Macroalgae", "Seagrasses", "Sessile inver…</span></span>
<span><span class="co">## $ number                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 96, 1, 3, 1, 8, 101, 110, 6, 0, 0, 0, 116,…</span></span>
<span><span class="co">## $ mean_relief                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.034483, 3.034483, 3.034483, 3.034483, 3.…</span></span>
<span><span class="co">## $ sd_relief                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.1174831, 1.1174831, 1.1174831, 1.1174831…</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="set-up-data-for-modelling">Set up data for modelling<a class="anchor" aria-label="anchor" href="#set-up-data-for-modelling"></a>
</h2>
<p>Set the predictor variables.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "campaignid"                  "sample"                     </span></span>
<span><span class="co">##  [3] "date_time"                   "location"                   </span></span>
<span><span class="co">##  [5] "site"                        "depth"                      </span></span>
<span><span class="co">##  [7] "successful_count"            "successful_length"          </span></span>
<span><span class="co">##  [9] "successful_habitat_forward"  "successful_habitat_backward"</span></span>
<span><span class="co">## [11] "x"                           "y"                          </span></span>
<span><span class="co">## [13] "longitude_dd"                "latitude_dd"                </span></span>
<span><span class="co">## [15] "id"                          "mbdepth"                    </span></span>
<span><span class="co">## [17] "slope"                       "aspect"                     </span></span>
<span><span class="co">## [19] "tpi"                         "tri"                        </span></span>
<span><span class="co">## [21] "roughness"                   "detrended"                  </span></span>
<span><span class="co">## [23] "total_points_annotated"      "habitat"                    </span></span>
<span><span class="co">## [25] "number"                      "mean_relief"                </span></span>
<span><span class="co">## [27] "sd_relief"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mbdepth"</span>,<span class="st">"roughness"</span>, <span class="st">"detrended"</span>, </span>
<span>               <span class="st">"slope"</span>, <span class="st">"tpi"</span>, <span class="st">"aspect"</span>, <span class="st">"tri"</span><span class="op">)</span>  </span></code></pre></div>
<p>Check for correlation of predictor variables and remove anything
highly correlated (&gt;0.95).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">[</span> , <span class="va">pred.vars</span><span class="op">]</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           mbdepth roughness detrended slope   tpi aspect   tri</span></span>
<span><span class="co">## mbdepth      1.00     -0.66     -0.89 -0.65  0.03  -0.32 -0.59</span></span>
<span><span class="co">## roughness   -0.66      1.00      0.48  0.99  0.29   0.06  0.99</span></span>
<span><span class="co">## detrended   -0.89      0.48      1.00  0.47  0.00   0.39  0.42</span></span>
<span><span class="co">## slope       -0.65      0.99      0.47  1.00  0.29   0.06  0.99</span></span>
<span><span class="co">## tpi          0.03      0.29      0.00  0.29  1.00  -0.02  0.35</span></span>
<span><span class="co">## aspect      -0.32      0.06      0.39  0.06 -0.02   1.00  0.04</span></span>
<span><span class="co">## tri         -0.59      0.99      0.42  0.99  0.35   0.04  1.00</span></span></code></pre>
<p>Plot the individual predictors to assess if any transformations are
necessary. We suggest to only use transformations when absolutely
necessary. In the example dataset, most of the response variables have
relatively balanced distributions, and therefor we have left them
untransformed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/plot_transformations.html">plot_transformations</a></span><span class="op">(</span>pred.vars <span class="op">=</span> <span class="va">pred.vars</span>, dat <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/transformations-1.png" width="700"><img src="habitat-modelling_files/figure-html/transformations-2.png" width="700"><img src="habitat-modelling_files/figure-html/transformations-3.png" width="700"><img src="habitat-modelling_files/figure-html/transformations-4.png" width="700"><img src="habitat-modelling_files/figure-html/transformations-5.png" width="700"><img src="habitat-modelling_files/figure-html/transformations-6.png" width="700"><img src="habitat-modelling_files/figure-html/transformations-7.png" width="700"></p>
<p>Reset the predictor variables to remove any highly correlated
variables and include any transformed variables.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred.vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depth"</span>,<span class="st">"roughness"</span>, <span class="st">"detrended"</span>, </span>
<span>               <span class="st">"tpi"</span>, <span class="st">"aspect"</span>, <span class="st">"tri"</span><span class="op">)</span></span></code></pre></div>
<p>Check to make sure response variables have less than 80% zeroes.
Full-subset GAM modelling will produce unreliable results if your data
is too zero inflated.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resp.vars.all</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">habitat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">resp.vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resp.vars.all</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">temp.dat</span> <span class="op">=</span> <span class="va">dat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">habitat</span> <span class="op">==</span> <span class="va">resp.vars.all</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">temp.dat</span><span class="op">$</span><span class="va">habitat</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">temp.dat</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">resp.vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">resp.vars</span>, <span class="va">resp.vars.all</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">resp.vars</span> </span></code></pre></div>
<pre><code><span><span class="co">## [1] "Macroalgae"            "Seagrasses"            "Sessile invertebrates"</span></span>
<span><span class="co">## [4] "Consolidated (hard)"   "Unconsolidated (soft)" "reef"</span></span></code></pre>
<p>Add the directory to save model outputs, and set up the R environment
for model selection.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outdir</span>    <span class="op">&lt;-</span> <span class="op">(</span><span class="st">"r-workflows/model output/habitat/"</span><span class="op">)</span></span>
<span><span class="va">out.all</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">var.imp</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-the-full-subset-model-selection-process">Run the full subset model selection process<a class="anchor" aria-label="anchor" href="#run-the-full-subset-model-selection-process"></a>
</h2>
<p>This loop has been adapted from <span class="citation">@beckyfisher/FSSgam</span>, and examples and
documentation is available on GitHub and in Fisher, R, Wilson, SK, Sin,
TM, Lee, AC, Langlois, TJ. A simple function for full-subsets multiple
regression in ecology with R. Ecol Evol. 2018; 8: 6104–6113. <a href="https://doi.org/10.1002/ece3.4134" class="external-link uri">https://doi.org/10.1002/ece3.4134</a></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">resp.vars</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">resp.vars</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">use.dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">habitat</span> <span class="op">==</span> <span class="va">resp.vars</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="op">]</span></span>
<span>  <span class="va">use.dat</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">use.dat</span><span class="op">)</span></span>
<span>  <span class="va">Model1</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">number</span>, <span class="op">(</span><span class="va">total_points_annotated</span> <span class="op">-</span> <span class="va">number</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                   <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">mbdepth</span>, bs <span class="op">=</span> <span class="st">'cr'</span><span class="op">)</span>,</span>
<span>                 family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span>,  data <span class="op">=</span> <span class="va">use.dat</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">model.set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FSSgam/man/generate.model.set.html" class="external-link">generate.model.set</a></span><span class="op">(</span>use.dat <span class="op">=</span> <span class="va">use.dat</span>,</span>
<span>                                  test.fit <span class="op">=</span> <span class="va">Model1</span>,</span>
<span>                                  pred.vars.cont <span class="op">=</span> <span class="va">pred.vars</span>,</span>
<span>                                  cyclic.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aspect"</span><span class="op">)</span>,</span>
<span>                                  k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                  cov.cutoff <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">out.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FSSgam/man/fit.model.set.html" class="external-link">fit.model.set</a></span><span class="op">(</span><span class="va">model.set</span>,</span>
<span>                            max.models <span class="op">=</span> <span class="fl">600</span>,</span>
<span>                            parallel <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out.list</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">out.list</span><span class="op">$</span><span class="va">failed.models</span> </span>
<span>  <span class="va">mod.table</span> <span class="op">&lt;-</span> <span class="va">out.list</span><span class="op">$</span><span class="va">mod.data.out</span></span>
<span>  <span class="va">mod.table</span> <span class="op">&lt;-</span> <span class="va">mod.table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">mod.table</span><span class="op">$</span><span class="va">AICc</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">mod.table</span><span class="op">$</span><span class="va">cumsum.wi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">mod.table</span><span class="op">$</span><span class="va">wi.AICc</span><span class="op">)</span></span>
<span>  <span class="va">out.i</span>     <span class="op">&lt;-</span> <span class="va">mod.table</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">mod.table</span><span class="op">$</span><span class="va">delta.AICc</span> <span class="op">&lt;=</span> <span class="fl">2</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  <span class="va">out.all</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">out.all</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">out.i</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">var.imp</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">var.imp</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">out.list</span><span class="op">$</span><span class="va">variable.importance</span><span class="op">$</span><span class="va">aic</span><span class="op">$</span><span class="va">variable.weights.raw</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">out.i</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">best.model.name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">out.i</span><span class="op">$</span><span class="va">modname</span><span class="op">[</span><span class="va">m</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="va">m</span>, <span class="va">resp.vars</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"mod_fits.png"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">best.model.name</span> <span class="op">!=</span> <span class="st">"null"</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">4</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">best.model</span> <span class="op">=</span> <span class="va">out.list</span><span class="op">$</span><span class="va">success.models</span><span class="op">[[</span><span class="va">best.model.name</span><span class="op">]</span><span class="op">]</span></span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">best.model</span>, all.terms <span class="op">=</span> <span class="cn">T</span>, pages <span class="op">=</span> <span class="fl">1</span>, residuals <span class="op">=</span> <span class="cn">T</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, text <span class="op">=</span> <span class="va">resp.vars</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, outer <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">}</span>  </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Save the model fits and importance scores.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">out.all</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">resp.vars</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">var.imp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">resp.vars</span></span>
<span><span class="va">all.mod.fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/list_c.html" class="external-link">list_rbind</a></span><span class="op">(</span><span class="va">out.all</span>, names_to <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">all.var.imp</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>,<span class="va">var.imp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">all.mod.fits</span><span class="op">[</span> , <span class="op">-</span><span class="fl">2</span><span class="op">]</span>, file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="va">name</span>, <span class="st">"_all.mod.fits.csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">all.var.imp</span>,         file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="va">name</span>, <span class="st">"_all.var.imp.csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="spatially-predict-the-top-model-from-the-model-selection-process">Spatially predict the top model from the model selection
process<a class="anchor" aria-label="anchor" href="#spatially-predict-the-top-model-from-the-model-selection-process"></a>
</h2>
<p>Transform the habitat data into wide format for easy prediction.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">widedat</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>values_from <span class="op">=</span> <span class="st">"number"</span>, names_from <span class="op">=</span> <span class="st">"habitat"</span>, values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 32</span></span>
<span><span class="co">## Columns: 31</span></span>
<span><span class="co">## $ campaignid                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "2023-03_SwC_stereo-BRUVs", "2023-03_SwC_s…</span></span>
<span><span class="co">## $ sample                      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "35", "5", "26", "23", "29", "4", "32", "3…</span></span>
<span><span class="co">## $ date_time                   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "14/03/2023 23:36", "14/03/2023 23:49", "1…</span></span>
<span><span class="co">## $ location                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">## $ site                        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span></span>
<span><span class="co">## $ depth                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "39.6", "42.7", "36", "41", "42.6", "45", …</span></span>
<span><span class="co">## $ successful_count            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", …</span></span>
<span><span class="co">## $ successful_length           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", …</span></span>
<span><span class="co">## $ successful_habitat_forward  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", …</span></span>
<span><span class="co">## $ successful_habitat_backward <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Yes", "Yes", "Yes", "Yes", "Yes", "Yes", …</span></span>
<span><span class="co">## $ x                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 114.9236, 114.9292, 114.9284, 114.9190, 11…</span></span>
<span><span class="co">## $ y                           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -34.13155, -34.12953, -34.12729, -34.12832…</span></span>
<span><span class="co">## $ longitude_dd                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 114.9236, 114.9292, 114.9284, 114.9190, 11…</span></span>
<span><span class="co">## $ latitude_dd                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -34.13155, -34.12953, -34.12729, -34.12832…</span></span>
<span><span class="co">## $ id                          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73…</span></span>
<span><span class="co">## $ mbdepth                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -34.97151, -36.35807, -40.68553, -38.25594…</span></span>
<span><span class="co">## $ slope                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.146843375, 0.812689749, 0.694289634, 0.4…</span></span>
<span><span class="co">## $ aspect                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 209.89577, 62.41434, 40.87387, 294.10675, …</span></span>
<span><span class="co">## $ tpi                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.42153454, 2.39535522, -0.67607403, 0.476…</span></span>
<span><span class="co">## $ tri                         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.75557327, 3.29823494, 2.39221191, 1.8367…</span></span>
<span><span class="co">## $ roughness                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.21119308, 8.36493301, 8.36493301, 5.3012…</span></span>
<span><span class="co">## $ detrended                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -5.6631737, -7.0394716, -11.2637815, -8.69…</span></span>
<span><span class="co">## $ total_points_annotated      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 109, 116, 123, 68, 56, 58, 25, 14, 28, 39,…</span></span>
<span><span class="co">## $ mean_relief                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3.034483, 3.900000, 4.000000, 3.555556, 4.…</span></span>
<span><span class="co">## $ sd_relief                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.1174831, 0.4472136, 0.0000000, 0.8555853…</span></span>
<span><span class="co">## $ macroalgae                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 96, 110, 105, 50, 28, 50, 7, 1, 16, 30, 57…</span></span>
<span><span class="co">## $ seagrasses                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 6, 18, 11, 28, 6, 0, 1, 1, 9, 2, 4, 14,…</span></span>
<span><span class="co">## $ sessile_invertebrates       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 3, 0, 0, 7, 0, 2, 2, 0, 0, 0, 2, 0, 1, 0, …</span></span>
<span><span class="co">## $ consolidated_hard           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, …</span></span>
<span><span class="co">## $ unconsolidated_soft         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 8, 0, 0, 0, 0, 0, 13, 12, 11, 0, 0, 0, 0, …</span></span>
<span><span class="co">## $ reef                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 101, 116, 123, 68, 56, 58, 12, 2, 17, 39, …</span></span></code></pre>
<p>Load the raster of bathymetry data and derivatives.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preds</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"r-workflows/data/spatial/rasters/"</span>, </span>
<span>                         <span class="va">name</span>, <span class="st">"_bathymetry_derivatives.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/load-bathymetry-1.png" width="672"></p>
<p>Transform the raster to a dataframe to predict onto.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preddf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">preds</span>, xy <span class="op">=</span> <span class="cn">TRUE</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">mbdepth</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>                                       </span>
<span>  <span class="fu"><a href="../../reference/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 73,350</span></span>
<span><span class="co">## Columns: 10</span></span>
<span><span class="co">## $ x         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 115.1714, 115.1739, 115.1764, 115.1789, 115.1814, 115.1839, …</span></span>
<span><span class="co">## $ y         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33.6…</span></span>
<span><span class="co">## $ mbdepth   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -14.83014, -13.89184, -14.18757, -14.48647, -14.47323, -14.3…</span></span>
<span><span class="co">## $ slope     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.24350203, 0.19746646, 0.17799167, 0.18316828, 0.22091857, …</span></span>
<span><span class="co">## $ aspect    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 339.995240, 341.597571, 21.180346, 12.600024, 356.337121, 35…</span></span>
<span><span class="co">## $ tpi       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -3.721524e-01, 5.277313e-01, 1.502453e-01, -1.123428e-03, 9.…</span></span>
<span><span class="co">## $ tri       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9656481, 0.8277034, 0.6934198, 0.6945946, 0.8081013, 0.902…</span></span>
<span><span class="co">## $ roughness <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.807414, 2.421717, 2.196986, 2.156502, 2.581898, 2.606502, …</span></span>
<span><span class="co">## $ detrended <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -2.871674, -2.161609, -2.683798, -3.207528, -3.417629, -3.56…</span></span>
<span><span class="co">## $ depth     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 14.83014, 13.89184, 14.18757, 14.48647, 14.47323, 14.39490, …</span></span></code></pre>
<p>Manually set the top model from the full subset model selection.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sessile invertebrates</span></span>
<span><span class="va">m_inverts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sessile_invertebrates</span>, <span class="va">total_points_annotated</span> <span class="op">-</span> <span class="va">sessile_invertebrates</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">detrended</span>,     k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">roughness</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">tpi</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>               data <span class="op">=</span> <span class="va">widedat</span>, method <span class="op">=</span> <span class="st">"REML"</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_inverts</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: binomial </span></span>
<span><span class="co">## Link function: logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## cbind(sessile_invertebrates, total_points_annotated - sessile_invertebrates) ~ </span></span>
<span><span class="co">##     s(detrended, k = 5, bs = "cr") + s(roughness, k = 5, bs = "cr") + </span></span>
<span><span class="co">##         s(tpi, k = 5, bs = "cr")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)  -2.6145     0.1877  -13.93   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                edf Ref.df Chi.sq  p-value    </span></span>
<span><span class="co">## s(detrended) 3.587  3.873 242.13  &lt; 2e-16 ***</span></span>
<span><span class="co">## s(roughness) 2.767  3.011  35.91  &lt; 2e-16 ***</span></span>
<span><span class="co">## s(tpi)       3.516  3.861  30.84 1.93e-06 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  0.971   Deviance explained = 95.4%</span></span>
<span><span class="co">## -REML = 70.308  Scale est. = 1         n = 32</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_inverts</span>, pages <span class="op">=</span> <span class="fl">1</span>, residuals <span class="op">=</span> <span class="cn">T</span>, cex <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/set-models-1.png" width="672"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Rock</span></span>
<span><span class="va">m_rock</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">consolidated_hard</span>, <span class="va">total_points_annotated</span> <span class="op">-</span> <span class="va">consolidated_hard</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                   <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">aspect</span>,     k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">detrended</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">tpi</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>                 data <span class="op">=</span> <span class="va">widedat</span>, method <span class="op">=</span> <span class="st">"REML"</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_rock</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: binomial </span></span>
<span><span class="co">## Link function: logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## cbind(consolidated_hard, total_points_annotated - consolidated_hard) ~ </span></span>
<span><span class="co">##     s(aspect, k = 5, bs = "cr") + s(detrended, k = 5, bs = "cr") + </span></span>
<span><span class="co">##         s(tpi, k = 5, bs = "cr")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)  -6.1469     0.6382  -9.632   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                edf Ref.df Chi.sq  p-value    </span></span>
<span><span class="co">## s(aspect)    3.610  3.881 14.619 0.005658 ** </span></span>
<span><span class="co">## s(detrended) 3.191  3.561 20.012 0.000264 ***</span></span>
<span><span class="co">## s(tpi)       1.000  1.000  4.553 0.032883 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  0.889   Deviance explained = 83.6%</span></span>
<span><span class="co">## -REML = 27.178  Scale est. = 1         n = 32</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_rock</span>, pages <span class="op">=</span> <span class="fl">1</span>, residuals <span class="op">=</span> <span class="cn">T</span>, cex <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/set-models-2.png" width="672"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sand</span></span>
<span><span class="va">m_sand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">unconsolidated_soft</span>, <span class="va">total_points_annotated</span> <span class="op">-</span> <span class="va">unconsolidated_soft</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">aspect</span>,     k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">detrended</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">roughness</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>              data <span class="op">=</span> <span class="va">widedat</span>, method <span class="op">=</span> <span class="st">"REML"</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_sand</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: binomial </span></span>
<span><span class="co">## Link function: logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## cbind(unconsolidated_soft, total_points_annotated - unconsolidated_soft) ~ </span></span>
<span><span class="co">##     s(aspect, k = 5, bs = "cr") + s(detrended, k = 5, bs = "cr") + </span></span>
<span><span class="co">##         s(roughness, k = 5, bs = "cr")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)  -11.744      3.232  -3.634 0.000279 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                edf Ref.df Chi.sq p-value    </span></span>
<span><span class="co">## s(aspect)    3.732  3.928 54.809  &lt;2e-16 ***</span></span>
<span><span class="co">## s(detrended) 3.646  3.914 92.895  &lt;2e-16 ***</span></span>
<span><span class="co">## s(roughness) 1.966  2.195  9.042  0.0161 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  0.867   Deviance explained = 83.1%</span></span>
<span><span class="co">## -REML = 66.533  Scale est. = 1         n = 32</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_sand</span>, pages <span class="op">=</span> <span class="fl">1</span>, residuals <span class="op">=</span> <span class="cn">T</span>, cex <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/set-models-3.png" width="672"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Seagrasses</span></span>
<span><span class="va">m_seagrass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">seagrasses</span>, <span class="va">total_points_annotated</span> <span class="op">-</span> <span class="va">seagrasses</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">aspect</span>,     k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">detrended</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">roughness</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>              data <span class="op">=</span> <span class="va">widedat</span>, method <span class="op">=</span> <span class="st">"REML"</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_seagrass</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: binomial </span></span>
<span><span class="co">## Link function: logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## cbind(seagrasses, total_points_annotated - seagrasses) ~ s(aspect, </span></span>
<span><span class="co">##     k = 5, bs = "cr") + s(detrended, k = 5, bs = "cr") + s(roughness, </span></span>
<span><span class="co">##     k = 5, bs = "cr")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)   -51.90      10.61  -4.894  9.9e-07 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                edf Ref.df Chi.sq p-value    </span></span>
<span><span class="co">## s(aspect)    3.594  3.874  38.01  &lt;2e-16 ***</span></span>
<span><span class="co">## s(detrended) 3.876  3.977  46.87  &lt;2e-16 ***</span></span>
<span><span class="co">## s(roughness) 3.310  3.647  45.92  &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  0.668   Deviance explained =   83%</span></span>
<span><span class="co">## -REML = 84.672  Scale est. = 1         n = 32</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_seagrass</span>, pages <span class="op">=</span> <span class="fl">1</span>, residuals <span class="op">=</span> <span class="cn">T</span>, cex <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/set-models-4.png" width="672"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Macroalgae</span></span>
<span><span class="va">m_macro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">macroalgae</span>, <span class="va">total_points_annotated</span> <span class="op">-</span> <span class="va">macroalgae</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">mbdepth</span>,     k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">detrended</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">tpi</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>               data <span class="op">=</span> <span class="va">widedat</span>, method <span class="op">=</span> <span class="st">"REML"</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_macro</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: binomial </span></span>
<span><span class="co">## Link function: logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## cbind(macroalgae, total_points_annotated - macroalgae) ~ s(mbdepth, </span></span>
<span><span class="co">##     k = 5, bs = "cr") + s(detrended, k = 5, bs = "cr") + s(tpi, </span></span>
<span><span class="co">##     k = 5, bs = "cr")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)  0.09879    0.08551   1.155    0.248</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                edf Ref.df Chi.sq  p-value    </span></span>
<span><span class="co">## s(mbdepth)   2.454  2.922 130.02  &lt; 2e-16 ***</span></span>
<span><span class="co">## s(detrended) 1.000  1.000  15.81 7.01e-05 ***</span></span>
<span><span class="co">## s(tpi)       3.595  3.878  58.72  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  0.768   Deviance explained = 80.5%</span></span>
<span><span class="co">## -REML = 148.34  Scale est. = 1         n = 32</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_macro</span>, pages <span class="op">=</span> <span class="fl">1</span>, residuals <span class="op">=</span> <span class="cn">T</span>, cex <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/set-models-5.png" width="672"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Reef</span></span>
<span><span class="va">m_reef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">reef</span>, <span class="va">total_points_annotated</span> <span class="op">-</span> <span class="va">reef</span><span class="op">)</span> <span class="op">~</span> </span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">aspect</span>,     k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">detrended</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">roughness</span>, k <span class="op">=</span> <span class="fl">5</span>, bs <span class="op">=</span> <span class="st">"cr"</span><span class="op">)</span>, </span>
<span>               data <span class="op">=</span> <span class="va">widedat</span>, method <span class="op">=</span> <span class="st">"REML"</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_reef</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: binomial </span></span>
<span><span class="co">## Link function: logit </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## cbind(reef, total_points_annotated - reef) ~ s(aspect, k = 5, </span></span>
<span><span class="co">##     bs = "cr") + s(detrended, k = 5, bs = "cr") + s(roughness, </span></span>
<span><span class="co">##     k = 5, bs = "cr")</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)   11.744      3.232   3.634 0.000279 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                edf Ref.df Chi.sq p-value    </span></span>
<span><span class="co">## s(aspect)    3.732  3.928 54.809  &lt;2e-16 ***</span></span>
<span><span class="co">## s(detrended) 3.646  3.914 92.895  &lt;2e-16 ***</span></span>
<span><span class="co">## s(roughness) 1.966  2.195  9.042  0.0161 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  0.867   Deviance explained = 83.1%</span></span>
<span><span class="co">## -REML = 66.533  Scale est. = 1         n = 32</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">m_reef</span>, pages <span class="op">=</span> <span class="fl">1</span>, residuals <span class="op">=</span> <span class="cn">T</span>, cex <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/set-models-6.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="predict-rasterise-and-plot-habitat-predictions">Predict, rasterise and plot habitat predictions<a class="anchor" aria-label="anchor" href="#predict-rasterise-and-plot-habitat-predictions"></a>
</h2>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preddf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">preddf</span>, </span>
<span>                <span class="st">"pmacro"</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m_macro</span>, <span class="va">preddf</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>                <span class="st">"prock"</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m_rock</span>, <span class="va">preddf</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>                <span class="st">"psand"</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m_sand</span>, <span class="va">preddf</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>                <span class="st">"pseagrass"</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m_seagrass</span>, <span class="va">preddf</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>                <span class="st">"pinverts"</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m_inverts</span>, <span class="va">preddf</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>,</span>
<span>                <span class="st">"preef"</span> <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m_reef</span>, <span class="va">preddf</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 73,350</span></span>
<span><span class="co">## Columns: 16</span></span>
<span><span class="co">## $ x         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 115.1714, 115.1739, 115.1764, 115.1789, 115.1814, 115.1839, …</span></span>
<span><span class="co">## $ y         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33.6…</span></span>
<span><span class="co">## $ mbdepth   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -14.83014, -13.89184, -14.18757, -14.48647, -14.47323, -14.3…</span></span>
<span><span class="co">## $ slope     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.24350203, 0.19746646, 0.17799167, 0.18316828, 0.22091857, …</span></span>
<span><span class="co">## $ aspect    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 339.995240, 341.597571, 21.180346, 12.600024, 356.337121, 35…</span></span>
<span><span class="co">## $ tpi       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -3.721524e-01, 5.277313e-01, 1.502453e-01, -1.123428e-03, 9.…</span></span>
<span><span class="co">## $ tri       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9656481, 0.8277034, 0.6934198, 0.6945946, 0.8081013, 0.902…</span></span>
<span><span class="co">## $ roughness <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.807414, 2.421717, 2.196986, 2.156502, 2.581898, 2.606502, …</span></span>
<span><span class="co">## $ detrended <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -2.871674, -2.161609, -2.683798, -3.207528, -3.417629, -3.56…</span></span>
<span><span class="co">## $ depth     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 14.83014, 13.89184, 14.18757, 14.48647, 14.47323, 14.39490, …</span></span>
<span><span class="co">## $ pmacro    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9994044, 0.9986021, 0.9991463, 0.9991944, 0.9991232, 0.999…</span></span>
<span><span class="co">## $ prock     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.007066725, 0.002316534, 0.032253187, 0.125768311, 0.005744…</span></span>
<span><span class="co">## $ psand     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.220446e-16, 2.220446e-16, 1.530496e-04, 1.067617e-04, 2.22…</span></span>
<span><span class="co">## $ pseagrass <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.63705545, 0.70420525, 0.45269763, 0.33056725, 0.72609061, …</span></span>
<span><span class="co">## $ pinverts  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.005092447, 0.005315867, 0.004900178, 0.005803717, 0.006133…</span></span>
<span><span class="co">## $ preef     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.0000000, 1.0000000, 0.9998470, 0.9998932, 1.0000000, 1.000…</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="tidy-and-save-the-final-dataset">Tidy and save the final dataset<a class="anchor" aria-label="anchor" href="#tidy-and-save-the-final-dataset"></a>
</h2>
<p>Create a column for the ‘dominant’ habitat</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preddf</span><span class="op">$</span><span class="va">dom_tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">preddf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pmacro</span>, <span class="va">prock</span>, <span class="va">psand</span>, <span class="va">pseagrass</span>, <span class="va">pinverts</span><span class="op">)</span>, <span class="fl">1</span>,</span>
<span>                         FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 73,350</span></span>
<span><span class="co">## Columns: 17</span></span>
<span><span class="co">## $ x         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 115.1714, 115.1739, 115.1764, 115.1789, 115.1814, 115.1839, …</span></span>
<span><span class="co">## $ y         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33.6…</span></span>
<span><span class="co">## $ mbdepth   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -14.83014, -13.89184, -14.18757, -14.48647, -14.47323, -14.3…</span></span>
<span><span class="co">## $ slope     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.24350203, 0.19746646, 0.17799167, 0.18316828, 0.22091857, …</span></span>
<span><span class="co">## $ aspect    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 339.995240, 341.597571, 21.180346, 12.600024, 356.337121, 35…</span></span>
<span><span class="co">## $ tpi       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -3.721524e-01, 5.277313e-01, 1.502453e-01, -1.123428e-03, 9.…</span></span>
<span><span class="co">## $ tri       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9656481, 0.8277034, 0.6934198, 0.6945946, 0.8081013, 0.902…</span></span>
<span><span class="co">## $ roughness <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.807414, 2.421717, 2.196986, 2.156502, 2.581898, 2.606502, …</span></span>
<span><span class="co">## $ detrended <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -2.871674, -2.161609, -2.683798, -3.207528, -3.417629, -3.56…</span></span>
<span><span class="co">## $ depth     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 14.83014, 13.89184, 14.18757, 14.48647, 14.47323, 14.39490, …</span></span>
<span><span class="co">## $ pmacro    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9994044, 0.9986021, 0.9991463, 0.9991944, 0.9991232, 0.999…</span></span>
<span><span class="co">## $ prock     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.007066725, 0.002316534, 0.032253187, 0.125768311, 0.005744…</span></span>
<span><span class="co">## $ psand     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.220446e-16, 2.220446e-16, 1.530496e-04, 1.067617e-04, 2.22…</span></span>
<span><span class="co">## $ pseagrass <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.63705545, 0.70420525, 0.45269763, 0.33056725, 0.72609061, …</span></span>
<span><span class="co">## $ pinverts  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.005092447, 0.005315867, 0.004900178, 0.005803717, 0.006133…</span></span>
<span><span class="co">## $ preef     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1.0000000, 1.0000000, 0.9998470, 0.9998932, 1.0000000, 1.000…</span></span>
<span><span class="co">## $ dom_tag   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "pmacro", "pmacro", "pmacro", "pmacro", "pmacro", "pmacro", …</span></span></code></pre>
<p>Save final predictions</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">preddf</span>, file <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"r-workflows/model output/habitat/"</span>, </span>
<span>                              <span class="va">name</span>, <span class="st">"_habitat-prediction.RDS"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="set-up-for-plotting">Set up for plotting<a class="anchor" aria-label="anchor" href="#set-up-for-plotting"></a>
</h2>
<p>Load marine park data. The dataset used here is the 2022
Collaborative Australian Protected Areas Database, which is available
for free download from <a href="https://fed.dcceew.gov.au/datasets/782c02c691014efe8ffbd27445fe41d7_0/explore" class="external-link uri">https://fed.dcceew.gov.au/datasets/782c02c691014efe8ffbd27445fe41d7_0/explore</a>.
Feel free to replace this shapefile with any suitable dataset that is
available for your study area.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">marine.parks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ZONE_TYPE <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">ZONE_TYPE</span>,<span class="st">"\\s*\\([^\\)]+\\)"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">ZONE_TYPE</span>, <span class="st">"Sanctuary|National Park"</span><span class="op">)</span>, <span class="va">STATE</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"WA"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>                        </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine' from data source `/home/runner/work/CheckEM/CheckEM/r-workflows/data/spatial/shapefiles/Collaborative_Australian_Protected_Areas_Database_(CAPAD)_2022_-_Marine.shp' </span></span>
<span><span class="co">##   using driver `ESRI Shapefile'</span></span>
<span><span class="co">## Simple feature collection with 3775 features and 26 fields</span></span>
<span><span class="co">## Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 70.71702 ymin: -58.44947 xmax: 170.3667 ymax: -8.473407</span></span>
<span><span class="co">## Geodetic CRS:  WGS 84</span></span></code></pre>
<p>Set colours for habitat plotting.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">$</span><span class="va">dom_tag</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "pmacro"    "pseagrass" "psand"     "pinverts"  "prock"</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hab_fills</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"psand"</span> <span class="op">=</span> <span class="st">"wheat"</span>,</span>
<span>  <span class="st">"pinverts"</span> <span class="op">=</span> <span class="st">"plum"</span>,</span>
<span>  <span class="st">"pseagrass"</span> <span class="op">=</span> <span class="st">"forestgreen"</span>,</span>
<span>  <span class="st">"pmacro"</span> <span class="op">=</span> <span class="st">"darkgoldenrod4"</span></span>
<span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Habitat"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-the-dominant-habitats">Plot the dominant habitats<a class="anchor" aria-label="anchor" href="#plot-the-dominant-habitats"></a>
</h2>
<p>Build plot elements and display.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">preddf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">dom_tag</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="va">hab_fills</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://eliocamp.github.io/ggnewscale/reference/new_scale.html" class="external-link">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">marine.parks</span>, fill <span class="op">=</span> <span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"#7bbc63"</span>, </span>
<span>          size <span class="op">=</span> <span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>, colour <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/plot-dominant-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="plot-the-individual-habitat-probabilities">Plot the individual habitat probabilities<a class="anchor" aria-label="anchor" href="#plot-the-individual-habitat-probabilities"></a>
</h2>
<p>Transform habitat predictions into long format for easy plotting with
ggplot::facet_wrap.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">indclass</span> <span class="op">&lt;-</span> <span class="va">preddf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"p"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"habitat"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>habitat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">habitat</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"pinverts"</span> <span class="op">~</span> <span class="st">"Sessile invertebrates"</span>,</span>
<span>                                    <span class="va">habitat</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"pmacro"</span> <span class="op">~</span> <span class="st">"Macroalgae"</span>,</span>
<span>                                    <span class="va">habitat</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"prock"</span> <span class="op">~</span> <span class="st">"Rock"</span>,</span>
<span>                                    <span class="va">habitat</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"psand"</span> <span class="op">~</span> <span class="st">"Sand"</span>,</span>
<span>                                    <span class="va">habitat</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"pseagrass"</span> <span class="op">~</span> <span class="st">"Seagrass"</span>,</span>
<span>                                    <span class="va">habitat</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"preef"</span> <span class="op">~</span> <span class="st">"Reef"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 440,100</span></span>
<span><span class="co">## Columns: 13</span></span>
<span><span class="co">## $ x           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 115.1714, 115.1714, 115.1714, 115.1714, 115.1714, 115.1714…</span></span>
<span><span class="co">## $ y           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -33.60361, -33.60361, -33.60361, -33.60361, -33.60361, -33…</span></span>
<span><span class="co">## $ mbdepth     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -14.83014, -14.83014, -14.83014, -14.83014, -14.83014, -14…</span></span>
<span><span class="co">## $ slope       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.2435020, 0.2435020, 0.2435020, 0.2435020, 0.2435020, 0.2…</span></span>
<span><span class="co">## $ aspect      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 339.99524, 339.99524, 339.99524, 339.99524, 339.99524, 339…</span></span>
<span><span class="co">## $ tpi         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.372152448, -0.372152448, -0.372152448, -0.372152448, -0…</span></span>
<span><span class="co">## $ tri         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9656481, 0.9656481, 0.9656481, 0.9656481, 0.9656481, 0.9…</span></span>
<span><span class="co">## $ roughness   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2.807414, 2.807414, 2.807414, 2.807414, 2.807414, 2.807414…</span></span>
<span><span class="co">## $ detrended   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -2.871674, -2.871674, -2.871674, -2.871674, -2.871674, -2.…</span></span>
<span><span class="co">## $ depth       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 14.83014, 14.83014, 14.83014, 14.83014, 14.83014, 14.83014…</span></span>
<span><span class="co">## $ dom_tag     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "pmacro", "pmacro", "pmacro", "pmacro", "pmacro", "pmacro"…</span></span>
<span><span class="co">## $ habitat     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Macroalgae", "Rock", "Sand", "Seagrass", "Sessile inverte…</span></span>
<span><span class="co">## $ Probability <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 9.994044e-01, 7.066725e-03, 2.220446e-16, 6.370555e-01, 5.…</span></span></code></pre>
<p>Build plot elements for individual habitat probabilities.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">indclass</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fill <span class="op">=</span> <span class="va">Probability</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"D"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://eliocamp.github.io/ggnewscale/reference/new_scale.html" class="external-link">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>                     </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">marine.parks</span>, fill <span class="op">=</span> <span class="cn">NA</span>, colour <span class="op">=</span> <span class="st">"#7bbc63"</span>, </span>
<span>          size <span class="op">=</span> <span class="fl">0.2</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">preddf</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>, fill <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">habitat</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="habitat-modelling_files/figure-html/plot-individual-1.png" width="672"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p><img src="https://ardc.edu.au/wp-content/uploads/2022/09/ardc-logo.svg" height="60" alt="ARDC">    <img src="https://www.nespmarinecoastal.edu.au/wp-content/themes/MarineAndCoastalHubTheme/images/logo.svg" height="70" alt="National Environmental Science Program: Marine and Coastal">     Package developed by Brooke Gibbons, Claude Spencer, Tim Langlois.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
