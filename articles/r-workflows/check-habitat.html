<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Checking habitat data exported from TransectMeasure • CheckEM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../../favicon.ico">
<link rel="manifest" href="../../site.webmanifest">
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Checking habitat data exported from TransectMeasure">
<meta name="google-site-verification" content="m4gXBtqSSJWTmWMwNasopAohP855o_IZ16gJxBTnZ1o">
<!-- Global site tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XRY4CFB9QS"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XRY4CFB9QS');
</script><meta name="google-site-verification" content="m4gXBtqSSJWTmWMwNasopAohP855o_IZ16gJxBTnZ1o">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">CheckEM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-user-guides" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">User Guides</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-user-guides">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Field Manuals</h6></li>
    <li><a class="external-link dropdown-item" href="https://benthic-bruvs-field-manual.github.io/">Baited Remote Underwater Stereo-video (stereo-BRUVs)</a></li>
    <li><a class="external-link dropdown-item" href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.13189">Diver Operated Stereo-video (stereo-DOVs)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Annotation Guides</h6></li>
    <li><a class="dropdown-item" href="../../articles/manuals/EventMeasure_annotation_guide.html">Fish annotation guide (EventMeasure)</a></li>
    <li><a class="dropdown-item" href="../../articles/manuals/TransectMeasure_annotation_guide.html">Benthos annotation guide (TransectMeasure)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>CheckEM Guides</h6></li>
    <li><a class="dropdown-item" href="../../articles/manuals/CheckEM_user_guide.html">CheckEM PDF user manual</a></li>
    <li><a class="dropdown-item" href="../../articles/manuals/CheckEM_video.html">CheckEM instructional video</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-r-workflows" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">R Workflows</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-r-workflows">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Create sampling design</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/sampling-design.html">Create a spatially-balanced sampling design using GRTS</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Check Data</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-habitat.html">Check habitat data from TransectMeasure</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-fish-point.html">Check fish data from single point based methods</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/check-fish-transect.html">Check fish data from transect based methods</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Format Data</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/spatial-layers.html">Generate spatial layers for modelling</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/format-visualise-habitat.html">Format &amp; visualise habitat data</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/format-visualise-fish.html">Format &amp; visualise fish data</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling</h6></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/habitat-modelling.html">Generate spatial predictions of habitat using FSSgam</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-modelling.html">Select top models for fish using FSSgam</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-predictions.html">Generate Generalized Additive Model predictions of fish</a></li>
    <li><a class="dropdown-item" href="../../articles/r-workflows/fish-spatial-prediction.html">Spatially predict fish distributions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../articles/community-updates">Improve CheckEM - Contribute to Species Records</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/GlobalArchiveManual/CheckEM"><span class="fa fa-github"></span> GitHub</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.nespmarinecoastal.edu.au/">ARDC</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Checking habitat data exported from TransectMeasure</h1>
                        <h4 data-toc-skip class="author">Claude Spencer
&amp; Brooke Gibbons</h4>
            
            <h4 data-toc-skip class="date">2023-11-13</h4>
      

      <div class="d-none name"><code>check-habitat.Rmd</code></div>
    </div>

    
    
<p>This script documents the necessary steps to take raw data exported
from TransectMeasure, check for any errors in the annotation and format
it into tidy data. You are required to also have a GlobalArchive format
metadata file “*_Metadata.csv”.</p>
<div class="section level2">
<h2 id="r-set-up">R set up<a class="anchor" aria-label="anchor" href="#r-set-up"></a>
</h2>
<p>Load the necessary libraries.</p>
<!-- ```{r libraries, results='hide', warning=FALSE, message=FALSE} -->
<!-- # install.packages('remotes') -->
<!-- library('remotes') -->
<!-- options(timeout=9999999) -->
<!-- # remotes::install_github("GlobalArchiveManual/CheckEM") -->
<!-- library(CheckEM) -->
<!-- library(tidyverse) -->
<!-- library(ggplot2) -->
<!-- library(ggbeeswarm) -->
<!-- library(leaflet) -->
<!-- library(leaflet.minicharts) -->
<!-- library(RColorBrewer) -->
<!-- library(here) -->
<!-- library(tidyverse) -->
<!-- ``` -->
<!-- Set the study name. -->
<!-- ```{r name} -->
<!-- name <- "example-bruv-workflow" -->
<!-- ``` -->
<!-- # Read in the data -->
<!-- Load and format the metadata. -->
<!-- ```{r metadata} -->
<!-- metadata <- read_metadata(here::here("r-workflows/data/raw/")) %>% -->
<!--     dplyr::select(campaignid, sample, longitude_dd, latitude_dd, date_time, location, site, depth_m, successful_count, successful_length, successful_habitat_forward, successful_habitat_backward) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Save the metadata as an R data file (this creates a lighter file than saving as a .csv or similar). -->
<!-- ```{r save-metadata} -->
<!-- saveRDS(metadata, file = here::here(paste0("r-workflows/data/tidy/", name, "_metadata.rds"))) -->
<!-- ``` -->
<!-- Read in the points data exported from Transect Measure, and then filter this into 2 dataframes for relief and habitat annotations. -->
<!-- ```{r points} -->
<!-- points <- read_TM(here::here("r-workflows/data/raw/"), -->
<!--                                sample = "opcode") -->
<!-- ``` -->
<!-- Filter the data to only include habitat annotations. -->
<!-- ```{r habitat} -->
<!-- habitat <- points %>% -->
<!--   dplyr::filter(relief_annotated %in% "no") %>% -->
<!--   dplyr::select(campaignid, sample, starts_with("level"), scientific) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Filter the data to only include relief annotations. -->
<!-- ```{r relief} -->
<!-- relief <- points %>% -->
<!--   dplyr::filter(relief_annotated %in% "yes") %>% -->
<!--   dplyr::select(campaignid, sample, starts_with("level"), scientific) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- # Check the data for a variety of errors -->
<!-- Set the number of expected annotations to check against. -->
<!-- ```{r set-points} -->
<!-- num.points <- 20 -->
<!-- ``` -->
<!-- Check if there are habitat annotations with an unexpected number of annotation points. -->
<!-- ```{r wrong-habitat} -->
<!-- wrong.points.habitat <- habitat %>% -->
<!--   group_by(campaignid, sample) %>% -->
<!--   summarise(points.annotated = n()) %>% -->
<!--   left_join(metadata) %>% -->
<!--   dplyr::mutate(expected = case_when(successful_habitat_forward %in% "Yes" & successful_habitat_backward %in% "Yes" ~ num.points * 2, successful_habitat_forward %in% "Yes" & successful_habitat_backward %in% "No" ~ num.points * 1, successful_habitat_forward %in% "No" & successful_habitat_backward %in% "Yes" ~ num.points * 1, successful_habitat_forward %in% "No" & successful_habitat_backward %in% "No" ~ num.points * 0)) %>% -->
<!--   dplyr::filter(!points.annotated == expected) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Check if there are habitat annotations with an unexpected number of annotation points. -->
<!-- ```{r wrong-relief} -->
<!-- wrong.points.relief <- relief %>% -->
<!--   group_by(campaignid, sample) %>% -->
<!--   summarise(points.annotated = n()) %>% -->
<!--   left_join(metadata) %>% -->
<!--   dplyr::mutate(expected = case_when(successful_habitat_forward %in% "Yes" & successful_habitat_backward %in% "Yes" ~ num.points * 2, successful_habitat_forward %in% "Yes" & successful_habitat_backward %in% "No" ~ num.points * 1, successful_habitat_forward %in% "No" & successful_habitat_backward %in% "Yes" ~ num.points * 1, successful_habitat_forward %in% "No" & successful_habitat_backward %in% "No" ~ num.points * 0)) %>% -->
<!--   dplyr::filter(!points.annotated == expected) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Check to see if there are any samples in habitat that don't have a match in the metadata. -->
<!-- ```{r missing-metadata} -->
<!-- habitat.missing.metadata <- anti_join(habitat, metadata, by = c("campaignid", "sample")) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Check to see if there are any samples in the metadata that don't have matching habitat. -->
<!-- ```{r missing-habitat} -->
<!-- metadata.missing.habitat <- anti_join(metadata, habitat, by = c("campaignid", "sample")) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- # Format and save the final tidy dataset -->
<!-- Make a vector of columns included in the schema file to ensure proper joining with your tidy habitat dataset. -->
<!-- ```{r add-columns} -->
<!-- catami_cols <- c("level_1" = NA, -->
<!--                  "level_2" = NA, -->
<!--                  "level_3" = NA, -->
<!--                  "level_4" = NA, -->
<!--                  "level_5" = NA, -->
<!--                  "level_6" = NA, -->
<!--                  "level_7" = NA, -->
<!--                  "level_8" = NA, -->
<!--                  "family" = NA, -->
<!--                  "genus" = NA, -->
<!--                  "species" = NA) -->
<!-- ``` -->
<!-- Tidy the habitat data by joining with the complete schema file that is loaded with the CheckEM package. -->
<!-- ```{r tidy-habitat} -->
<!-- tidy.habitat <- habitat %>% -->
<!--   dplyr::mutate(count = 1) %>%  -->
<!--   add_column(!!!catami_cols[!names(catami_cols) %in% names(.)]) %>% -->
<!--   left_join(catami) %>% -->
<!--   dplyr::select(campaignid, sample, count, starts_with("level"), family, genus, species) %>% -->
<!--   dplyr::filter(!level_2 %in% c("","Unscorable", NA)) %>%   -->
<!--   group_by(campaignid, sample, across(starts_with("level")), family, genus, species) %>% -->
<!--   dplyr::summarise(count = sum(count)) %>% -->
<!--   ungroup() %>%                                                      -->
<!--   dplyr::select(campaignid, sample, level_1, everything()) %>% -->
<!--   glimpse() -->
<!-- ``` -->
<!-- Save the tidy habitat data as an R data file. -->
<!-- ```{r save-tidy-habitat} -->
<!-- saveRDS(tidy.habitat, file = here::here(paste0("r-workflows/data/staging/", name, "_habitat.rds"))) -->
<!-- ``` -->
<!-- Tidy the relief data by joining with the complete schema file that is loaded with the CheckEM package. -->
<!-- ```{r tidy-relef} -->
<!-- tidy.relief <- relief %>% -->
<!--   dplyr::select(campaignid, sample, starts_with("level"), scientific) %>% -->
<!--   dplyr::filter(!level_2 %in% c("","Unscorable", NA)) %>%               -->
<!--   dplyr::mutate(count = 1) %>% -->
<!--   add_column(!!!catami_cols[!names(catami_cols) %in% names(.)]) %>% -->
<!--   left_join(catami) %>% -->
<!--   group_by(campaignid, sample, across(starts_with("level"))) %>%  -->
<!--   dplyr::summarise(count = sum(count)) %>% -->
<!--   ungroup() %>%                                                      -->
<!--   glimpse()                                     -->
<!-- ```                         -->
<!-- Save the tidy relief data as an R data file. -->
<!-- ```{r save-tidy-relief} -->
<!-- saveRDS(tidy.relief, file = here::here(paste0("r-workflows/data/staging/", name, "_relief.rds"))) -->
<!-- ``` -->
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p><img src="https://ardc.edu.au/wp-content/uploads/2022/09/ardc-logo.svg" height="60" alt="ARDC">    <img src="https://www.nespmarinecoastal.edu.au/wp-content/themes/MarineAndCoastalHubTheme/images/logo.svg" height="70" alt="National Environmental Science Program: Marine and Coastal">     Package developed by Brooke Gibbons, Claude Spencer, Tim Langlois.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
